import AsyncStorage from '@react-native-async-storage/async-storage';
import DateTimePicker from '@react-native-community/datetimepicker';
import * as AuthSession from 'expo-auth-session';
import { Prompt } from 'expo-auth-session';
import { BlurView } from 'expo-blur';
import * as Contacts from 'expo-contacts';
import * as DocumentPicker from 'expo-document-picker';
import * as ImageManipulator from 'expo-image-manipulator';
import * as ImagePicker from 'expo-image-picker';
import * as Notifications from 'expo-notifications';
import { useRouter } from 'expo-router';
import * as SMS from 'expo-sms';
import { WidgetTaskHandler } from '../../components/widget-task-handler'; // Dosya yolunuza gÃ¶re dÃ¼zeltin
// getAuth'u da eklemeyi unutma
import * as Localization from 'expo-localization';
import {
Â  AlarmClock,
Â  AlertCircle,
Â  AlertTriangle,
Â  AlignLeft,
Â  Award,
Â  BarChart3,
Â  Bell,
Â  CalendarClock,
Â  CalendarDays,
Â  CalendarIcon,
Â  Check,
Â  CheckCheck,
Â  CheckCircle2,
Â  ChevronDown,
Â  ChevronLeft, ChevronRight,
Â  ChevronUp,
Â  Download,
Â  Edit2,
Â  FileText,
Â  Flag,
Â  Flame,
Â  Globe,
Â  Layers,
Â  ListTodo,
Â  Lock,
Â  LogOut, Mail,
Â  MessageCircle,
Â  Monitor,
Â  Moon,
Â  MoreVertical,
Â  Paperclip,
Â  Plus,
Â  Repeat,
Â  Send,
Â  Sliders,
Â  Sun,
Â  Trash2,
Â  TrendingUp,
Â  Trophy,
Â  User,
Â  UserMinus,
Â  UserPlus,
Â  Users,
Â  X,
Â  XCircle
} from 'lucide-react-native';
import React, { useEffect, useMemo, useRef, useState } from 'react';
import {
Â  ActivityIndicator,
Â  BackHandler,
Â  FlatList, Image,
Â  Keyboard,
Â  KeyboardAvoidingView,
Â  LayoutAnimation,
Â  Modal,
Â  PanResponder,
Â  Platform,
Â  SafeAreaView,
Â  ScrollView, StatusBar,
Â  StyleSheet,
Â  Switch,
Â  Text,
Â  TextInput, TouchableOpacity,
Â  TouchableWithoutFeedback,
Â  UIManager,
Â  useColorScheme,
Â  View
} from 'react-native';
import { Calendar, LocaleConfig } from 'react-native-calendars';
import AnimatedSplash from '../../components/AnimatedSplash'; // Yolunu kendine gÃ¶re ayarla
import OmmioAdBanner from '../../components/OmmioAdBanner';
import PagerView from "../../components/OmmioPager";
import { setupCalendarLocales } from '../../constants/calendarConfig';
import { auth, db, storage } from '../../firebaseConfig';
import { decryptMessage, encryptMessage, generateAndStoreKeys } from '../../utils/crypto';
// --- FIREBASE ---
import * as AppleAuthentication from 'expo-apple-authentication';
import * as Google from 'expo-auth-session/providers/google';
import {
Â  createUserWithEmailAndPassword,
Â  EmailAuthProvider,
Â  GoogleAuthProvider,
Â  linkWithCredential,
Â  OAuthProvider,
Â  onAuthStateChanged,
Â  sendEmailVerification,
Â  sendPasswordResetEmail,
Â  signInAnonymously,
Â  signInWithCredential,
Â  signInWithEmailAndPassword,
Â  signOut,
Â  updateProfile
} from 'firebase/auth';
import {
Â  addDoc,
Â  arrayRemove,
Â  arrayUnion,
Â  collection,
Â  collectionGroup,
Â  deleteDoc, doc,
Â  getDoc,
Â  getDocs,
Â  onSnapshot,
Â  orderBy,
Â  query,
Â  serverTimestamp,
Â  setDoc,
Â  updateDoc,
Â  where
} from 'firebase/firestore';
import { getDownloadURL, ref, uploadBytes } from "firebase/storage";
import LandingPage from '../../components/LandingPage';
import { TRANSLATIONS } from '../../constants/translations'; // YENÄ° IMPORT
// Auth tipini gÃ¼venli hale getiriyoruz

import * as WebBrowser from 'expo-web-browser';

// Widget (Android)
// @ts-ignore
import { requestWidgetUpdate } from 'react-native-android-widget';
// @ts-ignore
WebBrowser.maybeCompleteAuthSession();
// --- IMPORTLARIN EN ÃœSTÃœNE EKLEYÄ°N ---
import Constants from 'expo-constants';
import * as Device from 'expo-device';

// --- YARDIMCI FONKSÄ°YON: Push Token Alma ---
// --- YARDIMCI FONKSÄ°YON: Push Token Alma (SESSÄ°Z VERSÄ°YON) ---
async function registerForPushNotificationsAsync() {
Â  let token;

Â  if (Platform.OS === 'android') {
Â  Â  await Notifications.setNotificationChannelAsync('default', {
Â  Â  Â  name: 'default',
Â  Â  Â  importance: Notifications.AndroidImportance.MAX,
Â  Â  Â  vibrationPattern: [0, 250, 250, 250],
Â  Â  Â  lightColor: '#FF231F7C',
Â  Â  });
Â  Â  // Alarm kanalÄ±...
Â  Â  await Notifications.setNotificationChannelAsync('alarm', {
Â  Â  Â  name: 'Alarm',
Â  Â  Â  importance: Notifications.AndroidImportance.MAX,
Â  Â  Â  sound: 'default',
Â  Â  Â  vibrationPattern: [0, 500, 500, 500],
Â  Â  Â  enableLights: true,
Â  Â  });
Â  }

Â  if (Device.isDevice) {
Â  Â  const { status: existingStatus } = await Notifications.getPermissionsAsync();
Â  Â  let finalStatus = existingStatus;
Â  Â Â 
Â  Â  // Ä°zin yoksa bir kere sor (Pop-up Ã§Ä±kar)
Â  Â  if (existingStatus !== 'granted') {
Â  Â  Â  const { status } = await Notifications.requestPermissionsAsync();
Â  Â  Â  finalStatus = status;
Â  Â  }
Â  Â Â 
Â  Â  // --- DEÄžÄ°ÅžÄ°KLÄ°K BURADA: ---
Â  Â  // EÄŸer hala izin yoksa, SESSÄ°ZCE fonksiyondan Ã§Ä±k. UyarÄ± verme.
Â  Â  if (finalStatus !== 'granted') {
Â  Â  Â  console.log('Bildirim izni verilmedi (KullanÄ±cÄ± iÅŸlem yapana kadar sessiz kalÄ±nÄ±yor).');
Â  Â  Â  return;Â 
Â  Â  }
Â  Â Â 
Â  Â  // Proje ID ve Token alma kÄ±smÄ±...
Â  Â  const projectId = Constants?.expoConfig?.extra?.eas?.projectId ?? Constants?.easConfig?.projectId;
Â  Â  try {
Â  Â  Â  Â  token = (await Notifications.getExpoPushTokenAsync({ projectId })).data;
Â  Â  } catch (e) { console.log(e); }
Â  }Â 
Â  return token;
}

// --- YARDIMCI FONKSÄ°YON: Push Token ile Bildirim GÃ¶nderme (WEB CORS DÃœZELTÄ°LMÄ°Åž) ---
async function sendPushNotification(expoPushToken: any, title: any, body: any, data = {}) {
Â  // Web ortamÄ±nda Push Bildirimi doÄŸrudan gÃ¶nderilemez (CORS HatasÄ± verir).
Â  // Bu yÃ¼zden Web'de isek fonksiyonu sessizce durduruyoruz.
Â  if (Platform.OS === 'web') {
Â  Â  Â  console.log("Web ortamÄ±nda Push Notification gÃ¶nderimi atlandÄ± (CORS KÄ±sÄ±tlamasÄ±).");
Â  Â  Â  return;
Â  }

Â  const message = {
Â  Â  to: expoPushToken,
Â  Â  sound: 'default',
Â  Â  title: title,
Â  Â  body: body,
Â  Â  data: data,
Â  Â  priority: 'high',
Â  Â  channelId: 'default',
Â  Â  badge: 1,Â 
Â  };

Â  try {
Â  Â  Â  await fetch('https://exp.host/--/api/v2/push/send', {
Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Accept: 'application/json',
Â  Â  Â  Â  Â  'Accept-encoding': 'gzip, deflate',
Â  Â  Â  Â  Â  'Content-Type': 'application/json',
Â  Â  Â  Â  },
Â  Â  Â  Â  body: JSON.stringify(message),
Â  Â  Â  });
Â  } catch (error) {
Â  Â  Â  console.log("Bildirim gÃ¶nderme hatasÄ±:", error);
Â  }
}

if (Platform.OS === 'android' && UIManager.setLayoutAnimationEnabledExperimental) {
Â  UIManager.setLayoutAnimationEnabledExperimental(true);
}
const COLORS = {
Â  primary: '#6366f1', secondary: '#a5b4fc', background: '#F8FAFC', surface: '#ffffff',
Â  textDark: '#1e293b', textLight: '#64748b', textMuted: '#94a3b8',
Â  success: '#10b981', danger: '#ef4444', warning: '#f59e0b', darkBg: '#0f172a', darkSurface: '#1e293b',
};

const CATEGORY_COLORS = [
Â  { id: 'blue', hex: '#3b82f6', bg: '#eff6ff' },
Â  { id: 'orange', hex: '#f97316', bg: '#fff7ed' },
Â  { id: 'green', hex: '#10b981', bg: '#f0fdf4' },
Â  { id: 'purple', hex: '#a855f7', bg: '#faf5ff' },
Â  { id: 'pink', hex: '#ec4899', bg: '#fdf2f8' },
];

Notifications.setNotificationHandler({
Â  handleNotification: async () => ({ shouldShowAlert: true, shouldPlaySound: true, shouldSetBadge: false, shouldShowBanner: true, shouldShowList: true }),
});

const isValidEmail = (email: string) => {
Â  const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
Â  return re.test(email);
};
const LANGUAGES = [{ code: 'en', label: 'English', flag: 'ðŸ‡¬ðŸ‡§' }, { code: 'tr', label: 'TÃ¼rkÃ§e', flag: 'ðŸ‡¹ðŸ‡·' }, { code: 'nl', label: 'Dutch', flag: 'ðŸ‡³ðŸ‡±' }, { code: 'de', label: 'German', flag: 'ðŸ‡©ðŸ‡ª' }, { code: 'es', label: 'Spanish', flag: 'ðŸ‡ªðŸ‡¸' }, { code: 'fr', label: 'French', flag: 'ðŸ‡«ðŸ‡·' }, { code: 'ar', label: 'Arabic', flag: 'ðŸ‡¸ðŸ‡¦' }, { code: 'id', label: 'Indonesian', flag: 'ðŸ‡®ðŸ‡©' }, { code: 'pt', label: 'Portuguese', flag: 'ðŸ‡µðŸ‡¹' }, { code: 'hi', label: 'Hindi', flag: 'ðŸ‡®ðŸ‡³' }, { code: 'ko', label: 'Korean', flag: 'ðŸ‡°ðŸ‡·' }, { code: 'ja', label: 'Japanese', flag: 'ðŸ‡¯ðŸ‡µ' }, { code: 'ru', label: 'Russian', flag: 'ðŸ‡·ðŸ‡º' }, { code: 'it', label: 'Italian', flag: 'ðŸ‡®ðŸ‡¹' }, { code: 'pl', label: 'Polish', flag: 'ðŸ‡µðŸ‡±' }, { code: 'uk', label: 'Ukrainian', flag: 'ðŸ‡ºðŸ‡¦' }];

// --- TÄ°P TANIMLAMALARI ---
type ThemeMode = 'light' | 'dark' | 'system';
type LangCode = 'en' | 'tr' | 'nl' | 'de' | 'es' | 'fr' | 'ar' | 'id' | 'pt' | 'hi' | 'ko' | 'ja' | 'ru' | 'it' | 'pl' | 'uk';

interface Task {Â 
Â  id: string; text: string; description?: string; completed: boolean; date: string; dueDate?: string; showEveryDayUntilDue?: boolean; categoryId: string; notificationTime?: string | null; alarmTime?: string | null; assignedBy?: string; assignedByName?: string; assignedTo?: string; priority?: 'low' | 'medium' | 'high'; attachments?: { name: string; url: string; type?: string }[]; }

interface Habit {
Â  id: string; title: string; frequency: 'daily' | 'weekly'; selectedDays: number[]; endDate?: string | null; notificationTime?: string | null; notificationIds?: string[]; completedDates: string[]; categoryId: string; createdAt: any;
}

interface Category { id: string; name: string; color: string; }
interface Contact { uid: string; username: string; email: string; phoneNumber?: string; canAssignToMe: boolean; defaultCategoryId?: string; photoURL?: string; displayName?: string; Â publicKey?: string; }
interface FriendRequest { id: string; fromUid: string; fromUsername: string; fromEmail: string; status: 'pending'; }
interface DeviceContact { id: string; name: string; phoneNumber: string; isAppUser?: boolean; uid?: string; }
interface ChatMessage { id: string; text: string; senderId: string; timestamp: any; read?: boolean; }

// Grup AlÄ±ÅŸkanlÄ±ÄŸÄ± Tipi
interface GroupHabit {
Â  id: string;
Â  title: string;
Â  createdBy: string; // Grubu kuran kiÅŸinin UID'si
Â  members: string[]; // Ãœye UID listesi
Â  memberDetails?: any[]; // UI iÃ§in dolduracaÄŸÄ±mÄ±z detaylar (isim, foto vb.)
Â  completions: { [date: string]: string[] }; // Ã–rn: "2023-12-14": ["uid1", "uid2"]
Â  createdAt: any;
}

const getISODate = (date: Date): string => {
Â  const year = date.getFullYear();
Â  const month = String(date.getMonth() + 1).padStart(2, '0');
Â  const day = String(date.getDate()).padStart(2, '0');
Â  return `${year}-${month}-${day}`;
};

const formatDateDDMMYYYY = (date: Date): string => {
Â  const day = String(date.getDate()).padStart(2, '0');
Â  const month = String(date.getMonth() + 1).padStart(2, '0');
Â  const year = date.getFullYear();
Â  return `${day}-${month}-${year}`;
};

const parseDueDate = (dateStr?: string) => {
Â  Â  if (!dateStr) return Infinity;Â 
Â  Â  const parts = dateStr.split('-');
Â  Â  if (parts.length !== 3) return Infinity;
Â  Â  return new Date(parseInt(parts[2]), parseInt(parts[1]) - 1, parseInt(parts[0])).getTime();
};

const convertDDMMYYYYtoISO = (dateStr: string) => {
Â  Â  if (!dateStr) return ""; // BoÅŸ kontrolÃ¼
Â  Â  const parts = dateStr.split('-');
Â  Â  if (parts.length !== 3) return dateStr;
Â  Â Â 
Â  Â  // DÃœZELTME: padStart(2, '0') ile tek haneli sayÄ±larÄ±n baÅŸÄ±na 0 ekliyoruz.
Â  Â  const day = parts[0].padStart(2, '0');
Â  Â  const month = parts[1].padStart(2, '0');
Â  Â  const year = parts[2];
Â  Â Â 
Â  Â  return `${year}-${month}-${day}`;
};

const maskDateInput = (text: string) => {
Â  const cleaned = text.replace(/[^0-9]/g, '');
Â  let formatted = cleaned;
Â  if (cleaned.length > 2) formatted = cleaned.slice(0, 2) + '-' + cleaned.slice(2);
Â  if (cleaned.length > 4) formatted = formatted.slice(0, 5) + '-' + cleaned.slice(4);
Â  return formatted.slice(0, 10);Â 
};

const maskTimeInput = (text: string) => {
Â  const cleaned = text.replace(/[^0-9]/g, '');
Â  let formatted = cleaned;
Â  if (cleaned.length > 2) formatted = cleaned.slice(0, 2) + ':' + cleaned.slice(2);
Â  return formatted.slice(0, 5);
};

const GREETINGS = {
Â  en:{morning:"Good morning",afternoon:"Good afternoon",evening:"Good evening"},
Â  tr:{morning:"GÃ¼naydÄ±n",afternoon:"TÃ¼naydÄ±n",evening:"Ä°yi akÅŸamlar"},
Â  nl:{morning:"Goedemorgen",afternoon:"Goedemiddag",evening:"Goedenavond"},
Â  de:{morning:"Guten Morgen",afternoon:"Guten Nachmittag",evening:"Guten Abend"},
Â  es:{morning:"Buenos dÃ­as",afternoon:"Buenas tardes",evening:"Buenas noches"},
Â  fr:{morning:"Bonjour",afternoon:"Bon aprÃ¨s-midi",evening:"Bonsoir"},
Â  ar:{morning:"ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±",afternoon:"Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±",evening:"Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±"},
Â  id:{morning:"Selamat pagi",afternoon:"Selamat siang",evening:"Selamat malam"},
Â  pt:{morning:"Bom dia",afternoon:"Boa tarde",evening:"Boa noite"},
Â  hi:{morning:"à¤¸à¥à¤ªà¥à¤°à¤­à¤¾à¤¤",afternoon:"à¤¨à¤®à¤¸à¥à¤•à¤¾à¤°",evening:"à¤¶à¥à¤­ à¤¸à¤‚à¤§à¥à¤¯à¤¾"},
Â  ko:{morning:"ì¢‹ì€ ì•„ì¹¨",afternoon:"ì¢‹ì€ ì˜¤í›„",evening:"ì¢‹ì€ ì €ë…"},
Â  ja:{morning:"ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™",afternoon:"ã“ã‚“ã«ã¡ã¯",evening:"ã“ã‚“ã°ã‚“ã¯"},
Â  ru:{morning:"Ð”Ð¾Ð±Ñ€Ð¾Ðµ ÑƒÑ‚Ñ€Ð¾",afternoon:"Ð”Ð¾Ð±Ñ€Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ",evening:"Ð”Ð¾Ð±Ñ€Ñ‹Ð¹ Ð²ÐµÑ‡ÐµÑ€"},
Â  it:{morning:"Buongiorno",afternoon:"Buon pomeriggio",evening:"Buonasera"},
Â  pl:{morning:"DzieÅ„ dobry",afternoon:"DzieÅ„ dobry",evening:"Dobry wieczÃ³r"},
Â  uk:{morning:"Ð”Ð¾Ð±Ñ€Ð¾Ð³Ð¾ Ñ€Ð°Ð½ÐºÑƒ",afternoon:"Ð”Ð¾Ð±Ñ€Ð¸Ð¹ Ð´ÐµÐ½ÑŒ",evening:"Ð”Ð¾Ð±Ñ€Ð¸Ð¹ Ð²ÐµÑ‡Ñ–Ñ€"}
};
const getGreeting = (lang:LangCode)=>{const hour=new Date().getHours();const g=GREETINGS[lang]||GREETINGS.en;return hour<12?g.morning:hour<18?g.afternoon:g.evening;};


const DAYS_OF_WEEK_MAP = {
Â  en:[{id:1,label:"Mon"},{id:2,label:"Tue"},{id:3,label:"Wed"},{id:4,label:"Thu"},{id:5,label:"Fri"},{id:6,label:"Sat"},{id:0,label:"Sun"}],
Â  tr:[{id:1,label:"Pzt"},{id:2,label:"Sal"},{id:3,label:"Ã‡ar"},{id:4,label:"Per"},{id:5,label:"Cum"},{id:6,label:"Cmt"},{id:0,label:"Paz"}],
Â  nl:[{id:1,label:"Ma"},{id:2,label:"Di"},{id:3,label:"Wo"},{id:4,label:"Do"},{id:5,label:"Vr"},{id:6,label:"Za"},{id:0,label:"Zo"}],
Â  de:[{id:1,label:"Mo"},{id:2,label:"Di"},{id:3,label:"Mi"},{id:4,label:"Do"},{id:5,label:"Fr"},{id:6,label:"Sa"},{id:0,label:"So"}],
Â  es:[{id:1,label:"Lun"},{id:2,label:"Mar"},{id:3,label:"MiÃ©"},{id:4,label:"Jue"},{id:5,label:"Vie"},{id:6,label:"SÃ¡b"},{id:0,label:"Dom"}],
Â  fr:[{id:1,label:"Lun"},{id:2,label:"Mar"},{id:3,label:"Mer"},{id:4,label:"Jeu"},{id:5,label:"Ven"},{id:6,label:"Sam"},{id:0,label:"Dim"}],
Â  ar:[{id:1,label:"Ø§Ù„Ø§Ø«Ù†ÙŠÙ†"},{id:2,label:"Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡"},{id:3,label:"Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡"},{id:4,label:"Ø§Ù„Ø®Ù…ÙŠØ³"},{id:5,label:"Ø§Ù„Ø¬Ù…Ø¹Ø©"},{id:6,label:"Ø§Ù„Ø³Ø¨Øª"},{id:0,label:"Ø§Ù„Ø£Ø­Ø¯"}],
Â  id:[{id:1,label:"Sen"},{id:2,label:"Sel"},{id:3,label:"Rab"},{id:4,label:"Kam"},{id:5,label:"Jum"},{id:6,label:"Sab"},{id:0,label:"Min"}],
Â  pt:[{id:1,label:"Seg"},{id:2,label:"Ter"},{id:3,label:"Qua"},{id:4,label:"Qui"},{id:5,label:"Sex"},{id:6,label:"SÃ¡b"},{id:0,label:"Dom"}],
Â  hi:[{id:1,label:"à¤¸à¥‹à¤®"},{id:2,label:"à¤®à¤‚à¤—à¤²"},{id:3,label:"à¤¬à¥à¤§"},{id:4,label:"à¤—à¥à¤°à¥"},{id:5,label:"à¤¶à¥à¤•à¥à¤°"},{id:6,label:"à¤¶à¤¨à¤¿"},{id:0,label:"à¤°à¤µà¤¿"}],
Â  ko:[{id:1,label:"ì›”"},{id:2,label:"í™”"},{id:3,label:"ìˆ˜"},{id:4,label:"ëª©"},{id:5,label:"ê¸ˆ"},{id:6,label:"í† "},{id:0,label:"ì¼"}],
Â  ja:[{id:1,label:"æœˆ"},{id:2,label:"ç«"},{id:3,label:"æ°´"},{id:4,label:"æœ¨"},{id:5,label:"é‡‘"},{id:6,label:"åœŸ"},{id:0,label:"æ—¥"}],
Â  ru:[{id:1,label:"ÐŸÐ½"},{id:2,label:"Ð’Ñ‚"},{id:3,label:"Ð¡Ñ€"},{id:4,label:"Ð§Ñ‚"},{id:5,label:"ÐŸÑ‚"},{id:6,label:"Ð¡Ð±"},{id:0,label:"Ð’Ñ"}],
Â  it:[{id:1,label:"Lun"},{id:2,label:"Mar"},{id:3,label:"Mer"},{id:4,label:"Gio"},{id:5,label:"Ven"},{id:6,label:"Sab"},{id:0,label:"Dom"}],
Â  pl:[{id:1,label:"Pon"},{id:2,label:"Wto"},{id:3,label:"Åšro"},{id:4,label:"Czw"},{id:5,label:"PiÄ…"},{id:6,label:"Sob"},{id:0,label:"Nie"}],
Â  uk:[{id:1,label:"ÐŸÐ½"},{id:2,label:"Ð’Ñ‚"},{id:3,label:"Ð¡Ñ€"},{id:4,label:"Ð§Ñ‚"},{id:5,label:"ÐŸÑ‚"},{id:6,label:"Ð¡Ð±"},{id:0,label:"ÐÐ´"}]
};

const getDaysOfWeek = (lang:LangCode)=>DAYS_OF_WEEK_MAP[lang]||DAYS_OF_WEEK_MAP.en;

setupCalendarLocales();
// lang prop'unu ekledik
export default function OmmioApp() {
Â  const [theme, setTheme] = useState<ThemeMode>("system");
Â  const [rememberMe, setRememberMe] = useState(true);
Â  const systemScheme = useColorScheme();
Â  const [user, setUser] = useState<any>(null);
Â  const [isAuthLoading, setIsAuthLoading] = useState(true);
Â  const [isCategoryModalOpen, setIsCategoryModalOpen] = useState(false);
Â  const [authMethod, setAuthMethod] = useState<'email' | 'phone'>('email');Â 
Â  const [authMode, setAuthMode] = useState<'login' | 'signup'>('login');
Â  const [email, setEmail] = useState('');
Â  const [password, setPassword] = useState('');
Â  const [username, setUsername] = useState('');
Â  const [phoneNumber, setPhoneNumber] = useState('');Â 
Â  const [newCategoryColor, setNewCategoryColor] = useState('blue'); // VarsayÄ±lan renk
Â  const CATEGORY_PALETTE = ['blue', 'orange', 'green', 'purple','pink']; // SeÃ§enekler
Â  const [tasks, setTasks] = useState<Task[]>([]);
Â  const [habits, setHabits] = useState<Habit[]>([]);
Â  const [contacts, setContacts] = useState<Contact[]>([]);
Â  const [friendRequests, setFriendRequests] = useState<FriendRequest[]>([]);

Â  const [isHabitStatsModalOpen, setIsHabitStatsModalOpen] = useState(false);

Â  // Mevcut editUsernameInput'un hemen altÄ±na ekleyin:
Â  const [editDisplayNameInput, setEditDisplayNameInput] = useState("");

Â  // --- YENÄ° STATE'LER ---
Â  // 1. Ã‡oklu Atama: ArtÄ±k tek kiÅŸi deÄŸil, liste tutuyoruz
Â  const [assignTargets, setAssignTargets] = useState<Contact[]>([]);Â 
Â Â 
Â  // 2. Ã–ncelik: 'low' | 'medium' | 'high'
Â  const [priority, setPriority] = useState<'low' | 'medium' | 'high'>('medium');Â 
Â Â 
Â  // 3. Dosyalar: SeÃ§ilen dosyalarÄ± tutar
Â  const [attachments, setAttachments] = useState<any[]>([]);Â 
Â  const [isUploading, setIsUploading] = useState(false);

Â  const [taskComments, setTaskComments] = useState<any[]>([]); // YorumlarÄ± tutar
Â  const [taskCommentInput, setTaskCommentInput] = useState(""); // Yorum yazma kutusu
Â  const [taskModalTab, setTaskModalTab] = useState<'details' | 'chat'>('details'); // Modal iÃ§indeki sekme
Â Â 
Â  // Profil DÃ¼zenleme State'leri
Â  const [isEditProfileVisible, setIsEditProfileVisible] = useState(false);
Â  const [editUsernameInput, setEditUsernameInput] = useState("");

Â  const [isCalendarExpanded, setIsCalendarExpanded] = useState(false); // Takvim aÃ§Ä±k/kapalÄ± kontrolÃ¼

Â  // OmmioApp fonksiyonunun iÃ§ine, diÄŸer state'lerin yanÄ±na ekle
const [isSplashAnimationComplete, setIsSplashAnimationComplete] = useState(false);

const passwordRef = useRef<TextInput>(null);

Â  // --- REKLAM VE SAYAÃ‡ STATE'LERÄ° ---
Â  // Hangi eylemden kaÃ§ tane yapÄ±ldÄ±? Â 
Â  // --- REKLAM & PREMIUM MANTIÄžI ---
Â  const [adCounters, setAdCounters] = useState({ tasks: 0, habits: 0, assigned: 0, time: 0 });
Â  const [isAdVisible, setIsAdVisible] = useState(false);
Â  const [isUpsellVisible, setIsUpsellVisible] = useState(false);
Â Â 
Â  // YENÄ°: Reklam geri sayÄ±mÄ± (BaÅŸlangÄ±Ã§ 5 saniye)
Â  const [adCountdown, setAdCountdown] = useState(5);Â 

Â  const AD_THRESHOLDS = { tasks: 4, habits: 4, assigned: 3, time: 300 };

Â  const [isPasswordModalOpen, setIsPasswordModalOpen] = useState(false);
Â  const [newPasswordInput, setNewPasswordInput] = useState("");

Â  Â  // Landing Page mi gÃ¶sterilsin yoksa Auth ekranÄ± mÄ±?
Â  Â  // Web deÄŸilse (Android/iOS) direkt true baÅŸlasÄ±n.
Â  Â  const [showAuth, setShowAuth] = useState(Platform.OS !== 'web');

Â  Â  // Grup AlÄ±ÅŸkanlÄ±klarÄ± State'leri
Â  Â  const [groupHabits, setGroupHabits] = useState<GroupHabit[]>([]);
Â  Â  const [isGroupModalOpen, setIsGroupModalOpen] = useState(false);
Â  Â  const [newGroupTitle, setNewGroupTitle] = useState("");
Â  Â  const [selectedGroupMembers, setSelectedGroupMembers] = useState<string[]>([]); // SeÃ§ilen arkadaÅŸlarÄ±n UID'leri

Â  Â  const handlePageScroll = (e: any) => {
Â  Â  Â  Â  const index = e.nativeEvent.position;
Â  Â  Â  Â  // EÄŸer TAB_ORDER tanÄ±mlÄ± deÄŸilse hata almamak iÃ§in kontrol edelim
Â  Â  Â  Â  if (TAB_ORDER && TAB_ORDER[index]) {
Â  Â  Â  Â  Â  Â  // @ts-ignore
Â  Â  Â  Â  Â  Â  setActiveTab(TAB_ORDER[index]);Â 
Â  Â  Â  Â  }
Â  Â  };

// PagerView kontrolÃ¼ iÃ§in referans
const pagerRef = useRef<PagerView>(null);

// TablarÄ±n sÄ±rasÄ± (Ã–NEMLÄ°: Bu sÄ±ra BottomBar'daki sÄ±rayla aynÄ± olmalÄ±)
const TAB_ORDER = ['list', 'habits', 'messages', 'social', 'profile'];

// Tab deÄŸiÅŸtirme fonksiyonu (Hem tÄ±klama hem kaydÄ±rma iÃ§in)
const handleTabChange = (index: number) => {
Â  Â  const tabName = TAB_ORDER[index];
Â  Â  // State'i gÃ¼ncelle (ikonun rengi deÄŸiÅŸsin diye)
Â  Â  // @ts-ignore
Â  Â  setActiveTab(tabName);Â 
};
const [isHistoryModalOpen, setIsHistoryModalOpen] = useState(false);

// Alt bara tÄ±klandÄ±ÄŸÄ±nda Ã§alÄ±ÅŸacak fonksiyon
const onBottomTabPress = (tabName: string) => {
Â  Â  setActiveTab(tabName as any);
Â  Â  const index = TAB_ORDER.indexOf(tabName);
Â  Â  // SayfayÄ± o indexe kaydÄ±r
Â  Â  pagerRef.current?.setPage(index);
};


Â  // --- YENÄ° STATE TANIMLARI ---
Â Â 
Â  // 1. GeliÅŸmiÅŸ Toast (Bildirim) State'i
const [customToast, setCustomToast] = useState<{visible: boolean;
Â  Â  title: string;
Â  Â  message: string;
Â  Â  type: 'success' | 'error' | 'info' | 'warning';}>({ Â  Â  visible: false,Â 
Â  Â  title: '',Â 
Â  Â  message: '',Â 
Â  Â  type: 'success' });

Â  // 2. Ã–zel Onay Kutusu (Confirm Modal) State'i
Â  const [confirmModal, setConfirmModal] = useState({ visible: false, title: '', message: '', onConfirm: () => {}, // OnaylanÄ±nca Ã§alÄ±ÅŸacak fonksiyon
Â  Â  Â  isDestructive: false // Silme iÅŸlemiyse kÄ±rmÄ±zÄ± buton olsun mu?
Â  });

Â  const [friendTasksModal, setFriendTasksModal] = useState<{visible: boolean; tasks: any[]; // veya Task[] yazabilirsin ama any[] ÅŸimdilik hatalarÄ± Ã§Ã¶zer
Â  Â  friendName: string;}>({ visible: false, tasks: [], friendName: '' });

Â  // Toast Bildirim State'i
Â  const [toast, setToast] = useState({ visible: false, message: '', type: 'success' }); // type: 'success' | 'error' | 'info'

Â  // Her arkadaÅŸÄ±n son mesajÄ±nÄ± ve okunmamÄ±ÅŸ sayÄ±sÄ±nÄ± tutar: { [uid]: { text, time, unread } }

Â  const [isGuestModalOpen, setIsGuestModalOpen] = useState(false);
Â  const [chatPreviews, setChatPreviews] = useState<any>({});

Â  // Sosyal sekmesinde hangi kiÅŸinin detaylarÄ±nÄ±n aÃ§Ä±k olduÄŸunu tutar
Â  const [expandedContactId, setExpandedContactId] = useState<string | null>(null);

Â Â 
Â  const hasUnreadInSelectedTask = taskComments.some(c => !c.read && c.senderId !== user.uid);

Â  // NAVIGATION STATE
Â  const [activeTab, setActiveTab] = useState<'list' | 'habits' | 'messages' | 'social' | 'profile' | 'chat_room'>('list');
Â  const [chatTarget, setChatTarget] = useState<Contact | null>(null);Â 
Â  const [chatMessages, setChatMessages] = useState<ChatMessage[]>([]);
Â  const [chatInput, setChatInput] = useState("");

Â  const [isPremium, setIsPremium] = useState(false); Â 

Â  const [isTyping, setIsTyping] = useState(false); // KarÅŸÄ± taraf yazÄ±yor mu?
Â  const [lastVisibleMsg, setLastVisibleMsg] = useState<any>(null); // Pagination iÃ§in
Â  const [loadingMoreMsg, setLoadingMoreMsg] = useState(false);

Â  const [showOnboarding, setShowOnboarding] = useState(false);
Â  const [onboardingStep, setOnboardingStep] = useState(0);
Â Â 
Â  const [msgLimit, setMsgLimit] = useState(125); // BaÅŸlangÄ±Ã§ta 125 mesaj gÃ¶ster

Â Â 

Â  const getDeviceLang = () => {
Â  Â  const loc = Localization.getLocales()[0]; // CihazÄ±n birincil dili
Â  Â  const code = loc ? loc.languageCode : 'en';Â 
Â  Â  // LANGUAGES dizisinde bu kod var mÄ± kontrol et, yoksa 'en' dÃ¶ndÃ¼r
Â  Â  return LANGUAGES.some(l => l.code === code) ? code : 'en';
};

const [isMenuOpen, setIsMenuOpen] = useState(false);

// State tanÄ±mlarken varsayÄ±lan deÄŸeri buna eÅŸitle
const [lang, setLang] = useState<LangCode>(getDeviceLang() as LangCode);
Â  const [selectedDate, setSelectedDate] = useState<Date>(new Date());
Â  const [isSettingsOpen, setIsSettingsOpen] = useState<boolean>(false);
Â  const [isLangModalOpen, setIsLangModalOpen] = useState(false);
Â  const [isCompletedExpanded, setIsCompletedExpanded] = useState(false);
Â  const [isOverdueExpanded, setIsOverdueExpanded] = useState(true);
Â  const [taskViewMode, setTaskViewMode] = useState<'list' | 'category'>('list');

Â  const [isAllTasksModalOpen, setIsAllTasksModalOpen] = useState(false);

Â  // ADD MODAL STATE (Eksik olanlar eklendi)
Â Â 
Â  const [isAddModalOpen, setIsAddModalOpen] = useState(false);Â 
Â  const [addMode, setAddMode] = useState<'task' | 'habit'>('task');Â 
Â Â 
Â  const router = useRouter();

Â  const [inputValue, setInputValue] = useState("");
Â  const [inputDesc, setInputDesc] = useState("");
Â  const [inputDueDate, setInputDueDate] = useState("");Â 
Â  const [inputStartDate, setInputStartDate] = useState("");Â 
Â  const [notifInput, setNotifInput] = useState("");
Â  const [alarmInput, setAlarmInput] = useState("");
Â  const [isNotifOn, setIsNotifOn] = useState(false);
Â  const [isAlarmOn, setIsAlarmOn] = useState(false);
Â  const [isEveryDayOn, setIsEveryDayOn] = useState(false);
Â  const [assignTarget, setAssignTarget] = useState<Contact | null>(null);

Â  const [newHabitTitle, setNewHabitTitle] = useState("");
Â  const [newHabitFreq, setNewHabitFreq] = useState<'daily' | 'weekly'>('daily');
Â  const [newHabitDays, setNewHabitDays] = useState<number[]>([]);
Â  const [newHabitEndDate, setNewHabitEndDate] = useState("");
Â  const [habitNotifInput, setHabitNotifInput] = useState("");Â 
Â  const [isHabitModalOpen, setIsHabitModalOpen] = useState(false);
Â  // ... diÄŸer state tanÄ±mlarÄ±
Â  const [newCategoryName, setNewCategoryName] = useState("");

Â  const [categories, setCategories] = useState<Category[]>([
Â  Â  Â  { id: 'work', name: 'Ä°ÅŸ', color: 'blue' },Â 
Â  Â  Â  { id: 'home', name: 'Ev', color: 'orange' },
Â  Â  Â  { id: 'personal', name: 'KiÅŸisel', color: 'green' }
Â  ]);
Â  const [selectedCategory, setSelectedCategory] = useState<Category>(categories[0]);

Â  const [selectedTask, setSelectedTask] = useState<Task | null>(null);
Â  const [expandedTaskId, setExpandedTaskId] = useState<string | null>(null);
Â  const [activeAlarmTask, setActiveAlarmTask] = useState<Task | null>(null);
Â  const [detailText, setDetailText] = useState("");
Â  const [detailDesc, setDetailDesc] = useState("");
Â  const [detailDueDate, setDetailDueDate] = useState("");

Â  // DATE PICKERS
Â  const [showDatePicker, setShowDatePicker] = useState(false);
Â  const [showDetailDatePicker, setShowDetailDatePicker] = useState(false);Â 
Â  const [showHabitDatePicker, setShowHabitDatePicker] = useState(false);
Â  const [datePickerTarget, setDatePickerTarget] = useState<'start' | 'due' | 'habitEnd' | 'detail'>('start');

Â  const [deviceContacts, setDeviceContacts] = useState<DeviceContact[]>([]);Â 
Â  const [assignSearchText, setAssignSearchText] = useState("");
Â  const [searchUsername, setSearchUsername] = useState("");
Â  const [isNetworkModalOpen, setIsNetworkModalOpen] = useState(false);
Â  const [networkTab, setNetworkTab] = useState<'ommio' | 'contacts'>('ommio');Â 
Â  const [isInputExpanded, setIsInputExpanded] = useState(false);

Â Â 

Â  Â  // Google Auth KÄ±smÄ±nÄ± BÃ¶yle GÃ¼ncelle:
Â  Â  // Bu kÄ±smÄ± Google.useIdTokenAuthRequest'in hemen Ã¼zerine yazÄ±n
const currentRedirectUri = React.useMemo(() => {
Â  Â  return AuthSession.makeRedirectUri({
Â  Â  Â  Â  scheme: 'ommioapp',
Â  Â  Â  Â  path: 'auth' // Bunu eklemek bazen sorunu Ã§Ã¶zer
Â  Â  });
}, []);

// TÃ¼m arkadaÅŸlardan gelen toplam okunmamÄ±ÅŸ mesaj sayÄ±sÄ±
const totalSocialUnread = useMemo(() => {
Â  Â  return Object.values(chatPreviews).reduce((acc: number, curr: any) => acc + (curr.unread || 0), 0);
}, [chatPreviews]);

// Mevcut hook'unuzu bu yeni deÄŸiÅŸkeni kullanacak ÅŸekilde gÃ¼ncelleyin:
const [request, response, promptAsync] = Google.useIdTokenAuthRequest({
Â  Â  clientId: '677937409612-ijhg8dbhknb24hs53t9r8gvse397pvrh.apps.googleusercontent.com',
Â  Â  iosClientId: '677937409612-sats3t36t7mko7i2lds7m45sc52aofq2.apps.googleusercontent.com',
Â  Â  androidClientId: '677937409612-prdicaptu9fn46vmbp4o1c05nrhg2asb.apps.googleusercontent.com',
Â  Â  redirectUri: currentRedirectUri, // BURAYI GÃœNCELLEDÄ°K
Â  Â  prompt: Prompt.SelectAccount,
Â  Â  extraParams: { access_type: 'offline' },
});

Â  useEffect(() => {
Â  Â if (response?.type === 'success') {
Â  Â  Â  Â  const { id_token } = response.params;
Â  Â  Â  Â  const credential = GoogleAuthProvider.credential(id_token);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Loading baÅŸlat
Â  Â  Â  Â  setIsAuthLoading(true);

Â  Â  Â  Â  signInWithCredential(auth, credential)
Â  Â  Â  Â  Â  Â  .then(async (userCredential) => {
Â  Â  Â  Â  Â  // Google giriÅŸi baÅŸarÄ±lÄ± oldu.
Â  Â  Â  Â  Â  // Åžimdi bu kullanÄ±cÄ±yÄ± veritabanÄ±na da kaydedelim (EÄŸer yoksa)
Â  Â  Â  Â  Â  const user = userCredential.user;
Â  Â  Â  Â  Â  const userRef = doc(db, "users", user.uid);
Â  Â  Â  Â  Â  const docSnap = await getDoc(userRef);

Â  Â  Â  Â  Â  if (!docSnap.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  // Google'dan gelen isimden kullanÄ±cÄ± adÄ± tÃ¼retelim
Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ã–rn: "Enes Berkay" -> "enesberkay_4821"
Â  Â  Â  Â  Â  Â  Â  Â  Â  const randomSuffix = Math.floor(Math.random() * 10000);
Â  Â  Â  Â  Â  Â  Â  Â  Â  const baseName = (user.displayName || "user").toLowerCase()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .replace(/\s+/g, '')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .replace(/ÄŸ/g, 'g').replace(/Ã¼/g, 'u').replace(/ÅŸ/g, 's')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .replace(/Ä±/g, 'i').replace(/Ã¶/g, 'o').replace(/Ã§/g, 'c');
Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  const autoUsername = `${baseName}_${randomSuffix}`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  // VeritabanÄ±na yaz
Â  Â  Â  Â  Â  Â  Â  Â  Â  await setDoc(userRef, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  uid: user.uid,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  email: user.email,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  username: autoUsername, // OTOMATÄ°K OLUÅžTURDUK
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayName: user.displayName || "Google User",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createdAt: serverTimestamp(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  photoURL: user.photoURL,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  categories: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { id: 'work', name: t('work'), color: 'blue' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { id: 'home', name: t('home'), color: 'orange' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { id: 'personal', name: t('personal'), color: 'green' }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  // Public profil
Â  Â  Â  Â  Â  Â  Â  Â  Â  await setDoc(doc(db, "public_users", user.uid), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  uid: user.uid,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  username: autoUsername,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  email: user.email,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  photoURL: user.photoURL
Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch((error) => {
Â  Â  Â  Â  Â  Â  Â  Â  console.log("Google Sign-In Error:", error);
Â  Â  Â  Â  Â  Â  Â  Â  showToast(t('login_error'), t('google_login_failed') + error.message, 'error');
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .finally(() => {
Â  Â  Â  Â  Â  Â  Â  Â  setIsAuthLoading(false);
Â  Â  Â  Â  Â  Â  });
Â  Â  } else if (response?.type === 'error') {
Â  Â  Â  Â  showToast(t('warning_title'), t('google_connection_error'), 'error');
Â  Â  }
}, [response]);
// --- EKSÄ°K OLAN PARÃ‡A: SEÃ‡Ä°LÄ° SOHBETÄ°N MESAJLARINI DÄ°NLEME ---
Â  useEffect(() => {
Â  Â  // EÄŸer bir sohbet seÃ§ilmediyse veya kullanÄ±cÄ± yoksa iÅŸlem yapma
Â  Â  if (!chatTarget || !user) return;

Â  Â  // Chat ID oluÅŸtur (Alfabetik sÄ±raya gÃ¶re, bÃ¶ylece her iki tarafta da aynÄ± ID olur)
Â  Â  const chatId = [user.uid, chatTarget.uid].sort().join('_');

Â  Â  // Sorguyu hazÄ±rla: MesajlarÄ± tarihe gÃ¶re tersten sÄ±rala (en yeni en altta)
Â  Â  const q = query(
Â  Â  Â  collection(db, "chats", chatId, "messages"),
Â  Â  Â  orderBy("timestamp", "desc")
Â  Â  );

Â  Â  // Dinlemeyi baÅŸlat
Â  Â  const unsubscribe = onSnapshot(q, (snapshot) => {
Â  Â  Â  const msgs = snapshot.docs.map(doc => ({
Â  Â  Â  Â  id: doc.id,
Â  Â  Â  Â  ...doc.data()
Â  Â  Â  })) as ChatMessage[];
Â  Â  Â Â 
Â  Â  Â  setChatMessages(msgs);
Â  Â  Â Â 
Â  Â  Â  // Okundu bilgisini gÃ¼ncelle (KarÅŸÄ± tarafÄ±n attÄ±ÄŸÄ± mesajlarÄ± okundu yap)
Â  Â  Â  snapshot.docs.forEach(async (docSnap) => {
Â  Â  Â  Â  Â const msgData = docSnap.data();
Â  Â  Â  Â  Â if (msgData.senderId !== user.uid && !msgData.read) {
Â  Â  Â  Â  Â  Â  Â await updateDoc(doc(db, "chats", chatId, "messages", docSnap.id), { read: true });
Â  Â  Â  Â  Â }
Â  Â  Â  });
Â  Â  });

Â  Â  // Sohbetten Ã§Ä±kÄ±nca dinlemeyi durdur
Â  Â  return () => unsubscribe();
Â  }, [chatTarget, user]); // chatTarget deÄŸiÅŸtiÄŸinde (baÅŸka sohbete girince) tekrar Ã§alÄ±ÅŸÄ±r

Â  // --- GÃ–REV Ä°Ã‡Ä° YORUMLARI DÄ°NLEME (DÃœZELTÄ°LMÄ°Åž & GÃœVENLÄ° VERSÄ°YON) ---
// --- GÃ–REV Ä°Ã‡Ä° YORUMLARI DÄ°NLEME (DÃœZELTÄ°LMÄ°Åž) ---
useEffect(() => {
Â  Â  if (!selectedTask || !user) return;

Â  Â  // 1. VeritabanÄ± sahibini belirle
Â  Â  let targetDbId = user.uid;
Â  Â Â 
Â  Â  if (selectedTask.assignedTo) {
Â  Â  Â  Â  targetDbId = selectedTask.assignedTo;
Â  Â  } else if (selectedTask.assignedBy && selectedTask.assignedBy !== user.uid) {
Â  Â  Â  Â  targetDbId = user.uid;
Â  Â  }

Â  Â  // Konsoldan yolu kontrol et (Hata ayÄ±klamak iÃ§in)
Â  Â  console.log(`ðŸ’¬ Sohbet BaÄŸlanÄ±yor: users/${targetDbId}/tasks/${selectedTask.id}/comments`);

Â  Â  const q = query(
Â  Â  Â  collection(db, "users", targetDbId, "tasks", selectedTask.id, "comments")
Â  Â  );

Â  Â  const unsubscribe = onSnapshot(q, (snapshot) => {
Â  Â  Â  // TypeScript HATASI Ã‡Ã–ZÃœMÃœ: 'as any[]' ekledik
Â  Â  Â  const msgs = snapshot.docs.map(doc => ({Â 
Â  Â  Â  Â  Â  id: doc.id,Â 
Â  Â  Â  Â  Â  ...doc.data()Â 
Â  Â  Â  })) as any[];Â 

Â  Â  Â  // Telefon iÃ§inde sÄ±ralama (Hata riskini azaltÄ±r)
Â  Â  Â  msgs.sort((a, b) => {
Â  Â  Â  Â  Â  const timeA = a.createdAt?.seconds || 0;
Â  Â  Â  Â  Â  const timeB = b.createdAt?.seconds || 0;
Â  Â  Â  Â  Â  return timeA - timeB;
Â  Â  Â  });

Â  Â  Â  setTaskComments(msgs);
Â  Â  }, (error) => {
Â  Â  Â  Â console.log("Sohbet YÃ¼kleme HatasÄ±:", error);
Â  Â  });

Â  Â  return () => unsubscribe();
}, [selectedTask, user]);
// --- SOHBET AÃ‡ILDIÄžINDA MESAJLARI OKUNDU YAP (DÃœZELTÄ°LMÄ°Åž) ---
useEffect(() => {
Â  Â  // Sohbet sekmesi aÃ§Ä±k deÄŸilse veya gÃ¶rev seÃ§ili deÄŸilse iÅŸlem yapma
Â  Â  if (taskModalTab !== 'chat' || !selectedTask || !user) return;

Â  Â  const markAsRead = async () => {
Â  Â  Â  Â  let targetDbId = user.uid;
Â  Â  Â  Â  if (selectedTask.assignedTo) {
Â  Â  Â  Â  Â  Â  targetDbId = selectedTask.assignedTo;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Sadece 'read == false' olanlarÄ± Ã§ek (Sender kontrolÃ¼nÃ¼ aÅŸaÄŸÄ±da yapacaÄŸÄ±z)
Â  Â  Â  Â  // Bu sayede Index hatasÄ±ndan kurtuluruz.
Â  Â  Â  Â  const q = query(
Â  Â  Â  Â  Â  Â  collection(db, "users", targetDbId, "tasks", selectedTask.id, "comments"),
Â  Â  Â  Â  Â  Â  where("read", "==", false)
Â  Â  Â  Â  );

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const snapshot = await getDocs(q);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Hepsini tek tek kontrol et ve gÃ¼ncelle
Â  Â  Â  Â  Â  Â  snapshot.docs.forEach(async (docSnap) => {
Â  Â  Â  Â  Â  Â  Â  Â  const data = docSnap.data();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // EÄŸer mesajÄ± gÃ¶nderen BEN DEÄžÄ°LSEM, okundu yap.
Â  Â  Â  Â  Â  Â  Â  Â  if (data.senderId !== user.uid) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(docSnap.ref, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  read: true
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.log("Okundu iÅŸaretleme hatasÄ±:", error);
Â  Â  Â  Â  }
Â  Â  };

Â  Â  markAsRead();
}, [taskModalTab, selectedTask, user, taskComments]); // <--- taskComments EKLENDÄ°

// --- SOHBET AÃ‡ILDIÄžINDA MESAJLARI OKUNDU YAP ---
useEffect(() => {
Â  Â  // Sohbet sekmesi aÃ§Ä±k deÄŸilse veya gÃ¶rev seÃ§ili deÄŸilse iÅŸlem yapma
Â  Â  if (taskModalTab !== 'chat' || !selectedTask || !user) return;

Â  Â  const markAsRead = async () => {
Â  Â  Â  Â  let targetDbId = user.uid;
Â  Â  Â  Â  if (selectedTask.assignedTo) {
Â  Â  Â  Â  Â  Â  targetDbId = selectedTask.assignedTo;
Â  Â  Â  Â  }

Â  Â  Â  Â  // OkunmamÄ±ÅŸ ve gÃ¶ndereni ben OLMAYAN mesajlarÄ± bul
Â  Â  Â  Â  const q = query(
Â  Â  Â  Â  Â  Â  collection(db, "users", targetDbId, "tasks", selectedTask.id, "comments"),
Â  Â  Â  Â  Â  Â  where("read", "==", false),
Â  Â  Â  Â  Â  Â  where("senderId", "!=", user.uid)Â 
Â  Â  Â  Â  );

Â  Â  Â  Â  const snapshot = await getDocs(q);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Hepsini tek tek "read: true" olarak gÃ¼ncelle
Â  Â  Â  Â  snapshot.forEach(async (docSnap) => {
Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, "users", targetDbId, "tasks", selectedTask.id, "comments", docSnap.id), {
Â  Â  Â  Â  Â  Â  Â  Â  read: true
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  };

Â  Â  markAsRead();
}, [taskModalTab, selectedTask, user]); // Sekme deÄŸiÅŸtiÄŸinde Ã§alÄ±ÅŸÄ±r

Â  // --- GÃ–REV YORUMU GÃ–NDERME (GÃœNCELLENDÄ°) ---
Â  // --- GÃ–REV YORUMU VE BÄ°LDÄ°RÄ°M GÃ–NDERME ---
const sendTaskComment = async () => {
Â  Â  if (!taskCommentInput.trim() || !selectedTask || !user) return;

Â  Â  // 1. GÃ¶revin durduÄŸu yeri bul (YukarÄ±daki mantÄ±ÄŸÄ±n aynÄ±sÄ±)
Â  Â  let taskOwnerId = user.uid;
Â  Â  if (selectedTask.assignedTo) {
Â  Â  Â  Â  taskOwnerId = selectedTask.assignedTo;
Â  Â  }

Â  Â  try {
Â  Â  Â  Â  // 2. Yorumu Kaydet
Â  Â  Â  Â  await addDoc(collection(db, "users", taskOwnerId, "tasks", selectedTask.id, "comments"), {
Â  Â  Â  Â  Â  Â  text: taskCommentInput.trim(),
Â  Â  Â  Â  Â  Â  senderId: user.uid,
Â  Â  Â  Â  Â  Â  senderName: user.displayName || user.username,
Â  Â  Â  Â  Â  Â  photoURL: user.photoURL || null,
Â  Â  Â  Â  Â  Â  createdAt: serverTimestamp(),
Â  Â  Â  Â  Â  Â  read: false
Â  Â  Â  Â  });

Â  Â  Â  Â  // 3. BÄ°LDÄ°RÄ°M MANTIÄžI
Â  Â  Â  Â  // Senaryo A: GÃ¶revi ben oluÅŸturdum (assignedBy benim), arkadaÅŸÄ±ma yazdÄ±m -> ArkadaÅŸa (assignedTo) bildirim gitmeli.
Â  Â  Â  Â  // Senaryo B: ArkadaÅŸ bana atadÄ±, ben yazdÄ±m -> ArkadaÅŸa (assignedBy) bildirim gitmeli.
Â  Â  Â  Â Â 
Â  Â  Â  Â  let notificationTargetId = null;

Â  Â  Â  Â  if (user.uid === selectedTask.assignedBy) {
Â  Â  Â  Â  Â  Â  // Ben patronum, Ã§alÄ±ÅŸana (assignedTo) bildirim gÃ¶nder (EÄŸer kendim deÄŸilsem)
Â  Â  Â  Â  Â  Â  if (selectedTask.assignedTo !== user.uid) {
Â  Â  Â  Â  Â  Â  Â  Â  notificationTargetId = selectedTask.assignedTo;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else if (user.uid === selectedTask.assignedTo) {
Â  Â  Â  Â  Â  Â  // Ben Ã§alÄ±ÅŸanÄ±m, patrona (assignedBy) bildirim gÃ¶nder
Â  Â  Â  Â  Â  Â  notificationTargetId = selectedTask.assignedBy;
Â  Â  Â  Â  }

Â  Â  Â  Â  // EÄŸer bildirim gidecek bir hedef varsa
Â  Â  Â  Â  if (notificationTargetId) {
Â  Â  Â  Â  Â  Â  const targetUserDoc = await getDoc(doc(db, "public_users", notificationTargetId));
Â  Â  Â  Â  Â  Â  if (targetUserDoc.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  const token = targetUserDoc.data().pushToken;
Â  Â  Â  Â  Â  Â  Â  Â  if (token) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await sendPushNotification(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  token,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `ðŸ’¬ ${user.displayName || user.username}`, // BaÅŸlÄ±k: GÃ¶nderen ismi
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `${t('new_comment_task') || "GÃ¶rev yorumu"}: ${taskCommentInput.trim()}`, // Ä°Ã§erik
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { type: 'task_comment', taskId: selectedTask.id } // Data
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  setTaskCommentInput("");Â 
Â  Â  } catch (e: any) {
Â  Â  Â  Â  console.error("Yorum GÃ¶nderme HatasÄ±:", e);
Â  Â  Â  Â  showToast(t('warning_title'), "Mesaj gÃ¶nderilemedi: " + e.message, 'error');
Â  Â  }
};
Â  // --- GRUP ALIÅžKANLIKLARINI DÄ°NLEME ---
Â  useEffect(() => {
Â  Â  if (!user) return;

Â  Â  // 'members' dizisinde benim ID'm geÃ§en gruplarÄ± getir
Â  Â  const q = query(
Â  Â  Â  collection(db, "habit_groups"),
Â  Â  Â  where("members", "array-contains", user.uid)
Â  Â  );

Â  Â  const unsubscribe = onSnapshot(q, async (snapshot) => {
Â  Â  Â  const fetchedGroups = await Promise.all(snapshot.docs.map(async (docSnap) => {
Â  Â  Â  Â  const data = docSnap.data();
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Ãœye detaylarÄ±nÄ± (FotoÄŸraf, Ä°sim) Ã§ekelim ki UI'da gÃ¶sterebilelim
Â  Â  Â  Â  // (Bunu her render'da yapmak yerine cache mantÄ±ÄŸÄ± kurulabilir ama ÅŸimdilik bÃ¶yle yapalÄ±m)
Â  Â  Â  Â  const memberDetails = await Promise.all(data.members.map(async (memberUid: string) => {
Â  Â  Â  Â  Â  Â  // Ã–nce kendi listemizdeki contact'lara bakalÄ±m
Â  Â  Â  Â  Â  Â  const contact = contacts.find(c => c.uid === memberUid);
Â  Â  Â  Â  Â  Â  if (contact) return { uid: memberUid, displayName: contact.displayName, photoURL: contact.photoURL };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Ben isem
Â  Â  Â  Â  Â  Â  if (memberUid === user.uid) return { uid: user.uid, displayName: user.displayName, photoURL: user.photoURL };

Â  Â  Â  Â  Â  Â  // Listemizde yoksa (baÅŸka biri eklediyse) Public'ten Ã§ek
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const pubDoc = await getDoc(doc(db, "public_users", memberUid));
Â  Â  Â  Â  Â  Â  Â  Â  if (pubDoc.exists()) return pubDoc.data();
Â  Â  Â  Â  Â  Â  } catch(e) {}
Â  Â  Â  Â  Â  Â  return { uid: memberUid, displayName: "Ãœye", photoURL: null };
Â  Â  Â  Â  }));

Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  id: docSnap.id,
Â  Â  Â  Â  Â  ...data,
Â  Â  Â  Â  Â  memberDetails
Â  Â  Â  Â  } as GroupHabit;
Â  Â  Â  }));
Â  Â  Â Â 
Â  Â  Â  setGroupHabits(fetchedGroups);
Â  Â  });

Â  Â  return () => unsubscribe();
Â  }, [user, contacts]); // Contacts deÄŸiÅŸirse isimler gÃ¼ncellensin diye ekledik

Â  useEffect(() => {
Â  Â  const checkFirstLaunch = async () => {
Â  Â  Â  Â  const hasLaunched = await AsyncStorage.getItem("hasLaunched");
Â  Â  Â  Â  if (hasLaunched === null) {
Â  Â  Â  Â  Â  Â  setShowOnboarding(true);
Â  Â  Â  Â  Â  Â  await AsyncStorage.setItem("hasLaunched", "true");
Â  Â  Â  Â  }
Â  Â  };
Â  Â  checkFirstLaunch();
}, []);
Â  // --- APPLE LOGIN (GÃœNCELLENMÄ°Åž) ---
Â  const handleAppleLogin = async () => {
Â  Â  try {
Â  Â  Â  // 1. Ä°ÅŸlem baÅŸladÄ±ÄŸÄ±nÄ± kullanÄ±cÄ±ya hissettir
Â  Â  Â  setIsAuthLoading(true);

Â  Â  Â  // 2. Apple Native Penceresini AÃ§
Â  Â  Â  const credential = await AppleAuthentication.signInAsync({
Â  Â  Â  Â  requestedScopes: [
Â  Â  Â  Â  Â  AppleAuthentication.AppleAuthenticationScope.FULL_NAME,
Â  Â  Â  Â  Â  AppleAuthentication.AppleAuthenticationScope.EMAIL,
Â  Â  Â  Â  ],
Â  Â  Â  });

Â  Â  Â  console.log("Apple Credential AlÄ±ndÄ±:", credential); // Konsoldan takip et

Â  Â  Â  const { identityToken } = credential;
Â  Â  Â Â 
Â  Â  Â  if (identityToken) {
Â  Â  Â  Â  // 3. Firebase ile BaÄŸlantÄ± Kur
Â  Â  Â  Â  const provider = new OAuthProvider('apple.com');
Â  Â  Â  Â  const oAuthCredential = provider.credential({ idToken: identityToken });
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Bu iÅŸlem baÅŸarÄ±lÄ± olursa, useEffect'teki onAuthStateChanged tetiklenir ve sayfayÄ± yÃ¶nlendirir.
Â  Â  Â  Â  await signInWithCredential(auth, oAuthCredential);
Â  Â  Â  Â  console.log("Firebase Apple GiriÅŸi BaÅŸarÄ±lÄ±!");
Â  Â  Â  } else {
Â  Â  Â  Â  throw new Error("Apple Identity Token alÄ±namadÄ±.");
Â  Â  Â  }

Â  Â  } catch (e: any) {
Â  Â  Â  setIsAuthLoading(false); // Hata olursa loading'i kapat
Â  Â  Â  console.error("Apple Login HatasÄ±:", e);

Â  Â  Â  // KullanÄ±cÄ± vazgeÃ§tiyse hata gÃ¶sterme
Â  Â  Â  if (e.code === 'ERR_CANCELED') {
Â  Â  Â  Â  Â  console.log("KullanÄ±cÄ± giriÅŸi iptal etti.");
Â  Â  Â  } else {
Â  Â  Â  Â  Â  // GerÃ§ek hatayÄ± ekrana bas
Â  Â  Â  Â  Â  showToast(t('warning_title'), t('apple_login_failed') + e.message, 'error');
Â  Â  Â  }
Â  Â  }
Â  };
Â  // --- MÄ°SAFÄ°R UYARISI ---
Â  const checkGuest = (actionName: string) => {
Â  if (user && user.isAnonymous) {
Â  Â  askConfirmation(
Â  Â  Â  t('auth_guest_title') || t('auth_guest_title'),
Â  Â  Â  tFormat('feature_login_required', { actionName: 'Mesaj GÃ¶nderme' }),
Â  Â  Â  handleLogout // Onayla'ya basÄ±nca Ã§Ä±kÄ±ÅŸ yapar (KayÄ±t ekranÄ±na dÃ¶ner)
Â  Â  );
Â  Â  return true; // Ä°ÅŸlemi durdurur
Â  }
Â  return false;
};

Â  // --- MÄ°SAFÄ°R GÄ°RÄ°ÅžÄ° ---
Â  // --- MÄ°SAFÄ°R GÄ°RÄ°ÅžÄ° ---
Â  const handleGuestLogin = async () => {
Â  Â  // 1. Loading baÅŸlat
Â  Â  setIsAuthLoading(true);
Â  Â  console.log("Misafir giriÅŸi baÅŸlatÄ±lÄ±yor...");

Â  Â  try {
Â  Â  Â  // 2. Firebase Anonim GiriÅŸ Ä°steÄŸi
Â  Â  Â  const userCredential = await signInAnonymously(auth);
Â  Â  Â  const guestUser = userCredential.user;
Â  Â  Â Â 
Â  Â  Â  console.log("Misafir giriÅŸi baÅŸarÄ±lÄ±, ID:", guestUser.uid);

Â  Â  Â  // 3. VeritabanÄ±na kayÄ±t (Hata alsa bile giriÅŸ baÅŸarÄ±lÄ± sayÄ±lsÄ±n diye try-catch iÃ§inde)
Â  Â  Â  try {
Â  Â  Â  Â  Â  await setDoc(doc(db, "users", guestUser.uid), {
Â  Â  Â  Â  Â  Â  uid: guestUser.uid,
Â  Â  Â  Â  Â  Â  username: "misafir_" + Math.floor(Math.random() * 100000),
Â  Â  Â  Â  Â  Â  displayName: "Misafir KullanÄ±cÄ±",
Â  Â  Â  Â  Â  Â  createdAt: serverTimestamp(),
Â  Â  Â  Â  Â  Â  categories: [
Â  Â  Â  Â  Â  Â  Â  { id: 'work', name: 'Ä°ÅŸ', color: 'blue' },
Â  Â  Â  Â  Â  Â  Â  { id: 'home', name: 'Ev', color: 'orange' },
Â  Â  Â  Â  Â  Â  Â  { id: 'personal', name: 'KiÅŸisel', color: 'green' }
Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  isGuest: true
Â  Â  Â  Â  Â  });
Â  Â  Â  } catch (dbError) {
Â  Â  Â  Â  Â  console.log("VeritabanÄ± oluÅŸturma hatasÄ± (Ã–nemli deÄŸil, giriÅŸ yapÄ±ldÄ±):", dbError);
Â  Â  Â  }

Â  Â  Â  // BaÅŸarÄ±lÄ± olduÄŸunda useEffect'teki onAuthStateChanged tetiklenecek ve sayfayÄ± aÃ§acaktÄ±r.

Â  Â  } catch (error: any) {
Â  Â  Â  console.error("Misafir GiriÅŸ HatasÄ±:", error);
Â  Â  Â Â 
Â  Â  Â  let errorMsg = error.message;
Â  Â  Â  if (error.code === 'auth/operation-not-allowed') {
Â  Â  Â  Â  Â  errorMsg = "Firebase konsolundan 'Anonymous' giriÅŸi aÃ§Ä±lmamÄ±ÅŸ.";
Â  Â  Â  } else if (error.code === 'auth/network-request-failed') {
Â  Â  Â  Â  Â  errorMsg = "Ä°nternet baÄŸlantÄ±nÄ±zÄ± kontrol edin.";
Â  Â  Â  }

Â  Â  Â  showToast(t('login_error'), errorMsg, 'error');
Â  Â  } finally {
Â  Â  Â  // 4. Ä°ÅŸlem bitti, loading'i kapat
Â  Â  Â  setIsAuthLoading(false);
Â  Â  }
Â  };
Â  Â  // --- MEVCUT useEffect'LERÄ°N ALTINA EKLE ---

Â  // Dil deÄŸiÅŸtiÄŸinde Takvim dilini de otomatik gÃ¼ncelle
Â  useEffect(() => {
Â  Â  Â  // EÄŸer seÃ§ilen dil (Ã¶rn: 'ja', 'uk') config dosyasÄ±nda tanÄ±mlÄ±ysa onu yap
Â  Â  Â  if (LocaleConfig.locales[lang]) {
Â  Â  Â  Â  Â  LocaleConfig.defaultLocale = lang;
Â  Â  Â  } else {
Â  Â  Â  Â  Â  // TanÄ±mlÄ± deÄŸilse (garanti olsun diye) Ä°ngilizce yap
Â  Â  Â  Â  Â  LocaleConfig.defaultLocale = 'en';
Â  Â  Â  }
Â  }, [lang]); // 'lang' deÄŸiÅŸtiÄŸinde bu kod Ã§alÄ±ÅŸÄ±r

Â  // -------------------------------------------
Â  // --- EFFECT: AUTH & DATA ---
// --- GÃœNCELLENMÄ°Åž AUTH & VERÄ° Ã‡EKME KODU ---
Â  // --- AUTH & USER DATA LISTENER (DÃœZELTÄ°LMÄ°Åž HALÄ°) ---
Â  useEffect(() => {
Â  Â  const checkPersistence = async () => {
Â  Â  Â  Â  // KullanÄ±cÄ± daha Ã¶nce "Beni HatÄ±rla"yÄ± kapattÄ±ysa, aÃ§Ä±lÄ±ÅŸta Ã§Ä±kÄ±ÅŸ yap
Â  Â  Â  Â  const shouldRemember = await AsyncStorage.getItem("ommio_remember_me");
Â  Â  Â  Â  if (shouldRemember === "false") {
Â  Â  Â  Â  Â  Â  await signOut(auth);
Â  Â  Â  Â  }
Â  Â  };
Â  Â  checkPersistence();
Â  Â  const unsubAuth = onAuthStateChanged(auth, async (currentUser) => {
Â  Â  Â  if (currentUser) {
Â  Â  Â  Â  // 1. Auth objesini baÅŸlangÄ±Ã§ olarak ayarla
Â  Â  Â  Â  // Not: user.delete() gibi fonksiyonlarÄ±n Ã§alÄ±ÅŸmasÄ± iÃ§in currentUser'Ä± yayÄ±yoruz.
Â  Â  Â  Â  setUser(currentUser);Â 
Â  Â  Â  Â  setIsAuthLoading(false);
Â  Â  Â  Â  registerForPushNotificationsAsync().then(async (token) => {
Â  Â  Â  Â  if (token) {
Â  Â  Â  Â  Â  Â  // Token'Ä± kullanÄ±cÄ±nÄ±n dokÃ¼manÄ±na kaydet
Â  Â  Â  Â  Â  Â  await setDoc(doc(db, "users", currentUser.uid), { pushToken: token }, { merge: true });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Public Users'a da kaydet (BaÅŸkalarÄ± bize mesaj atabilsin diye)
Â  Â  Â  Â  Â  Â  // NOT: Public Users koleksiyonunda olup olmadÄ±ÄŸÄ±nÄ±zÄ± kontrol edin, yoksa oluÅŸturun.
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â await setDoc(doc(db, "public_users", currentUser.uid), { pushToken: token }, { merge: true });
Â  Â  Â  Â  Â  Â  } catch(e) {}
Â  Â  Â  Â  }
Â  Â  Â  Â  generateAndStoreKeys(currentUser.uid);
Â  Â  });

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  const userDocRef = doc(db, "users", currentUser.uid);

Â  Â  Â  Â  Â  // 2. VeritabanÄ±nÄ± CanlÄ± Dinle (onSnapshot)
Â  Â  Â  Â  Â  const unsubDb = onSnapshot(userDocRef, (docSnap) => {
Â  Â  Â  Â  Â  Â  if (docSnap.exists()) {
Â  Â  Â  Â  Â  Â  Â  const userData = docSnap.data();
Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  // BURASI Ã–NEMLÄ°: VeritabanÄ±ndan gelen TÃœM verileri (username, photoURL, categories vb.)
Â  Â  Â  Â  Â  Â  Â  // mevcut user state'inin Ã¼zerine yazÄ±yoruz.
Â  Â  Â  Â  Â  Â  Â  setUser((prev: any) => ({
Â  Â  Â  Â  Â  Â  Â  Â  ...prev, Â  Â  Â  // Auth'dan gelen temel bilgiler ve metotlar korunsun
Â  Â  Â  Â  Â  Â  Â  Â  ...userData Â  Â // Firestore'dan gelen gÃ¼ncel username, photoURL, vb. Ã¼zerine yazÄ±lsÄ±n
Â  Â  Â  Â  Â  Â  Â  }));
Â  Â  Â  Â  Â  Â  Â  if (userData.hasSeenOnboarding === false || userData.hasSeenOnboarding === undefined) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setShowOnboarding(true);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setShowOnboarding(false);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  // Premium bilgisini ayrÄ±ca state'e at
Â  Â  Â  Â  Â  Â  Â  setIsPremium(userData.isPremium || false);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // Cleanup (Component kapanÄ±rsa dinlemeyi durdur) iÃ§in array'e atÄ±labilirÂ 
Â  Â  Â  Â  Â  // ama ÅŸimdilik basit tutuyoruz.
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  console.log("Veri Ã§ekme hatasÄ±", e);
Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  setUser(null);
Â  Â  Â  Â  setIsAuthLoading(false);
Â  Â  Â  }
Â  Â  });

Â  Â  return () => unsubAuth();
Â  }, []);
Â Â 
Â  useEffect(() => { setInputStartDate(formatDateDDMMYYYY(selectedDate)); }, [selectedDate]);
Â  useEffect(() => {
Â  Â  const loadSettings = async () => {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const savedLang = await AsyncStorage.getItem("ommio_lang");
Â  Â  Â  Â  Â  Â  const savedTheme = await AsyncStorage.getItem("ommio_theme");
Â  Â  Â  Â  Â  Â  if (savedLang) setLang(savedLang as LangCode);
Â  Â  Â  Â  Â  Â  if (savedTheme) setTheme(savedTheme as ThemeMode);
Â  Â  Â  Â  } catch (e) {}
Â  Â  };
Â  Â  loadSettings();
Â  }, []);

Â  useEffect(() => {
Â  Â  const saveSettings = async () => {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  await AsyncStorage.setItem("ommio_lang", lang);
Â  Â  Â  Â  Â  Â  await AsyncStorage.setItem("ommio_theme", theme);
Â  Â  Â  Â  } catch (e) {}
Â  Â  };
Â  Â  saveSettings();
Â  }, [lang, theme]);

Â  // --- REKLAM TETÄ°KLEYÄ°CÄ° FONKSÄ°YON ---
Â  // --- REKLAM TETÄ°KLEYÄ°CÄ° ---
Â  const checkAdTrigger = (type: 'tasks' | 'habits' | 'assigned') => {
Â  Â  if (isPremium) return; // Premium ise hiÃ§ uÄŸraÅŸma

Â  Â  setAdCounters(prev => {
Â  Â  Â  const newVal = prev[type] + 1;
Â  Â  Â  if (newVal >= AD_THRESHOLDS[type]) {
Â  Â  Â  Â  // ReklamÄ± aÃ§madan Ã¶nce sayacÄ± 5'e sÄ±fÄ±rla
Â  Â  Â  Â  setAdCountdown(5);
Â  Â  Â  Â  setIsAdVisible(true);
Â  Â  Â  Â  return { ...prev, [type]: 0 };
Â  Â  Â  }
Â  Â  Â  return { ...prev, [type]: newVal };
Â  Â  });
Â  };

Â  // --- REKLAM GERÄ° SAYIM MANTIÄžI ---
Â  useEffect(() => {
Â  Â  let interval: NodeJS.Timeout;
Â  Â  if (isAdVisible && adCountdown > 0) {
Â  Â  Â  interval = setInterval(() => {
Â  Â  Â  Â  setAdCountdown((prev) => prev - 1);
Â  Â  Â  }, 1000);
Â  Â  }
Â  Â  return () => clearInterval(interval);
Â  }, [isAdVisible, adCountdown]);

Â  // --- ARKA PLAN ZAMANLAYICI (10 Dk) ---
Â  useEffect(() => {
Â  Â  if (!user || isPremium || isAdVisible) return;Â 
Â  Â  const timer = setInterval(() => {
Â  Â  Â  setAdCounters(prev => {
Â  Â  Â  Â  const newTime = prev.time + 1;
Â  Â  Â  Â  if (newTime >= AD_THRESHOLDS.time) {
Â  Â  Â  Â  Â  setAdCountdown(5); // SÃ¼reyi resetle
Â  Â  Â  Â  Â  setIsAdVisible(true);
Â  Â  Â  Â  Â  return { ...prev, time: 0 };
Â  Â  Â  Â  }
Â  Â  Â  Â  return { ...prev, time: newTime };
Â  Â  Â  });
Â  Â  }, 1000);
Â  Â  return () => clearInterval(timer);
Â  }, [user, isPremium, isAdVisible]);

Â  // --- EKSÄ°K OLAN PARÃ‡A: GELEN ARKADAÅžLIK Ä°STEKLERÄ°NÄ° DÄ°NLEME ---
Â  useEffect(() => {
Â  Â  if (!user) return;

Â  Â  // KullanÄ±cÄ±nÄ±n "friend_requests" koleksiyonunu dinle
Â  Â  const q = query(
Â  Â  Â  collection(db, "users", user.uid, "friend_requests"),
Â  Â  Â  orderBy("createdAt", "desc") // En yeni istek en Ã¼stte gÃ¶rÃ¼nsÃ¼n
Â  Â  );

Â  Â  const unsubscribe = onSnapshot(q, (snapshot) => {
Â  Â  Â  const requests = snapshot.docs.map((doc) => ({
Â  Â  Â  Â  id: doc.id,
Â  Â  Â  Â  ...doc.data(),
Â  Â  Â  })) as FriendRequest[];
Â  Â  Â Â 
Â  Â  Â  console.log("Gelen Ä°stekler:", requests); // Konsoldan kontrol etmek iÃ§in
Â  Â  Â  setFriendRequests(requests);
Â  Â  });

Â  Â  return () => unsubscribe();
Â  }, [user]);

Â  // 1. GÃ–REVLERÄ° DÄ°NLEME (Tasks Listener) // --- CONTACTS GÃœNCELLEME MANTIÄžI (FOTOÄžRAFLARI CANLI TUTAR) ---
Â  // --- EKSÄ°K OLAN KISIM BAÅžLANGICI ---
Â  useEffect(() => {
Â  Â  if (!user) return;

Â  Â  // KullanÄ±cÄ±nÄ±n "tasks" koleksiyonunu oluÅŸturulma tarihine gÃ¶re dinle
Â  Â  const q = query(
Â  Â  Â  collection(db, "users", user.uid, "tasks"),
Â  Â  Â  orderBy("createdAt", "desc")Â 
Â  Â  );

Â  Â  const unsubscribe = onSnapshot(q, (snapshot) => {
Â  Â  Â  const fetchedTasks = snapshot.docs.map((doc) => ({
Â  Â  Â  Â  id: doc.id,
Â  Â  Â  Â  ...doc.data(),
Â  Â  Â  }))as Task[];
Â  Â  Â  setTasks(fetchedTasks);
Â  Â  });

Â  Â  return () => unsubscribe();
Â  }, [user]);

Â  // 2. ALIÅžKANLIKLARI DÄ°NLEME (Habits Listener)
Â  useEffect(() => {
Â  Â  if (!user) return;

Â  Â  // KullanÄ±cÄ±nÄ±n "habits" koleksiyonunu dinle
Â  Â  const q = query(
Â  Â  Â  collection(db, "users", user.uid, "habits"),
Â  Â  Â  orderBy("createdAt", "desc")
Â  Â  );

Â  Â  const unsubscribe = onSnapshot(q, (snapshot) => {
Â  Â  Â  const fetchedHabits = snapshot.docs.map((doc) => ({
Â  Â  Â  Â  id: doc.id,
Â  Â  Â  Â  ...doc.data(),
Â  Â  Â  }))as Habit[];
Â  Â  Â  setHabits(fetchedHabits);
Â  Â  });

Â  Â  return () => unsubscribe();
Â  }, [user]);

Â  // --- CONTACTS GÃœNCELLEME MANTIÄžI (Ä°SÄ°M, GÃ–RÃœNEN Ä°SÄ°M VE FOTOÄžRAF SENKRONÄ°ZASYONU) ---
// --- CONTACTS GÃœNCELLEME MANTIÄžI (FOTOÄžRAF, Ä°SÄ°M VE PUBLIC KEY SENKRONÄ°ZASYONU) ---
useEffect(() => {
Â  Â  if (!user) return;

Â  Â  const qContacts = query(collection(db, "users", user.uid, "contacts"));
Â  Â Â 
Â  Â  const unsubC = onSnapshot(qContacts, async (snap) => {
Â  Â  Â  Â  const localContacts = snap.docs.map(d => d.data() as Contact);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Her arkadaÅŸÄ±n GÃœNCEL bilgilerini Public tablodan Ã§ekiyoruz
Â  Â  Â  Â  const syncedContacts = await Promise.all(localContacts.map(async (contact) => {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const publicDoc = await getDoc(doc(db, "public_users", contact.uid));
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (publicDoc.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const pData = publicDoc.data();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...contact,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // EÄŸer arkadaÅŸÄ±n displayName'i varsa onu al, yoksa username'i kullan
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayName: pData.displayName || pData.username,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  username: pData.username || contact.username,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  photoURL: pData.photoURL || null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ðŸ‘‡ðŸ‘‡ðŸ‘‡ EKSÄ°K OLAN SATIR BUYDU ðŸ‘‡ðŸ‘‡ðŸ‘‡
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Åžifre Ã§Ã¶zmek iÃ§in karÅŸÄ± tarafÄ±n anahtarÄ±nÄ± mutlaka almalÄ±yÄ±z
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  publicKey: pData.publicKey || nullÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  // Public veri yoksa mevcut veriyi kullan
Â  Â  Â  Â  Â  Â  Â  Â  return { ...contact, displayName: contact.displayName || contact.username };Â 
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  return contact;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }));

Â  Â  Â  Â  setContacts(syncedContacts);
Â  Â  });

Â  Â  return () => unsubC();
}, [user]);
Â // --- CHAT Ã–NÄ°ZLEMELERÄ°NÄ° DÄ°NLEME (TYPESCRIPT DÃœZELTMELÄ°) ---
Â  // --- CHAT Ã–NÄ°ZLEMELERÄ°NÄ° DÄ°NLEME (TYPESCRIPT DÃœZELTÄ°LMÄ°Åž) ---
useEffect(() => {
Â  Â  if (!user || contacts.length === 0) return;

Â  Â  // HATA Ã‡Ã–ZÃœMÃœ 1: Dizinin tipini belirtiyoruz
Â  Â  const unsubscribers: (() => void)[] = [];

Â  Â  contacts.forEach(contact => {
Â  Â  Â  Â  const chatId = [user.uid, contact.uid].sort().join('_');
Â  Â  Â  Â Â 
Â  Â  Â  Â  // SÄ±ralama yapmadan Ã§ekiyoruz (Index hatasÄ± almamak iÃ§in)
Â  Â  Â  Â  const q = query(collection(db, "chats", chatId, "messages"));

Â  Â  Â  Â  const unsub = onSnapshot(q, (snapshot) => {
Â  Â  Â  Â  Â  Â  if (!snapshot.empty) {
Â  Â  Â  Â  Â  Â  Â  Â  const docs = snapshot.docs.map(doc => doc.data());
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Client-side sÄ±ralama
Â  Â  Â  Â  Â  Â  Â  Â  docs.sort((a, b) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const timeA = a.timestamp?.seconds || 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const timeB = b.timestamp?.seconds || 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return timeB - timeA;
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  const lastMsg = docs[0];
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // OkunmamÄ±ÅŸ mesaj sayÄ±sÄ± hesaplama
Â  Â  Â  Â  Â  Â  Â  Â  const unreadCount = docs.filter(d =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  d.senderId !== user.uid &&Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (d.read === false || d.read === undefined)
Â  Â  Â  Â  Â  Â  Â  Â  ).length;

Â  Â  Â  Â  Â  Â  Â  Â  // HATA Ã‡Ã–ZÃœMÃœ 2: prev parametresine 'any' tipi veriyoruz
Â  Â  Â  Â  Â  Â  Â  Â  setChatPreviews((prev: any) => ({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...prev,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [contact.uid]: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text: lastMsg.text,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: lastMsg.timestamp,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  unread: unreadCount // Bu deÄŸer UI'da kÄ±rmÄ±zÄ± balonu yakar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }));
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // HATA Ã‡Ã–ZÃœMÃœ 3: prev parametresine 'any' tipi veriyoruz
Â  Â  Â  Â  Â  Â  Â  Â  setChatPreviews((prev: any) => ({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...prev,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [contact.uid]: { text: t('no_message'), timestamp: null, unread: 0 }
Â  Â  Â  Â  Â  Â  Â  Â  }));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â  unsubscribers.push(unsub);
Â  Â  });

Â  Â  return () => {
Â  Â  Â  Â  unsubscribers.forEach(u => u());
Â  Â  };
}, [contacts, user]);

Â  // --- EFFECT: CHAT ---


Â  useEffect(() => {
Â  Â  // Sadece Android'de Ã§alÄ±ÅŸsÄ±n, Web veya iOS'ta hata vermesin
Â  Â  if (Platform.OS === 'android') {
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Verileri hazÄ±rla
Â  Â  Â  Â  const todayISO = getISODate(new Date());
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 1. BugÃ¼ne ait gÃ¶revleri filtrele
Â  Â  Â  Â  const todaysTasks = tasks.filter(t => {
Â  Â  Â  Â  Â  Â  Â if (t.date === todayISO) return true;
Â  Â  Â  Â  Â  Â  Â // Her gÃ¼n tekrar edenler vs.
Â  Â  Â  Â  Â  Â  Â if (t.showEveryDayUntilDue && t.dueDate) return todayISO >= t.date && todayISO <= convertDDMMYYYYtoISO(t.dueDate);
Â  Â  Â  Â  Â  Â  Â return false;
Â  Â  Â  Â  }).map(t => ({ text: t.text, completed: t.completed })); // Sadece gerekli veriyi al

Â  Â  Â  Â  // 2. BugÃ¼ne ait alÄ±ÅŸkanlÄ±klarÄ± filtrele
Â  Â  Â  Â  const todaysHabitsData = habits.filter(h => {
Â  Â  Â  Â  Â  Â  Â // Basit filtreleme (DetaylÄ± mantÄ±ÄŸÄ±nÄ±zÄ± buraya koyabilirsiniz)
Â  Â  Â  Â  Â  Â  Â if (h.frequency === 'daily') return true;
Â  Â  Â  Â  Â  Â  Â if (h.frequency === 'weekly') return h.selectedDays.includes(new Date().getDay());
Â  Â  Â  Â  Â  Â  Â return false;
Â  Â  Â  Â  }).map(h => ({Â 
Â  Â  Â  Â  Â  Â  title: h.title,Â 
Â  Â  Â  Â  Â  Â  completed: h.completedDates.includes(todayISO)Â 
Â  Â  Â  Â  }));

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  // @ts-ignore
Â  Â  Â  Â  Â  Â  requestWidgetUpdate({
Â  Â  Â  Â  Â  Â  Â  Â  widgetName: 'OmmioWidget',
Â  Â  Â  Â  Â  Â  Â  Â  renderWidget: () => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <WidgetTaskHandlerÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tasks={todaysTasks}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  habits={todaysHabitsData}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  ),
Â  Â  Â  Â  Â  Â  Â  Â  widgetNotFound: () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Widget ana ekrana eklenmemiÅŸ.");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.log("Widget gÃ¼ncelleme hatasÄ±:", e);
Â  Â  Â  Â  }
Â  Â  }
}, [tasks, habits]); // Tasks VEYA Habits deÄŸiÅŸtiÄŸinde Ã§alÄ±ÅŸÄ±r

Â  const t = (key: string) => {
Â  Â  // @ts-ignore
Â  Â  return TRANSLATIONS[lang]?.[key] || TRANSLATIONS['en']?.[key] || key;
Â  };
Â  Â  const tFormat = (key: string, params: Record<string, string | number>) => {
Â  Â  Â  Â  let text = t(key);
Â  Â  Â  Â  Object.entries(params).forEach(([k, v]) => {
Â  Â  Â  Â  Â  Â  text = text.replace(`{{${k}}}`, String(v));
Â  Â  Â  Â  });
Â  Â  Â  Â  return text;
Â  Â  };
Â  // --- FONKSÄ°YONLAR ---
Â  // --- ARKADAÅž SÄ°LME ---
Â  const handleRemoveFriend = async (targetUid: string, targetName: string) => {
Â  Â  // Ã–nce kullanÄ±cÄ±dan onay alalÄ±m
Â  Â  askConfirmation(
Â  Â  Â  Â  t('remove_friend'),
Â  Â  Â  Â  Â tFormat('friend_remove_confirm', { targetName }),
Â  Â  Â  Â  async () => {
Â  Â  Â  Â  Â  Â  Â try {
Â  Â  Â  Â  Â  Â  Â  Â  Â // Promise.all ile Ä°KÄ° TARAFTAN DA aynÄ± anda siliyoruz
Â  Â  Â  Â  Â  Â  Â  Â  Â await Promise.all([
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // 1. Benim listemden sil
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â deleteDoc(doc(db, "users", user.uid, "contacts", targetUid)),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // 2. KarÅŸÄ± tarafÄ±n listesinden beni sil
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â deleteDoc(doc(db, "users", targetUid, "contacts", user.uid))
Â  Â  Â  Â  Â  Â  Â  Â  Â ]);

Â  Â  Â  Â  Â  Â  Â  Â  Â showToast(t('success'), tFormat('friend_removed', { targetName }), 'success');
Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â // State'i (EkranÄ±) gÃ¼ncellememiz lazÄ±m ki hemen kaybolsun
Â  Â  Â  Â  Â  Â  Â  Â  Â // (Firestore listener'Ä± bazen gecikebilir, bu satÄ±r anlÄ±k tepki verir)
Â  Â  Â  Â  Â  Â  Â  Â  Â setContacts(prev => prev.filter(c => c.uid !== targetUid));

Â  Â  Â  Â  Â  Â  Â } catch(e: any) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â console.log(e);
Â  Â  Â  Â  Â  Â  Â  Â  Â showToast(t('warning_title'), t('delete_incomplete') + e.message, 'error');
Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  },
Â  Â  Â  Â  true // KÄ±rmÄ±zÄ± buton (Tehlikeli iÅŸlem)
Â  Â  );
};
// --- MÄ°SAFÄ°R HESABINI KALICI HESABA Ã‡EVÄ°RME ---
const handleConvertGuest = async () => {
Â  Â  // 1. Validasyonlar
Â  Â  if (!username.trim()) {
Â  Â  Â  Â  showToast(t('missing_info'), t('auth_username_required'), 'warning');
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  if (!email.includes('@') || !email.includes('.')) {
Â  Â  Â  Â  showToast(t('missing_info'), t('enter_valid_email'), 'warning');
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  if (password.length < 6) {
Â  Â  Â  Â  showToast(t('missing_info'), t('password_min_length'), 'warning');
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  // --- HATA Ã‡Ã–ZÃœMÃœ: KULLANICI KONTROLÃœ ---
Â  Â  if (!auth.currentUser) {
Â  Â  Â  Â  showToast(t('warning_title'), t('session_not_found'), 'error');
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  // ---------------------------------------

Â  Â  setIsAuthLoading(true);

Â  Â  try {
Â  Â  Â  Â  // 2. KullanÄ±cÄ± AdÄ± KontrolÃ¼
Â  Â  Â  Â  const cleanUsername = username.trim().toLowerCase()
Â  Â  Â  Â  Â  Â  .replace(/\s+/g, '')
Â  Â  Â  Â  Â  Â  .replace(/ÄŸ/g, 'g').replace(/Ã¼/g, 'u').replace(/ÅŸ/g, 's')
Â  Â  Â  Â  Â  Â  .replace(/Ä±/g, 'i').replace(/Ã¶/g, 'o').replace(/Ã§/g, 'c');

Â  Â  Â  Â  const q = query(collection(db, "public_users"), where("username", "==", cleanUsername));
Â  Â  Â  Â  const checkUser = await getDocs(q);
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (!checkUser.empty) {
Â  Â  Â  Â  Â  Â  setIsAuthLoading(false);
Â  Â  Â  Â  Â  Â  showToast(t('warning_title'), t('profile_username_taken'), 'warning');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  // 3. HESAP BAÄžLAMA Ä°ÅžLEMÄ°
Â  Â  Â  Â  const credential = EmailAuthProvider.credential(email, password);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // HATA Ã‡Ã–ZÃœMÃœ: ArtÄ±k auth.currentUser'Ä±n null olmadÄ±ÄŸÄ±nÄ± garanti ettiÄŸimiz iÃ§in hata vermez.
Â  Â  Â  Â  const userCredential = await linkWithCredential(auth.currentUser, credential);
Â  Â  Â  Â  const linkedUser = userCredential.user;

Â  Â  Â  Â  // 4. Firestore Verilerini GÃ¼ncelleme
Â  Â  Â  Â  const updates = {
Â  Â  Â  Â  Â  Â  username: cleanUsername,
Â  Â  Â  Â  Â  Â  displayName: username,
Â  Â  Â  Â  Â  Â  email: email,
Â  Â  Â  Â  Â  Â  isGuest: false,
Â  Â  Â  Â  Â  Â  categories: categoriesÂ 
Â  Â  Â  Â  };

Â  Â  Â  Â  await setDoc(doc(db, "users", linkedUser.uid), updates, { merge: true });

Â  Â  Â  Â  await setDoc(doc(db, "public_users", linkedUser.uid), {
Â  Â  Â  Â  Â  Â  uid: linkedUser.uid,
Â  Â  Â  Â  Â  Â  username: cleanUsername,
Â  Â  Â  Â  Â  Â  displayName: username,
Â  Â  Â  Â  Â  Â  photoURL: nullÂ 
Â  Â  Â  Â  });

Â  Â  Â  Â  await setDoc(doc(db, "usernames", cleanUsername), {
Â  Â  Â  Â  Â  Â  email: email
Â  Â  Â  Â  });

Â  Â  Â  Â  // 5. BaÅŸarÄ±lÄ±
Â  Â  Â  Â  setIsAuthLoading(false);
Â  Â  Â  Â  // ModalÄ± kapatmak iÃ§in state'i false yapÄ±n (isGuestModalOpen varsa)
Â  Â  Â  Â  setIsGuestModalOpen(false);Â 
Â  Â  Â  Â  showToast(t('success'), t('account_created_success'), 'success');

Â  Â  } catch (error: any) {
Â  Â  Â  Â  setIsAuthLoading(false);
Â  Â  Â  Â  console.error("Link Error:", error);
Â  Â  Â  Â Â 
Â  Â  Â  Â  let msg = t('process_failed');
Â  Â  Â  Â  if (error.code === 'auth/email-already-in-use') {
Â  Â  Â  Â  Â  Â  msg = t('email_in_use');
Â  Â  Â  Â  } else if (error.code === 'auth/credential-already-linked') {
Â  Â  Â  Â  Â  Â  msg = t('account_already_linked');
Â  Â  Â  Â  } else if (error.code === 'auth/invalid-email') {
Â  Â  Â  Â  Â  Â  msg = t('invalid_email_again');
Â  Â  Â  Â  } else if (error.code === 'auth/weak-password') {
Â  Â  Â  Â  Â  Â  msg = t('weak_password');
Â  Â  Â  Â  }

Â  Â  Â  Â  showToast(t('error_title'), msg, 'error');
Â  Â  }
};
Â  // --- ENGELLEME (BasitÃ§e siliyoruz ama farklÄ± mesaj veriyoruz, istersen 'blocked' koleksiyonu yapabilirsin) ---
const handleBlockFriend = async (targetUid: string, targetName: string) => {
Â  Â  Â  askConfirmation(
Â  Â  Â  Â  Â  t('friend_block_title'),
Â  Â  Â  Â  Â  `${targetName} {t('block_user_confirm')}`,
Â  Â  Â  Â  Â  async () => {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // 1. ArkadaÅŸlÄ±ktan Ã§Ä±kar (Her iki taraftan)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, "users", user.uid, "contacts", targetUid));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, "users", targetUid, "contacts", user.uid));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // 2. Engellenenler listesine ekle (arrayUnion kullanÄ±yoruz)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, "users", user.uid), {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  blockedUsers: arrayUnion(targetUid)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(t('friend_block_title'), `${targetName} ${t('friend_blocked_success')}`, 'success');
Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // EÄŸer blockedUsers alanÄ± henÃ¼z yoksa hata verebilir, setDoc ile merge yapalÄ±m
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await setDoc(doc(db, "users", user.uid), { blockedUsers: [targetUid] }, { merge: true });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Tekrar silmeyi dene
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, "users", user.uid, "contacts", targetUid));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, "users", targetUid, "contacts", user.uid));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(t('friend_block_title'), `${targetName} ${t('friend_blocked_success')}`, 'success');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(t('error_title'), t('process_failed'), 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  true // KÄ±rmÄ±zÄ± buton
Â  Â  Â  );
Â  };
Â  const formatChatTime = (timestamp: any) => {
Â  Â  Â  if (!timestamp) return "";
Â  Â  Â  const date = new Date(timestamp.seconds * 1000);
Â  Â  Â  const now = new Date();
Â  Â  Â Â 
Â  Â  Â  // BugÃ¼n ise sadece saat
Â  Â  Â  if (date.toDateString() === now.toDateString()) {
Â  Â  Â  Â  Â  return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
Â  Â  Â  }
Â  Â  Â  // DÃ¼n veya daha eski ise tarih
Â  Â  Â  return date.toLocaleDateString([], { day: '2-digit', month: '2-digit' });
Â  };
Â  const sendMessage = async () => {
Â  Â  // 1. Validasyonlar
Â  Â  if (!chatInput.trim() || !chatTarget || !user) return;
Â  Â Â 
Â  Â  const chatId = [user.uid, chatTarget.uid].sort().join('_');
Â  Â  const plainText = chatInput;Â 
Â  Â  setChatInput(""); // Inputu hemen temizle

Â  Â  // ---------------------------------------------------------
Â  Â  // ADIM A: ANAHTARLARI BUL (Hem onun hem senin)
Â  Â  // ---------------------------------------------------------

Â  Â  // 1. KarÅŸÄ± TarafÄ±n Public Key'i
Â  Â  let targetPublicKey = chatTarget.publicKey;
Â  Â  if (!targetPublicKey) {
Â  Â  Â  Â  // EÄŸer sohbet listesinden gelmiyorsa veritabanÄ±ndan Ã§ek
Â  Â  Â  Â  const userDoc = await getDoc(doc(db, "public_users", chatTarget.uid));
Â  Â  Â  Â  if (userDoc.exists()) {
Â  Â  Â  Â  Â  Â  targetPublicKey = userDoc.data().publicKey;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // 2. Benim Public Key'im (Kendi kopyamÄ± ÅŸifrelemek iÃ§in)
Â  Â  let myPublicKey = user.publicKey;
Â  Â  if (!myPublicKey) {
Â  Â  Â  Â  Â // EÄŸer user state'inde yoksa veritabanÄ±ndan Ã§ek
Â  Â  Â  Â  Â const myDoc = await getDoc(doc(db, "public_users", user.uid));
Â  Â  Â  Â  Â if (myDoc.exists()) {
Â  Â  Â  Â  Â  Â  Â myPublicKey = myDoc.data().publicKey;
Â  Â  Â  Â  Â }
Â  Â  }

Â  Â  // ---------------------------------------------------------
Â  Â  // ADIM B: Ã‡Ä°FT ÅžÄ°FRELEME YAP (Sender Copy Metodu)
Â  Â  // ---------------------------------------------------------
Â  Â Â 
Â  Â  // VarsayÄ±lan olarak dÃ¼z metin (EÄŸer anahtar yoksa gÃ¼venlik aÃ§Ä±ÄŸÄ± olmasÄ±n diye ÅŸifresiz gider)
Â  Â  let messageForReceiver = plainText;Â 
Â  Â  let messageForMe = plainText; Â  Â  Â Â 

Â  Â  // 1. AlÄ±cÄ± iÃ§in ÅŸifrele (text alanÄ±na gidecek)
Â  Â  if (targetPublicKey) {
Â  Â  Â  Â  const encrypted = await encryptMessage(plainText, targetPublicKey);
Â  Â  Â  Â  if (encrypted) messageForReceiver = encrypted;
Â  Â  }

Â  Â  // 2. Kendim iÃ§in ÅŸifrele (senderCopy alanÄ±na gidecek)
Â  Â  if (myPublicKey) {
Â  Â  Â  Â  const encrypted = await encryptMessage(plainText, myPublicKey);
Â  Â  Â  Â  if (encrypted) messageForMe = encrypted;
Â  Â  }

Â  Â  // ---------------------------------------------------------
Â  Â  // ADIM C: VERÄ°TABANINA KAYDET
Â  Â  // ---------------------------------------------------------
Â  Â  await addDoc(collection(db, "chats", chatId, "messages"), {
Â  Â  Â  Â  text: messageForReceiver, Â  Â  Â  // AlÄ±cÄ±nÄ±n Ã§Ã¶zeceÄŸi ÅŸifre
Â  Â  Â  Â  senderCopy: messageForMe, Â  Â  Â  // Sizin Ã§Ã¶zeceÄŸiniz ÅŸifre
Â  Â  Â  Â  senderId: user.uid,
Â  Â  Â  Â  timestamp: serverTimestamp(),
Â  Â  Â  Â  read: falseÂ 
Â  Â  });

Â  Â  // ---------------------------------------------------------
Â  Â  // ADIM D: BÄ°LDÄ°RÄ°M GÃ–NDER (Opsiyonel)
Â  Â  // ---------------------------------------------------------
Â  Â  const targetPublicDoc = await getDoc(doc(db, "public_users", chatTarget.uid));
Â  Â  if (targetPublicDoc.exists()) {
Â  Â  Â  Â  const targetData = targetPublicDoc.data();
Â  Â  Â  Â  if (targetData.pushToken) {
Â  Â  Â  Â  Â  Â  // DÄ°KKAT: Bildirime ÅŸifreli metin gÃ¶ndermek yerine "Yeni Mesaj" yazmak
Â  Â  Â  Â  Â  Â  // veya dÃ¼z metni (plainText) gÃ¶ndermek tercih meselesidir.Â 
Â  Â  Â  Â  Â  Â  // GÃ¼venlik iÃ§in "Yeni bir mesajÄ±n var" yazdÄ±rÄ±yoruz.
Â  Â  Â  Â  Â  Â  await sendPushNotification(
Â  Â  Â  Â  Â  Â  Â  Â  targetData.pushToken,
Â  Â  Â  Â  Â  Â  Â  Â  `ðŸ’¬ ${user.displayName || user.username}`,
Â  Â  Â  Â  Â  Â  Â  Â  "ðŸ”’ Yeni ÅŸifreli mesaj",Â 
Â  Â  Â  Â  Â  Â  Â  Â  { type: 'message', senderId: user.uid }
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  }
Â  Â  }
};
Â  const handleDeleteChat = async () => {
Â  Â askConfirmation(
Â  Â  Â  Â  t('delete_chat'),
Â  Â  Â  Â  t('delete_chat_confirm'),Â 
Â  Â  Â  Â  Â async () => {
Â  Â  Â  Â  Â  Â  if (!user || !chatTarget) return;
Â  Â  Â  Â  Â  Â  const chatId = [user.uid, chatTarget.uid].sort().join('_');
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  // MesajlarÄ± tek tek sil (Firestore'da koleksiyonu tek seferde silemezsin)
Â  Â  Â  Â  Â  Â  Â  const q = query(collection(db, "chats", chatId, "messages"));
Â  Â  Â  Â  Â  Â  Â  const snapshot = await getDocs(q);
Â  Â  Â  Â  Â  Â  Â  const batchPromises = snapshot.docs.map(doc => deleteDoc(doc.ref));
Â  Â  Â  Â  Â  Â  Â  await Promise.all(batchPromises);
Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  setActiveTab('messages'); // Mesajlar sekmesine dÃ¶n
Â  Â  Â  Â  Â  Â  Â  setChatTarget(null);
Â  Â  Â  Â  Â  Â  Â  showToast(t('success'), t('chat_deleted'), 'success');
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  showToast(t('warning_title'), t('chat_delete_failed'), 'error');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  true // KÄ±rmÄ±zÄ± buton (isDestructive)
Â  Â  );
Â  };


// --- ÅžÄ°FRE DEÄžÄ°ÅžTÄ°RME FONKSÄ°YONU ---
Â  // --- ÅžÄ°FRE DEÄžÄ°ÅžTÄ°RME / OLUÅžTURMA FONKSÄ°YONU ---
Â  // --- ÅžÄ°FRE SIFIRLAMA E-POSTASI GÃ–NDERME ---
Â  const handlePasswordChange = async () => {
Â  Â  Â  if (!user || !user.email) {
Â  Â  Â  Â  Â  showToast(t('error_title'), "E-posta adresi bulunamadÄ±.", 'error');
Â  Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  setIsAuthLoading(true);

Â  Â  Â  try {
Â  Â  Â  Â  Â  // Firebase'in ÅŸifre sÄ±fÄ±rlama mailini gÃ¶nder
Â  Â  Â  Â  Â  await sendPasswordResetEmail(auth, user.email);
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  showToast(t('success'), `Åžifre deÄŸiÅŸtirme baÄŸlantÄ±sÄ± ${user.email} adresine gÃ¶nderildi.`, 'success');
Â  Â  Â  Â  Â  setIsPasswordModalOpen(false); // ModalÄ± kapat

Â  Â  Â  } catch (error: any) {
Â  Â  Â  Â  Â  console.log(error);
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  let errorMsg = error.message;
Â  Â  Â  Â  Â  if (error.code === 'auth/too-many-requests') {
Â  Â  Â  Â  Â  Â  Â  errorMsg = "Ã‡ok sÄ±k istek gÃ¶nderdiniz, lÃ¼tfen biraz bekleyin.";
Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  showToast(t('error_title'), "Ä°ÅŸlem baÅŸarÄ±sÄ±z: " + errorMsg, 'error');
Â  Â  Â  } finally {
Â  Â  Â  Â  Â  setIsAuthLoading(false);
Â  Â  Â  }
Â  };
Â  Â  Â // Bu fonksiyonu mevcut handleAuth yerine yapÄ±ÅŸtÄ±rÄ±n
const handleAuth = async () => {
Â  Â  // 1. Girdileri Temizle
Â  Â  const inputVal = email.trim(); // Hem e-posta hem kullanÄ±cÄ± adÄ± olabilir
Â  Â  const cleanPassword = password.trim();

Â  Â  // --- LOGIN Ä°ÅžLEMÄ° ---
Â  Â  if (authMode === 'login') {
Â  Â  Â  Â  if (!inputVal || !cleanPassword) {
Â  Â  Â  Â  Â  Â  showToast(t('warning_title'), t('fill_all_fields'), 'warning');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  setIsAuthLoading(true);

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  let emailToLogin = inputVal;

Â  Â  Â  Â  Â  Â  // EÄžER GÄ°RÄ°LEN DEÄžER BÄ°R E-POSTA DEÄžÄ°LSE (Ä°Ã§inde @ yoksa), KULLANICI ADIDIR
Â  Â  Â  Â  Â  Â  if (!inputVal.includes('@')) {
Â  Â  Â  Â  Â  Â  Â  Â  // KullanÄ±cÄ± adÄ±nÄ± temizle (kÃ¼Ã§Ã¼k harf, boÅŸluksuz)
Â  Â  Â  Â  Â  Â  Â  Â  const cleanUsername = inputVal.toLowerCase()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .replace(/\s+/g, '')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .replace(/ÄŸ/g, 'g').replace(/Ã¼/g, 'u').replace(/ÅŸ/g, 's')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .replace(/Ä±/g, 'i').replace(/Ã¶/g, 'o').replace(/Ã§/g, 'c');

Â  Â  Â  Â  Â  Â  Â  Â  // --- GÃœVENLÄ° YÃ–NTEM ---
Â  Â  Â  Â  Â  Â  Â  Â  // Query yerine doÄŸrudan GET yapÄ±yoruz.
Â  Â  Â  Â  Â  Â  Â  Â  // 'usernames' koleksiyonunda ID'si bu kullanÄ±cÄ± adÄ± olan belgeyi Ã§ek
Â  Â  Â  Â  Â  Â  Â  Â  const usernameRef = doc(db, "usernames", cleanUsername);
Â  Â  Â  Â  Â  Â  Â  Â  const docSnap = await getDoc(usernameRef);

Â  Â  Â  Â  Â  Â  Â  Â  if (!docSnap.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error("USER_NOT_FOUND"); // BÃ¶yle bir kullanÄ±cÄ± adÄ± yok
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // E-postasÄ±nÄ± al
Â  Â  Â  Â  Â  Â  Â  Â  emailToLogin = docSnap.data().email;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Beni HatÄ±rla KontrolÃ¼
Â  Â  Â  Â  Â  Â  if (rememberMe) {
Â  Â  Â  Â  Â  Â  Â  Â  await AsyncStorage.setItem("ommio_remember_me", "true");
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  await AsyncStorage.setItem("ommio_remember_me", "false");
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Bulunan veya girilen E-posta ile giriÅŸ yap
Â  Â  Â  Â  Â  Â  await signInWithEmailAndPassword(auth, emailToLogin, cleanPassword);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // BaÅŸarÄ±lÄ± olursa useEffect'teki auth listener otomatik yÃ¶nlendirir, loading kapatmaya gerek yok.

Â  Â  Â  Â  } catch (e: any) {
Â  Â  Â  Â  Â  Â  setIsAuthLoading(false);
Â  Â  Â  Â  Â  Â  console.error("Login Error:", e);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let errorMsg = "GiriÅŸ baÅŸarÄ±sÄ±z.";
Â  Â  Â  Â  Â  Â  if (e.message === "USER_NOT_FOUND") errorMsg = t('username_not_found');
Â  Â  Â  Â  Â  Â  else if (e.code === 'auth/invalid-credential' || e.code === 'auth/wrong-password') errorMsg = "Åžifre veya kullanÄ±cÄ± bilgisi hatalÄ±.";
Â  Â  Â  Â  Â  Â  else if (e.code === 'auth/user-not-found') errorMsg = "KullanÄ±cÄ± bulunamadÄ±.";
Â  Â  Â  Â  Â  Â  else if (e.code === 'auth/too-many-requests') errorMsg = "Ã‡ok fazla deneme yaptÄ±nÄ±z, lÃ¼tfen bekleyin.";
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  showToast(t('error_title'), errorMsg, 'error');
Â  Â  Â  Â  }
Â  Â  }Â 
Â  Â  // --- KAYIT OLMA (SIGNUP) Ä°ÅžLEMÄ° ---
Â  Â  // --- MEVCUT handleAuth Ä°Ã‡Ä°NDEKÄ° else (SIGNUP) KISMINI BUNUNLA DEÄžÄ°ÅžTÄ°R ---
Â  Â  else {
Â  Â  Â  Â  // 1. KullanÄ±cÄ± AdÄ± KontrolÃ¼
Â  Â  Â  Â  if (!username.trim()) {
Â  Â  Â  Â  Â  Â  showToast(t('missing_info'), t('auth_username_required'), 'warning');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  // 2. SIKI E-POSTA FORMAT KONTROLÃœ (Regex)
Â  Â  Â  Â  if (!isValidEmail(inputVal)) {
Â  Â  Â  Â  Â  Â  Â showToast(t('error_title'), "LÃ¼tfen geÃ§erli bir e-posta adresi giriniz (Ã¶rn: isim@mail.com).", 'warning');
Â  Â  Â  Â  Â  Â  Â return;
Â  Â  Â  Â  }

Â  Â  Â  Â  if (!cleanPassword) {
Â  Â  Â  Â  Â  Â  showToast(t('missing_info'), t('enter_password'), 'warning');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  setIsAuthLoading(true);

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const cleanUsername = username.trim().toLowerCase()
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/\s+/g, '')
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/ÄŸ/g, 'g').replace(/Ã¼/g, 'u').replace(/ÅŸ/g, 's')
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/Ä±/g, 'i').replace(/Ã¶/g, 'o').replace(/Ã§/g, 'c');

Â  Â  Â  Â  Â  Â  // KullanÄ±cÄ± adÄ± daha Ã¶nce alÄ±nmÄ±ÅŸ mÄ± kontrol et
Â  Â  Â  Â  Â  Â  const q = query(collection(db, "public_users"), where("username", "==", cleanUsername));
Â  Â  Â  Â  Â  Â  const checkUser = await getDocs(q);
Â  Â  Â  Â  Â  Â  if(!checkUser.empty) {
Â  Â  Â  Â  Â  Â  Â  Â  setIsAuthLoading(false);
Â  Â  Â  Â  Â  Â  Â  Â  showToast("Hata", t('profile_username_taken'), 'warning');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // KayÄ±t Ä°ÅŸlemi
Â  Â  Â  Â  Â  Â  const cred = await createUserWithEmailAndPassword(auth, inputVal, cleanPassword);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // --- YENÄ° EKLENEN KISIM: DOÄžRULAMA MAÄ°LÄ° GÃ–NDERME ---
Â  Â  Â  Â  Â  Â  await sendEmailVerification(cred.user);
Â  Â  Â  Â  Â  Â  // -----------------------------------------------------

Â  Â  Â  Â  Â  Â  await updateProfile(cred.user, { displayName: username });

Â  Â  Â  Â  Â  Â  const userData = {
Â  Â  Â  Â  Â  Â  Â  Â  uid: cred.user.uid,
Â  Â  Â  Â  Â  Â  Â  Â  username: cleanUsername,
Â  Â  Â  Â  Â  Â  Â  Â  displayName: username,
Â  Â  Â  Â  Â  Â  Â  Â  email: inputVal,
Â  Â  Â  Â  Â  Â  Â  Â  createdAt: serverTimestamp(),
Â  Â  Â  Â  Â  Â  Â  Â  hasSeenOnboarding: false,
Â  Â  Â  Â  Â  Â  Â  Â  categories: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { id: 'work', name: 'Ä°ÅŸ', color: 'blue' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { id: 'home', name: 'Ev', color: 'orange' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { id: 'personal', name: 'KiÅŸisel', color: 'green' }
Â  Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  await setDoc(doc(db, "users", cred.user.uid), userData);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  await setDoc(doc(db, "public_users", cred.user.uid), {
Â  Â  Â  Â  Â  Â  Â  Â  uid: cred.user.uid,
Â  Â  Â  Â  Â  Â  Â  Â  username: cleanUsername,
Â  Â  Â  Â  Â  Â  Â  Â  originalUsername: username,
Â  Â  Â  Â  Â  Â  Â  Â  photoURL: null
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  await setDoc(doc(db, "usernames", cleanUsername), {
Â  Â  Â  Â  Â  Â  Â  Â  email: inputVal
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  setIsAuthLoading(false);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // KullanÄ±cÄ±ya bilgi ver
Â  Â  Â  Â  Â  Â  showToast(t('success'), "KayÄ±t baÅŸarÄ±lÄ±! LÃ¼tfen e-postanÄ±za gelen doÄŸrulama linkine tÄ±klayÄ±n.", 'success');

Â  Â  Â  Â  } catch (e: any) {
Â  Â  Â  Â  Â  Â  setIsAuthLoading(false);
Â  Â  Â  Â  Â  Â  console.error("Signup Error:", e);
Â  Â  Â  Â  Â  Â  let errorMsg = t('login_failed') || "GiriÅŸ baÅŸarÄ±sÄ±z.";

Â  Â  Â  Â  Â  Â  if (e.code === 'auth/wrong-password' || e.code === 'auth/invalid-credential') {
Â  Â  Â  Â  Â  Â  Â  Â  errorMsg = t('wrong_password_msg') || "GirdiÄŸiniz ÅŸifre hatalÄ±.";
Â  Â  Â  Â  Â  Â  } else if (e.message === "USER_NOT_FOUND" || e.code === 'auth/user-not-found') {
Â  Â  Â  Â  Â  Â  Â  Â  errorMsg = t('username_not_found') || "Bu kullanÄ±cÄ± adÄ± veya e-posta kayÄ±tlÄ± deÄŸil.";
Â  Â  Â  Â  Â  Â  } else if (e.code === 'auth/too-many-requests') {
Â  Â  Â  Â  Â  Â  Â  Â  errorMsg = t('too_many_requests') || "Ã‡ok fazla deneme yaptÄ±nÄ±z, lÃ¼tfen biraz bekleyin.";
Â  Â  Â  Â  Â  Â  } else if (e.code === 'auth/invalid-email') {
Â  Â  Â  Â  Â  Â  Â  Â  errorMsg = t('invalid_email') || "GeÃ§ersiz e-posta formatÄ±.";
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  showToast(t('error_title'), errorMsg, 'error');
Â  Â  Â  Â  }
Â  Â  } }

Â  const handleLogout = async () => { await signOut(auth); setTasks([]);Â 
Â  Â  if (Platform.OS === 'web') {
Â  Â  Â  Â  setShowAuth(false);
Â  Â  }
Â  };
Â Â 
const pickImage = async () => {
Â  Â  try {
Â  Â  Â  Â  console.log("Resim seÃ§me iÅŸlemi baÅŸladÄ±...");

Â  Â  Â  Â  // 1. Ä°zin Ä°ste
Â  Â  Â  Â  const permissionResult = await ImagePicker.requestMediaLibraryPermissionsAsync();
Â  Â  Â  Â  if (permissionResult.granted === false) {
Â  Â  Â  Â  Â  Â  showToast(t('permission_required'), t('profile_gallery_perm'), 'warning');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  // 2. Resmi SeÃ§
Â  Â  Â  Â  const result = await ImagePicker.launchImageLibraryAsync({
Â  Â  Â  Â  Â  Â  mediaTypes: ImagePicker.MediaTypeOptions.Images,
Â  Â  Â  Â  Â  Â  allowsEditing: true,
Â  Â  Â  Â  Â  Â  aspect: [1, 1],
Â  Â  Â  Â  Â  Â  quality: 1, // Buradaki kalite Ã¶nemli deÄŸil, aÅŸaÄŸÄ±da manipulator ile ayarlayacaÄŸÄ±z
Â  Â  Â  Â  });

Â  Â  Â  Â  if (!result.canceled && result.assets && result.assets.length > 0) {
Â  Â  Â  Â  Â  Â  const asset = result.assets[0];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  console.log("Resim seÃ§ildi, yeniden boyutlandÄ±rÄ±lÄ±yor...");

Â  Â  Â  Â  Â  Â  // --- 3. RESMÄ° KÃœÃ‡ÃœLTME (RESIZE) Ä°ÅžLEMÄ° ---
Â  Â  Â  Â  Â  Â  // GeniÅŸliÄŸi 500px yapÄ±yoruz, yÃ¼kseklik otomatik ayarlanÄ±yor.
Â  Â  Â  Â  Â  Â  // Bu iÅŸlem boyutu 50KB - 150KB arasÄ±na dÃ¼ÅŸÃ¼rÃ¼r.
Â  Â  Â  Â  Â  Â  const manipResult = await ImageManipulator.manipulateAsync(
Â  Â  Â  Â  Â  Â  Â  Â  asset.uri,
Â  Â  Â  Â  Â  Â  Â  Â  [{ resize: { width: 500 } }], // GeniÅŸliÄŸi 500px'e sabitle
Â  Â  Â  Â  Â  Â  Â  Â  {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  compress: 0.7, // Kalite %70 (Gayet yeterli)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  format: ImageManipulator.SaveFormat.JPEG,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  base64: true // Base64 verisini istiyoruz
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  const finalBase64 = `data:image/jpeg;base64,${manipResult.base64}`;

Â  Â  Â  Â  Â  Â  // Boyut KontrolÃ¼ (ArtÄ±k buraya takÄ±lmasÄ± imkansÄ±za yakÄ±n)
Â  Â  Â  Â  Â  Â  if (finalBase64.length > 1048487) {
Â  Â  Â  Â  Â  Â  Â  Â  showToast(t('file_too_large'), t('image_size_limit'), 'error');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 4. Kaydetme Ä°ÅŸlemleri
Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  await setDoc(doc(db, "users", user.uid), { photoURL: finalBase64 }, { merge: true });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await setDoc(doc(db, "public_users", user.uid), { photoURL: finalBase64 }, { merge: true });
Â  Â  Â  Â  Â  Â  } catch (e) {}

Â  Â  Â  Â  Â  Â  setUser({ ...user, photoURL: finalBase64 });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  showToast(t('premium_congrats'), t('profile_photo_updated'), 'success');
Â  Â  Â  Â  }
Â  Â  } catch (e: any) {
Â  Â  Â  Â  showToast(t('error'), "t('image_upload_failed')" + e.message, 'error');
Â  Â  }
Â  };
Â  // --- PROFÄ°L GÃœNCELLEME FONKSÄ°YONU ---
const handleUpdateProfile = async () => {
Â  Â  // 1. Girdileri Temizle
Â  Â  const cleanDisplayName = editDisplayNameInput.trim();
Â  Â Â 
Â  Â  // Username deÄŸiÅŸtiyse temizle, deÄŸiÅŸmediyse eskisini tut
Â  Â  const cleanUsername = editUsernameInput.trim().toLowerCase()
Â  Â  Â  Â  .replace(/\s+/g, '')
Â  Â  Â  Â  .replace(/ÄŸ/g, 'g').replace(/Ã¼/g, 'u').replace(/ÅŸ/g, 's')
Â  Â  Â  Â  .replace(/Ä±/g, 'i').replace(/Ã¶/g, 'o').replace(/Ã§/g, 'c');

Â  Â  // 2. Validasyon (Kontrol)
Â  Â  if (!cleanDisplayName) {
Â  Â  Â  Â  showToast(t('warning_title'), t('display_name_required'), 'warning');
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  if (cleanUsername.length < 3) {
Â  Â  Â  Â  showToast(t('warning_title'), t('profile_username_short'), 'warning');
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  // DeÄŸiÅŸiklik var mÄ± kontrolÃ¼? (Gereksiz yere veritabanÄ±nÄ± yormayalÄ±m)
Â  Â  const isNameChanged = cleanDisplayName !== user.displayName;
Â  Â  const isUsernameChanged = cleanUsername !== user.username;

Â  Â  if (!isNameChanged && !isUsernameChanged) {
Â  Â  Â  Â  setIsEditProfileVisible(false); // DeÄŸiÅŸiklik yoksa kapat
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  try {
Â  Â  Â  Â  // --- SENARYO A: Sadece GÃ¶rÃ¼nen Ä°sim DeÄŸiÅŸiyor (En kolayÄ±) ---
Â  Â  Â  Â  if (isNameChanged && !isUsernameChanged) {
Â  Â  Â  Â  Â  Â  Â // 1. Firebase Auth Profilini GÃ¼ncelle
Â  Â  Â  Â  Â  Â  Â if (auth.currentUser) {
Â  Â  Â  Â  Â  Â  Â  Â  await updateProfile(auth.currentUser, { displayName: cleanDisplayName });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 2. VeritabanlarÄ±nÄ± GÃ¼ncelle
Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, "users", user.uid), { displayName: cleanDisplayName });
Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, "public_users", user.uid), { displayName: cleanDisplayName });

Â  Â  Â  Â  Â  Â  // 3. State'i GÃ¼ncelle (AnlÄ±k deÄŸiÅŸim iÃ§in)
Â  Â  Â  Â  Â  Â  setUser((prev: any) => ({ ...prev, displayName: cleanDisplayName }));
Â  Â  Â  Â  Â  Â  showToast(t('success_label'), "Ä°sminiz gÃ¼ncellendi.", 'success');
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- SENARYO B: KullanÄ±cÄ± AdÄ± DeÄŸiÅŸiyor (Zor olan) ---
Â  Â  Â  Â  else if (isUsernameChanged) {
Â  Â  Â  Â  Â  Â  // BaÅŸkasÄ± almÄ±ÅŸ mÄ± kontrol et
Â  Â  Â  Â  Â  Â  const q = query(collection(db, "public_users"), where("username", "==", cleanUsername));
Â  Â  Â  Â  Â  Â  const check = await getDocs(q);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (!check.empty) {
Â  Â  Â  Â  Â  Â  Â  Â  showToast("Hata", t('profile_username_taken'), 'error');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // MÃ¼saitse gÃ¼ncelle (Hem isim hem username)
Â  Â  Â  Â  Â  Â  const updates = { username: cleanUsername, displayName: cleanDisplayName };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (auth.currentUser) await updateProfile(auth.currentUser, { displayName: cleanDisplayName });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, "users", user.uid), updates);
Â  Â  Â  Â  Â  Â  // Public tablosunda eski username ile olan kaydÄ± silip yenisini yaratmak daha gÃ¼venlidir ama update de Ã§alÄ±ÅŸÄ±r
Â  Â  Â  Â  Â  Â  // Biz burada merge ile update yapÄ±yoruz
Â  Â  Â  Â  Â  Â  await setDoc(doc(db, "public_users", user.uid), updates, { merge: true });

Â  Â  Â  Â  Â  Â  // State GÃ¼ncelle
Â  Â  Â  Â  Â  Â  setUser((prev: any) => ({ ...prev, ...updates }));
Â  Â  Â  Â  Â  Â  showToast(t('success_label'), "Profiliniz tamamen gÃ¼ncellendi.", 'success');
Â  Â  Â  Â  }

Â  Â  Â  Â  setIsEditProfileVisible(false); // ModalÄ± kapat

Â  Â  } catch (e: any) {
Â  Â  Â  Â  console.error(e);
Â  Â  Â  Â  showToast(t('error_title'), t('update_failed_generic'), 'error');
Â  Â  }
};

Â  const scheduleLocalNotification = async (title: string, body: string, timeString: string, type: 'notification' | 'alarm') => {
Â  Â  if (Platform.OS === 'web') return null;
Â  Â  const { status } = await Notifications.getPermissionsAsync();
Â  Â  if (status !== 'granted') {
Â  Â  Â  Â  // Ä°zin yoksa, kullanÄ±cÄ± o an talep ettiÄŸi iÃ§in Toast gÃ¶ster
Â  Â  Â  Â  showToast(t('permission_required'), t('notification_permission_required') || "Bildirimleri alabilmek iÃ§in ayarlardan izin vermelisiniz.", 'warning');
Â  Â  Â  Â  return null; // Bildirim kurmadan Ã§Ä±k
Â  Â  }
Â  Â Â 
Â  Â  try {
Â  Â  Â  Â  const [hours, minutes] = timeString.split(':').map(Number);
Â  Â  Â  Â  const triggerDate = new Date(selectedDate);
Â  Â  Â  Â  triggerDate.setHours(hours, minutes, 0, 0);

Â  Â  Â  Â  // Tarih geÃ§miÅŸteyse yarÄ±na kur (Ã–rn: Saat 14:00, kullanÄ±cÄ± 09:00'a alarm kurdu -> YarÄ±n 09:00)
Â  Â  Â  Â  if (triggerDate <= new Date()) {
Â  Â  Â  Â  Â  Â  triggerDate.setDate(triggerDate.getDate() + 1);
Â  Â  Â  Â  }

Â  Â  Â  Â  const id = await Notifications.scheduleNotificationAsync({
Â  Â  Â  Â  Â  Â  content: {
Â  Â  Â  Â  Â  Â  Â  Â  title: title,
Â  Â  Â  Â  Â  Â  Â  Â  body: body,
Â  Â  Â  Â  Â  Â  Â  Â  sound: true, // iOS iÃ§in standart ses
Â  Â  Â  Â  Â  Â  Â  Â  // Android iÃ§in Ã¶zel kanal (YÃ¼ksek Ã¶ncelikli)
Â  Â  Â  Â  Â  Â  Â  Â  color: type === 'alarm' ? COLORS.danger : COLORS.primary,
Â  Â  Â  Â  Â  Â  Â  Â  priority: Notifications.AndroidNotificationPriority.MAX,
Â  Â  Â  Â  Â  Â  Â  Â  data: { type: type },
Â  Â  Â  Â  Â  Â  Â  Â  // EÄŸer alarm ise Android'de Ã¶zel kanal kullan
Â  Â  Â  Â  Â  Â  Â  Â  ...(Platform.OS === 'android' && type === 'alarm' ? { channelId: 'alarm' } : {}),Â 
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  trigger: {Â 
Â  Â  Â  Â  Â  Â  Â  Â type: Notifications.SchedulableTriggerInputTypes.DATE, // Bu satÄ±r EKLENDÄ°
Â  Â  Â  Â  Â  Â  Â  Â date: triggerDateÂ 
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  });
Â  Â  Â  Â  return id;
Â  Â  } catch (e) {
Â  Â  Â  Â  console.log("Bildirim hatasÄ±:", e);
Â  Â  Â  Â  return null;
Â  Â  }
};

Â  Â  // --- DOSYA SEÃ‡ME ---
Â  const pickDocument = async () => {
Â  Â  try {
Â  Â  Â  const result = await DocumentPicker.getDocumentAsync({
Â  Â  Â  Â  type: '*/*', // TÃ¼m dosya tÃ¼rleri
Â  Â  Â  Â  copyToCacheDirectory: true,
Â  Â  Â  Â  multiple: true // Birden fazla seÃ§ime izin ver
Â  Â  Â  });

Â  Â  Â  if (!result.canceled && result.assets) {
Â  Â  Â  Â  // Mevcut listeye ekle
Â  Â  Â  Â  setAttachments(prev => [...prev, ...result.assets]);
Â  Â  Â  }
Â  Â  } catch (err) {
Â  Â  Â  console.log("Dosya seÃ§imi iptal veya hata:", err);
Â  Â  }
Â  };

Â  // --- DOSYA YÃœKLEME (Firebase Storage) ---
Â  const uploadFiles = async (taskId: string) => {
Â  Â  if (attachments.length === 0) return [];

Â  Â  const uploadedUrls = [];
Â  Â Â 
Â  Â  for (const file of attachments) {
Â  Â  Â  try {
Â  Â  Â  Â  const response = await fetch(file.uri);
Â  Â  Â  Â  const blob = await response.blob();
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Dosya yolu: task_attachments/taskId/dosyaAdi
Â  Â  Â  Â  const storageRef = ref(storage, `task_attachments/${taskId}/${file.name}`);
Â  Â  Â  Â Â 
Â  Â  Â  Â  await uploadBytes(storageRef, blob);
Â  Â  Â  Â  const downloadUrl = await getDownloadURL(storageRef);
Â  Â  Â  Â Â 
Â  Â  Â  Â  uploadedUrls.push({
Â  Â  Â  Â  Â  Â  name: file.name,
Â  Â  Â  Â  Â  Â  url: downloadUrl,
Â  Â  Â  Â  Â  Â  type: file.mimeType
Â  Â  Â  Â  });
Â  Â  Â  } catch (e) {
Â  Â  Â  Â  console.error("YÃ¼kleme hatasÄ±:", e);
Â  Â  Â  Â  showToast("Hata", `${file.name} yÃ¼klenemedi.`, 'error');
Â  Â  Â  }
Â  Â  }
Â  Â  return uploadedUrls;
Â  };

const addTask = async () => {
Â  Â  // 1. Validasyon
Â  Â  if (!inputValue.trim()) {
Â  Â  Â  Â  showToast(t('warning_title'), t('missing_info'), 'warning');
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  if (!user) return;

Â  Â  setIsAuthLoading(true);
Â  Â  // EÄŸer dosya varsa loading yazÄ±sÄ±nÄ± gÃ¼ncellemek istersen state kullanabilirsin
Â  Â  if(attachments.length > 0) setIsUploading(true);

Â  Â  try {
Â  Â  Â  Â  let finalStartDate = inputStartDate;
Â  Â  Â  Â  if (!finalStartDate || finalStartDate.length < 10) {
Â  Â  Â  Â  Â  Â  finalStartDate = formatDateDDMMYYYY(selectedDate);
Â  Â  Â  Â  }
Â  Â  Â  Â  const formattedStart = convertDDMMYYYYtoISO(finalStartDate);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- GEÃ‡Ä°CÄ° TASK ID OLUÅžTURMA (Dosyalar iÃ§in klasÃ¶r adÄ± olacak) ---
Â  Â  Â  Â  // Not: Firestore'a eklerken ID'yi manuel vereceÄŸiz veya doc.id kullanacaÄŸÄ±z.
Â  Â  Â  Â  // Burada basitÃ§e random bir ID Ã¼retiyoruz ki dosyalarÄ± yÃ¼kleyebilelim.
Â  Â  Â  Â  const tempTaskId = Math.random().toString(36).substring(2, 15);

Â  Â  Â  Â  // 2. Ã–NCE DOSYALARI YÃœKLE
Â  Â  Â  Â  let uploadedFiles: { name: string; url: string; type?: string }[] = [];
Â  Â  Â  Â  if (attachments.length > 0) {
Â  Â  Â  Â  Â  Â  uploadedFiles = await uploadFiles(tempTaskId);
Â  Â  Â  Â  }

Â  Â  Â  Â  // 3. ATAMA LÄ°STESÄ°NÄ° HAZIRLA
Â  Â  Â  Â  // EÄŸer kimse seÃ§ilmediyse, kendime ata.
Â  Â  Â  Â  // EÄŸer seÃ§ildiyse, seÃ§ilenleri listeye al.
Â  Â  Â  Â  let targetList = assignTargets.length > 0 ? assignTargets : [{ uid: user.uid, username: user.username, canAssignToMe: true } as Contact];

Â  Â  Â  Â  // 4. DÃ–NGÃœ: Her bir kiÅŸi iÃ§in gÃ¶revi oluÅŸtur
Â  Â  Â  Â  // Promise.all ile paralel yapÄ±yoruz ki hÄ±zlÄ± olsun
Â  Â  Â  Â  await Promise.all(targetList.map(async (target) => {
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Misafir / Ä°zin KontrolÃ¼ (BaÅŸkasÄ±ysa)
Â  Â  Â  Â  Â  Â  if (target.uid !== user.uid) {
Â  Â  Â  Â  Â  Â  Â  Â  // Burada detaylÄ± izin kontrolÃ¼ yapÄ±labilir
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Kategori belirle (Kendi varsayÄ±lanÄ± veya seÃ§ili olan)
Â  Â  Â  Â  Â  Â  let finalCategoryId = selectedCategory.id;
Â  Â  Â  Â  Â  Â  if (target.uid !== user.uid && target.defaultCategoryId) {
Â  Â  Â  Â  Â  Â  Â  Â  finalCategoryId = target.defaultCategoryId;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Bildirim/Alarm Sadece KENDÄ°ME atÄ±yorsam veya atanan kiÅŸi ben isem kurulur
Â  Â  Â  Â  Â  Â  // (BaÅŸkasÄ±na alarm kuramazsÄ±n, sadece push notification gider)
Â  Â  Â  Â  Â  Â  let notifId = null, alarmId = null;
Â  Â  Â  Â  Â  Â  if (target.uid === user.uid) {
Â  Â  Â  Â  Â  Â  Â  Â  Â if (isNotifOn && notifInput.length === 5) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  notifId = await scheduleLocalNotification(t('notification'), inputValue, notifInput, 'notification');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if (isAlarmOn && alarmInput.length === 5) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alarmId = await scheduleLocalNotification(t('alarm'), inputValue, alarmInput, t('alarm'));
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // GÃ¶rev Objesi
Â  Â  Â  Â  Â  Â  const newTaskData = {
Â  Â  Â  Â  Â  Â  Â  Â  text: inputValue,
Â  Â  Â  Â  Â  Â  Â  Â  description: inputDesc,
Â  Â  Â  Â  Â  Â  Â  Â  completed: false,
Â  Â  Â  Â  Â  Â  Â  Â  date: formattedStart,
Â  Â  Â  Â  Â  Â  Â  Â  dueDate: inputDueDate.length >= 10 ? inputDueDate : null,
Â  Â  Â  Â  Â  Â  Â  Â  showEveryDayUntilDue: isEveryDayOn,
Â  Â  Â  Â  Â  Â  Â  Â  categoryId: finalCategoryId,
Â  Â  Â  Â  Â  Â  Â  Â  priority: priority, // YENÄ°: Ã–ncelik
Â  Â  Â  Â  Â  Â  Â  Â  attachments: uploadedFiles, // YENÄ°: Dosyalar
Â  Â  Â  Â  Â  Â  Â  Â  assignedBy: user.uid,
Â  Â  Â  Â  Â  Â  Â  Â  assignedByName: user.displayName || user.username,
Â  Â  Â  Â  Â  Â  Â  Â  assignedTo: target.uid, // Bu kopya kime ait?
Â  Â  Â  Â  Â  Â  Â  Â  assignedToName: target.username || target.displayName,
Â  Â  Â  Â  Â  Â  Â  Â  isMultiAssigned: targetList.length > 1, // Ã‡oklu atama mÄ±?
Â  Â  Â  Â  Â  Â  Â  Â  createdAt: serverTimestamp(),
Â  Â  Â  Â  Â  Â  Â  Â  notificationId: notifId,
Â  Â  Â  Â  Â  Â  Â  Â  alarmId: alarmId,
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  // Kaydet
Â  Â  Â  Â  Â  Â  await addDoc(collection(db, "users", target.uid, "tasks"), newTaskData);

Â  Â  Â  Â  Â  Â  // Bildirim GÃ¶nder (EÄŸer baÅŸkasÄ±na atadÄ±ysam)
Â  Â  Â  Â  Â  Â  if (target.uid !== user.uid) {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const targetDoc = await getDoc(doc(db, "public_users", target.uid));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (targetDoc.exists() && targetDoc.data().pushToken) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â await sendPushNotification(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  targetDoc.data().pushToken,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  t('new_task_assigned'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `${user.displayName} sana bir gÃ¶rev atadÄ±: ${inputValue} (${t('priority_' + priority)})`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { type: 'task' }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch(e) {}
Â  Â  Â  Â  Â  Â  Â  Â  checkAdTrigger('assigned');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }));

Â  Â  Â  Â  // --- TEMÄ°ZLÄ°K ---
Â  Â  Â  Â  setIsAddModalOpen(false);
Â  Â  Â  Â  setInputValue("");
Â  Â  Â  Â  setInputDesc("");
Â  Â  Â  Â  setNotifInput("");
Â  Â  Â  Â  setAlarmInput("");
Â  Â  Â  Â  setAttachments([]); // DosyalarÄ± temizle
Â  Â  Â  Â  setAssignTargets([]); // SeÃ§ili kiÅŸileri temizle
Â  Â  Â  Â  setPriority('medium'); // Ã–nceliÄŸi sÄ±fÄ±rla
Â  Â  Â  Â  setIsInputExpanded(false);
Â  Â  Â  Â  Keyboard.dismiss();
Â  Â  Â  Â  showToast(t('success'), targetList.length > 1 ? "GÃ¶rev herkese atandÄ±." : t('task_added'), 'success');

Â  Â  } catch (error: any) {
Â  Â  Â  Â  console.error(error);
Â  Â  Â  Â  showToast(t('error_title'), error.message, 'error');
Â  Â  } finally {
Â  Â  Â  Â  setIsAuthLoading(false);
Â  Â  Â  Â  setIsUploading(false);
Â  Â  }
Â  };
Â const addHabit = async () => {
Â  Â  Â  // 1. GÄ°RÄ°Åž KONTROLÃœ
Â  Â  Â  if (!user) {
Â  Â  Â  Â  Â  showToast(t('error_title'), t('session_not_open'), 'error');
Â  Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // 2. BOÅž KONTROLÃœ
Â  Â  Â  if (!newHabitTitle.trim()) {
Â  Â  Â  Â  Â  showToast(t('warning_title'), t('missing_info'), 'warning');
Â  Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  try {
Â  Â  Â  Â  Â  const endDateISO = newHabitEndDate ? convertDDMMYYYYtoISO(newHabitEndDate) : null;
Â  Â  Â  Â  Â  let notificationIds: string[] = [];
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // Bildirim Kurma
Â  Â  Â  Â  Â  if (habitNotifInput.length === 5 && Platform.OS !== 'web') {
Â  Â  Â  Â  Â  Â  const { status } = await Notifications.getPermissionsAsync();
Â  Â  Â  Â  Â  Â  Â  if (status !== 'granted') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(t('permission_required'), "AlÄ±ÅŸkanlÄ±k hatÄ±rlatÄ±cÄ±larÄ± iÃ§in bildirim izni gerekli.", 'warning');
Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ä°zin yoksa bildirim kurmadan devam etsin mi yoksa dursun mu?Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  // Genelde kullanÄ±cÄ±yÄ± durdurmak iyidir ama kayÄ±t edip bildirim kurmamayÄ± da seÃ§ebilirsin.
Â  Â  Â  Â  Â  Â  Â  Â  Â  // AÅŸaÄŸÄ±daki 'return' eklenirse iÅŸlem durur, kaldÄ±rÄ±lÄ±rsa bildirim kurmadan kaydeder.
Â  Â  Â  Â  Â  Â  Â  Â  Â  return;Â 
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  const [hours, minutes] = habitNotifInput.split(':').map(Number);
Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  if (newHabitFreq === 'daily') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // @ts-ignore
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const id = await Notifications.scheduleNotificationAsync({Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content: { title: t('habits'), body: newHabitTitle, sound: true },Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  trigger: { hour: hours, minute: minutes, repeats: true, type: Notifications.SchedulableTriggerInputTypes.CALENDAR }Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  notificationIds.push(id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (newHabitFreq === 'weekly') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (const dayIndex of newHabitDays) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const expoWeekday = dayIndex + 1;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // @ts-ignore
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const id = await Notifications.scheduleNotificationAsync({Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content: { title: t('habits'), body: newHabitTitle, sound: true },Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  trigger: { weekday: expoWeekday, hour: hours, minute: minutes, repeats: true, type: Notifications.SchedulableTriggerInputTypes.CALENDAR }Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  notificationIds.push(id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  } catch(e) { console.log("Bildirim hatasÄ±:", e); }
Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  // 3. KAYIT
Â  Â  Â  Â  Â  await addDoc(collection(db, "users", user.uid, "habits"), {Â 
Â  Â  Â  Â  Â  Â  Â  title: newHabitTitle,Â 
Â  Â  Â  Â  Â  Â  Â  frequency: newHabitFreq,Â 
Â  Â  Â  Â  Â  Â  Â  selectedDays: newHabitDays,Â 
Â  Â  Â  Â  Â  Â  Â  endDate: endDateISO,Â 
Â  Â  Â  Â  Â  Â  Â  completedDates: [],Â 
Â  Â  Â  Â  Â  Â  Â  notificationTime: habitNotifInput,Â 
Â  Â  Â  Â  Â  Â  Â  notificationIds: notificationIds,Â 
Â  Â  Â  Â  Â  Â  Â  categoryId: selectedCategory.id,Â 
Â  Â  Â  Â  Â  Â  Â  createdAt: serverTimestamp()Â 
Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  // 4. TEMÄ°ZLÄ°K
Â  Â  Â  Â  Â  showToast(t('success'), t('all_good'), 'success');
Â  Â  Â  Â  Â  setIsAddModalOpen(false);
Â  Â  Â  Â  Â  setNewHabitTitle("");Â 
Â  Â  Â  Â  Â  setNewHabitFreq('daily');Â 
Â  Â  Â  Â  Â  setNewHabitDays([]);Â 
Â  Â  Â  Â  Â  setNewHabitEndDate("");Â 
Â  Â  Â  Â  Â  setHabitNotifInput("");

Â  Â  Â  } catch (error: any) {
Â  Â  Â  Â  Â  console.error("ADD HABIT ERROR:", error);
Â  Â  Â  Â  Â  showToast(t('error_title'), error.message, 'error');
Â  Â  Â  }
Â  };

Â  Â  Â  // --- GRUP OLUÅžTURMA ---
Â  Â  Â  const handleCreateGroup = async () => {
Â  Â  Â  Â  if (!newGroupTitle.trim()) {
Â  Â  Â  Â  Â  Â  showToast(t('warning_title'), "LÃ¼tfen grup adÄ± girin.", 'warning');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  if (selectedGroupMembers.length === 0) {
Â  Â  Â  Â  Â  Â  showToast(t('warning_title'), "En az bir arkadaÅŸ seÃ§melisin.", 'warning');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  setIsAuthLoading(true);
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  // Kendimi de Ã¼yelere ekle
Â  Â  Â  Â  Â  Â  const finalMembers = [user.uid, ...selectedGroupMembers];

Â  Â  Â  Â  Â  Â  await addDoc(collection(db, "habit_groups"), {
Â  Â  Â  Â  Â  Â  Â  Â  title: newGroupTitle,
Â  Â  Â  Â  Â  Â  Â  Â  createdBy: user.uid,
Â  Â  Â  Â  Â  Â  Â  Â  members: finalMembers,
Â  Â  Â  Â  Â  Â  Â  Â  completions: {}, // { "2023-10-20": ["uid1", "uid2"] } ÅŸeklinde tutacaÄŸÄ±z
Â  Â  Â  Â  Â  Â  Â  Â  createdAt: serverTimestamp()
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Bildirim GÃ¶nderme (SeÃ§ilen arkadaÅŸlara)
Â  Â  Â  Â  Â  Â  // ... (Burada sendPushNotification fonksiyonunu dÃ¶ngÃ¼yle Ã§aÄŸÄ±rabilirsin)

Â  Â  Â  Â  Â  Â  showToast(t('success'), "Grup alÄ±ÅŸkanlÄ±ÄŸÄ± oluÅŸturuldu!", 'success');
Â  Â  Â  Â  Â  Â  setIsGroupModalOpen(false);
Â  Â  Â  Â  Â  Â  setNewGroupTitle("");
Â  Â  Â  Â  Â  Â  setSelectedGroupMembers([]);

Â  Â  Â  Â  } catch (e: any) {
Â  Â  Â  Â  Â  Â  showToast(t('error_title'), e.message, 'error');
Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  setIsAuthLoading(false);
Â  Â  Â  Â  }
Â  Â  Â  };

Â  Â  Â  // --- GRUP GÃ–REVÄ°NÄ° Ä°ÅžARETLEME ---
Â  Â  Â  const toggleGroupHabit = async (groupId: string, currentCompletions: any) => {
Â  Â  Â  Â  const today = getISODate(new Date());
Â  Â  Â  Â  const todaysList = currentCompletions[today] || [];
Â  Â  Â  Â Â 
Â  Â  Â  Â  let newList;
Â  Â  Â  Â  if (todaysList.includes(user.uid)) {
Â  Â  Â  Â  Â  Â  // Zaten yapmÄ±ÅŸÄ±m, geri al (Sil)
Â  Â  Â  Â  Â  Â  newList = todaysList.filter((uid: string) => uid !== user.uid);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // YapmamÄ±ÅŸÄ±m, ekle
Â  Â  Â  Â  Â  Â  newList = [...todaysList, user.uid];
Â  Â  Â  Â  Â  Â  // Motivasyon efekti (Konfeti vb. eklenebilir)
Â  Â  Â  Â  Â  Â  showToast("Tebrikler!", "BugÃ¼nkÃ¼ grup gÃ¶revini tamamladÄ±n! ðŸŽ‰", 'success');
Â  Â  Â  Â  }

Â  Â  Â  Â  // Firestore Update (Map iÃ§inde array gÃ¼ncelleme)
Â  Â  Â  Â  const groupRef = doc(db, "habit_groups", groupId);
Â  Â  Â  Â  await updateDoc(groupRef, {
Â  Â  Â  Â  Â  Â  [`completions.${today}`]: newList
Â  Â  Â  Â  });
Â  Â  Â  };

Â  Â  const toggleTask = async (task: Task) => {Â 
Â  Â  Â  Â  Â  Â  if(user) {
Â  Â  Â  Â  Â  Â  Â  Â  // EÄŸer gÃ¶rev tamamlanÄ±yorsa (false -> true oluyorsa) sayacÄ± artÄ±r
Â  Â  Â  Â  Â  Â  Â  Â  if (!task.completed) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  checkAdTrigger('tasks');Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, "users", user.uid, "tasks", task.id), { completed: !task.completed });Â 
Â  Â  Â  Â  Â  Â  }}; Â 
Â Â 
Â  const deleteTask = async (task: Task) => { if (user) { await deleteDoc(doc(db, "users", user.uid, "tasks", task.id)); } };
Â Â 
Â  const toggleHabitCompletion = async (habit: Habit, date: string) => {
Â  Â  Â  const ref = doc(db, "users", user.uid, "habits", habit.id);
Â  Â  Â Â 
Â  Â  Â  // EÄŸer bu tarih daha Ã¶nce iÅŸaretlenmemiÅŸse (yani yeni tamamlanÄ±yorsa)
Â  Â  Â  if (!habit.completedDates.includes(date)) {
Â  Â  Â  Â  Â  Â checkAdTrigger('habits');
Â  Â  Â  }

Â  Â  Â  if (habit.completedDates.includes(date)) await updateDoc(ref, { completedDates: arrayRemove(date) });
Â  Â  Â  else await updateDoc(ref, { completedDates: arrayUnion(date) });
Â  };
Â Â 
Â  const deleteHabit = async (habit: Habit) => {Â 
Â  Â  Â  if (habit.notificationIds) {
Â  Â  Â  Â  Â  for(const id of habit.notificationIds) { if (Platform.OS !== 'web') await Notifications.cancelScheduledNotificationAsync(id); }
Â  Â  Â  }
Â  Â  Â  if (user) await deleteDoc(doc(db, "users", user.uid, "habits", habit.id));Â 
Â  };

// OmmioApp fonksiyonunun en baÅŸÄ±na, diÄŸer useState'lerin yanÄ±na ekle:
const [taskUnreadCounts, setTaskUnreadCounts] = useState<any>({});

// Hemen altÄ±na bu useEffect'i yapÄ±ÅŸtÄ±r:
useEffect(() => {
Â  Â  if (!user) return;

Â  Â  // VeritabanÄ±ndaki TÃœM gÃ¶rev yorumlarÄ±nÄ± tarar (TaskChatButton mantÄ±ÄŸÄ±nÄ±n aynÄ±sÄ± ama hepsi iÃ§in)
Â  Â  const q = query(
Â  Â  Â  Â  collectionGroup(db, 'comments'),
Â  Â  Â  Â  where('read', '==', false) // Sadece okunmamÄ±ÅŸlarÄ± al
Â  Â  );

Â  Â  const unsubscribe = onSnapshot(q, (snapshot) => {
Â  Â  Â  Â  const counts: any = {};

Â  Â  Â  Â  snapshot.docs.forEach((doc) => {
Â  Â  Â  Â  Â  Â  // TypeScript hatasÄ± olmamasÄ± iÃ§in 'as any' kullanÄ±yoruz
Â  Â  Â  Â  Â  Â  const data = doc.data() as any;Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Kendi yorumlarÄ±mÄ±zÄ± sayma
Â  Â  Â  Â  Â  Â  if (data.senderId === user.uid) return;

Â  Â  Â  Â  Â  Â  // Yorumu atan kiÅŸinin ID'sine gÃ¶re sayacÄ± artÄ±r
Â  Â  Â  Â  Â  Â  counts[data.senderId] = (counts[data.senderId] || 0) + 1;
Â  Â  Â  Â  });

Â  Â  Â  Â  setTaskUnreadCounts(counts);
Â  Â  });

Â  Â  return () => unsubscribe();
}, [user]);

Â  const toggleExpand = (taskId: string) => { LayoutAnimation.configureNext(LayoutAnimation.Presets.easeInEaseOut); setExpandedTaskId(expandedTaskId === taskId ? null : taskId); };
Â  const openEditModal = (task: Task) => { if (task.assignedBy !== user.uid && task.assignedTo !== user.uid) { showToast(t('error_title'), t('task_unauth_edit'), 'error'); return; } setSelectedTask(task); setDetailText(task.text); setDetailDesc(task.description || ""); setDetailDueDate(task.dueDate || ""); };
Â  const saveTaskDetail = async () => { if (!selectedTask) return; try { const targetUid = selectedTask.assignedTo || user.uid; const taskRef = doc(db, "users", targetUid, "tasks", selectedTask.id); await updateDoc(taskRef, { text: detailText, description: detailDesc, dueDate: detailDueDate }); setSelectedTask(null); showToast(t('success'), t('task_updated'), 'success'); } catch (e) { showToast(t('error_title'), t('update_failed_generic'), 'error'); } };
Â Â 
Â  const onDateChange = (event: any, selected: Date | undefined) => {Â 
Â  Â  Â  // Sadece Android'de seÃ§im yapÄ±nca otomatik kapat (Web ve iOS'ta butonla kapatacaÄŸÄ±z)
Â  Â  Â  if (Platform.OS === 'android') {
Â  Â  Â  Â  Â  setShowDatePicker(false);Â 
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  if (selected) {Â 
Â  Â  Â  Â  Â  const formatted = formatDateDDMMYYYY(selected);
Â  Â  Â  Â  Â  // Hangi input iÃ§in aÃ§Ä±ldÄ±ysa onu gÃ¼ncelle
Â  Â  Â  Â  Â  if (datePickerTarget === 'start') setInputStartDate(formatted);
Â  Â  Â  Â  Â  if (datePickerTarget === 'due') setInputDueDate(formatted);
Â  Â  Â  Â  Â  if (datePickerTarget === 'habitEnd') setNewHabitEndDate(formatted);
Â  Â  Â  Â  Â  if (datePickerTarget === 'detail') setDetailDueDate(formatted);
Â  Â  Â  }Â 
Â  };
Â Â 
Â  const onDetailDateChange = (event: any, selected: Date | undefined) => {Â 
Â  Â  Â  setShowDetailDatePicker(false);Â 
Â  Â  Â  if (selected) setDetailDueDate(formatDateDDMMYYYY(selected));
Â  };
Â  const onHabitDateChange = (event: any, selected: Date | undefined) => {
Â  Â  Â  setShowHabitDatePicker(false);
Â  Â  Â  if (selected) setNewHabitEndDate(formatDateDDMMYYYY(selected));
Â  };

Â  const openDatePicker = (target: 'start' | 'due' | 'habitEnd' | 'detail') => {
Â  Â  Â  setDatePickerTarget(target);
Â  Â  Â  setShowDatePicker(true);
Â  };

Â  const handleInputStartDateChange = (text: string) => { setInputStartDate(maskDateInput(text)); };
Â  const handleInputDueDateChange = (text: string) => { setInputDueDate(maskDateInput(text)); };
Â  const handleDetailDueDateChange = (text: string) => { setDetailDueDate(maskDateInput(text)); };
Â  const handleHabitEndDateChange = (text: string) => setNewHabitEndDate(maskDateInput(text));
Â  const handleNotifInputChange = (text: string) => { setNotifInput(maskTimeInput(text)); };
Â  const handleAlarmInputChange = (text: string) => { setAlarmInput(maskTimeInput(text)); };
Â  const handleHabitNotifInputChange = (text: string) => { setHabitNotifInput(maskTimeInput(text)); };
Â  const changeDate = (days: number) => { const newDate = new Date(selectedDate); newDate.setDate(selectedDate.getDate() + days); setSelectedDate(newDate); };
Â  const toggleHabitDay = (dayId: number) => { if (newHabitDays.includes(dayId)) setNewHabitDays(newHabitDays.filter(d => d !== dayId)); else setNewHabitDays([...newHabitDays, dayId]); };
Â  // ... mevcut fonksiyonlarÄ±n arasÄ±na ekleyin

Â  const handleAddCategory = async () => {
Â  Â  if (!newCategoryName.trim()) return;
Â  Â  const newId = Math.random().toString(36).substr(2, 9);
Â  Â Â 
Â  Â  const newCategory = { id: newId, name: newCategoryName, color: newCategoryColor };
Â  Â  const updatedCategories = [...categories, newCategory];
Â  Â Â 
Â  Â  setCategories(updatedCategories);
Â  Â  setNewCategoryName("");
Â  Â Â 
Â  Â  // FIREBASE KAYDI (Ã–NEMLÄ°)
Â  Â  if (user) {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  // 'users' koleksiyonunda kullanÄ±cÄ±nÄ±n dÃ¶kÃ¼manÄ±na 'categories' alanÄ±nÄ± gÃ¼ncelliyoruz
Â  Â  Â  Â  Â  Â  await setDoc(doc(db, "users", user.uid), { categories: updatedCategories }, { merge: true });
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.log("Kategori kaydedilemedi", e);
Â  Â  Â  Â  }
Â  Â  }
};

// Kategori silerken de updateDoc yapmalÄ±sÄ±nÄ±z:
const handleDeleteCategory = async (catId: string) => {
Â  Â  if (categories.length <= 1) {
Â  Â  showToast(t('warning_label'), t('at_least_one_category'), 'warning');
Â  Â  return;
}
Â  Â  const updatedCategories = categories.filter(c => c.id !== catId);
Â  Â  setCategories(updatedCategories);
Â  Â Â 
Â  Â  if (user) {
Â  Â  Â  Â  Â await updateDoc(doc(db, "users", user.uid), { categories: updatedCategories });
Â  Â  }
};

Â  const sendFriendRequest = async () => {
Â  Â  // 1. BoÅŸ kontrolÃ¼
Â  Â  if (!searchUsername.trim()) {
Â  Â  Â  Â  showToast(t('warning_title'), t('auth_username_required'), 'warning');
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  // KÃ¼Ã§Ã¼k harfe Ã§evir ve boÅŸluklarÄ± sil (Instagram mantÄ±ÄŸÄ±: username her zaman kÃ¼Ã§Ã¼k harftir)
Â  Â  const targetUsername = searchUsername.trim().toLowerCase().replace(/\s/g, '');

Â  Â  try {
Â  Â  Â  Â  // 2. KullanÄ±cÄ±yÄ± "public_users" iÃ§inde unique username ile ara
Â  Â  Â  Â  const q = query(collection(db, "public_users"), where("username", "==", targetUsername));
Â  Â  Â  Â  const querySnapshot = await getDocs(q);

Â  Â  Â  Â  // A. KULLANICI BULUNAMADI
Â  Â  Â  Â  if (querySnapshot.empty) {Â 
Â  Â  Â  Â  Â  Â  showToast(t('error_title'), tFormat('user_not_found', { targetUsername }), 'error');Â 
Â  Â  Â  Â  Â  Â  return;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  // Hedef kullanÄ±cÄ±nÄ±n verisini al
Â  Â  Â  Â  const targetUser = querySnapshot.docs[0].data();
Â  Â  Â  Â  const targetUid = targetUser.uid;
Â  Â  Â  Â  // GÃ¶rÃ¼nen ismi al (Yoksa username kullan)
Â  Â  Â  Â  const targetDisplayName = targetUser.displayName || targetUser.username;

Â  Â  Â  Â  // B. KENDÄ°NE Ä°STEK ATMA
Â  Â  Â  Â  if (targetUid === user.uid) {Â 
Â  Â  Â  Â  Â  Â  showToast(t('warning_title'), t('self_add_error'), 'warning');Â 
Â  Â  Â  Â  Â  Â  return;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  // C. ZATEN ARKADAÅž MI?
Â  Â  Â  Â  const contactRef = doc(db, "users", user.uid, "contacts", targetUid);
Â  Â  Â  Â  const contactSnap = await getDoc(contactRef);
Â  Â  Â  Â  if (contactSnap.exists()) {Â 
Â  Â  Â  Â  Â  Â  showToast(t('info_title'), tFormat('already_friend', { targetDisplayName }) , 'info');Â 
Â  Â  Â  Â  Â  Â  setSearchUsername("");Â 
Â  Â  Â  Â  Â  Â  return;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  // 3. Ä°steÄŸi GÃ¶nder
Â  Â  Â  Â  const requestRef = doc(db, "users", targetUid, "friend_requests", user.uid);
Â  Â  Â  Â Â 
Â  Â  Â  Â  await setDoc(requestRef, {Â 
Â  Â  Â  Â  Â  Â  id: user.uid,
Â  Â  Â  Â  Â  Â  fromUid: user.uid,Â 
Â  Â  Â  Â  Â  Â  // GÃ¶nderen olarak BÄ°ZÄ°M username ve display name'imizi ekliyoruz
Â  Â  Â  Â  Â  Â  fromUsername: user.username,Â 
Â  Â  Â  Â  Â  Â  fromDisplayName: user.displayName || user.username, // <-- YENÄ°: Display name de gidiyor
Â  Â  Â  Â  Â  Â  fromEmail: user.email,Â 
Â  Â  Â  Â  Â  Â  status: 'pending',Â 
Â  Â  Â  Â  Â  Â  createdAt: serverTimestamp()Â 
Â  Â  Â  Â  });
Â  Â  Â  Â  if (targetUser.pushToken) {
Â  Â  Â  Â  Â  Â  await sendPushNotification(
Â  Â  Â  Â  Â  Â  Â  Â  targetUser.pushToken,
Â  Â  Â  Â  Â  Â  Â  Â  t('friend_req_title') || "ArkadaÅŸlÄ±k Ä°steÄŸi",
Â  Â  Â  Â  Â  Â  Â  Â  `${user.displayName || user.username} ${t('sent_friend_req_msg') || t('sent_you_request')}`,
Â  Â  Â  Â  Â  Â  Â  Â  { type: 'friend_request' }
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // D. BAÅžARILI (KullanÄ±cÄ±ya Display Name ile geri bildirim veriyoruz)
Â  Â  Â  Â  setSearchUsername("");Â 
Â  Â  Â  Â  showToast(t('social_request_sent'), Â tFormat('request_sent', {Â 
Â  Â  targetDisplayName,Â 
Â  Â  targetUsername Â }), 'success');

Â  Â  } catch (e: any) {Â 
Â  Â  Â  Â  console.error("Ä°stek gÃ¶nderme hatasÄ±:", e);
Â  Â  Â  Â  showToast(t('error_title'), t('request_failed'), 'error');
Â  Â  }
};

Â  const acceptRequest = async (req: FriendRequest) => {
Â  Â  if (!user) return;
Â  Â Â 
Â  Â  try {
Â  Â  Â  Â  // 1. Ä°steÄŸi gÃ¶nderen kiÅŸinin GÃœNCEL verisini al
Â  Â  Â  Â  const senderDoc = await getDoc(doc(db, "public_users", req.fromUid));
Â  Â  Â  Â Â 
Â  Â  Â  Â  // EÄŸer veri yoksa istekteki eski verileri kullan (Fallback)
Â  Â  Â  Â  // req nesnesine any diyerek tip hatasÄ±nÄ± geÃ§ici Ã§Ã¶zÃ¼yoruz Ã§Ã¼nkÃ¼ friendRequest interface'ini gÃ¼ncellemedik
Â  Â  Â  Â  const reqData = req as any;Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  const senderData = senderDoc.exists() ? senderDoc.data() : {Â 
Â  Â  Â  Â  Â  Â  username: reqData.fromUsername,Â 
Â  Â  Â  Â  Â  Â  displayName: reqData.fromDisplayName || reqData.fromUsername,
Â  Â  Â  Â  Â  Â  photoURL: nullÂ 
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 2. Kaydedilecek Veriler
Â  Â  Â  Â  const senderUsername = senderData.username;
Â  Â  Â  Â  const senderDisplayName = senderData.displayName || senderUsername; // Ã–ncelik Display Name
Â  Â  Â  Â  const senderPhoto = senderData.photoURL || null;

Â  Â  Â  Â  const myUsername = user.username;Â 
Â  Â  Â  Â  const myDisplayName = user.displayName || user.username;
Â  Â  Â  Â  const myPhoto = user.photoURL;

Â  Â  Â  Â  // 3. Ã‡ift TaraflÄ± KayÄ±t
Â  Â  Â  Â  await Promise.all([
Â  Â  Â  Â  Â  Â  // A. Benim listeme ekle (Display Name Ã¶ncelikli kaydediyoruz)
Â  Â  Â  Â  Â  Â  setDoc(doc(db, "users", user.uid, "contacts", req.fromUid), {Â 
Â  Â  Â  Â  Â  Â  Â  Â  uid: req.fromUid,Â 
Â  Â  Â  Â  Â  Â  Â  Â  username: senderUsername, Â  Â  Â // Arama ve @ etiketi iÃ§in
Â  Â  Â  Â  Â  Â  Â  Â  displayName: senderDisplayName, // Listede gÃ¶stermek iÃ§in
Â  Â  Â  Â  Â  Â  Â  Â  email: reqData.fromEmail || "",Â 
Â  Â  Â  Â  Â  Â  Â  Â  photoURL: senderPhoto,Â 
Â  Â  Â  Â  Â  Â  Â  Â  canAssignToMe: true,
Â  Â  Â  Â  Â  Â  Â  Â  createdAt: serverTimestamp()
Â  Â  Â  Â  Â  Â  }),

Â  Â  Â  Â  Â  Â  // B. KarÅŸÄ± tarafa beni ekle
Â  Â  Â  Â  Â  Â  setDoc(doc(db, "users", req.fromUid, "contacts", user.uid), {Â 
Â  Â  Â  Â  Â  Â  Â  Â  uid: user.uid,Â 
Â  Â  Â  Â  Â  Â  Â  Â  username: myUsername,Â 
Â  Â  Â  Â  Â  Â  Â  Â  displayName: myDisplayName,
Â  Â  Â  Â  Â  Â  Â  Â  email: user.email,Â 
Â  Â  Â  Â  Â  Â  Â  Â  photoURL: myPhoto,Â 
Â  Â  Â  Â  Â  Â  Â  Â  canAssignToMe: false,
Â  Â  Â  Â  Â  Â  Â  Â  createdAt: serverTimestamp()
Â  Â  Â  Â  Â  Â  }),

Â  Â  Â  Â  Â  Â  // C. Ä°steÄŸi sil
Â  Â  Â  Â  Â  Â  deleteDoc(doc(db, "users", user.uid, "friend_requests", req.id || req.fromUid))
Â  Â  Â  Â  ]);
Â  Â  Â  Â Â 
Â  Â  Â  Â  showToast(t('success_label'),
Â  tFormat('success_friend', { senderDisplayName }), 'success');
Â  Â  Â  Â Â 
Â  Â  } catch (e: any) {Â 
Â  Â  Â  Â  console.error("Kabul hatasÄ±:", e);
Â  Â  Â  Â  showToast(t('error_title'), t('connection_failed'), 'error');Â 
Â  Â  }
};
Â  const showTasksAssignedToFriend = async (friendUid: string, friendName: string) => {
Â  Â  if (!user) return;
Â  Â  try {
Â  Â  Â  Â  // ArkadaÅŸÄ±n "tasks" koleksiyonunda, "assignedBy" benim ID'm olanlarÄ± Ã§ek
Â  Â  Â  Â  const q = query(
Â  Â  Â  Â  Â  Â  collection(db, "users", friendUid, "tasks"),Â 
Â  Â  Â  Â  Â  Â  where("assignedBy", "==", user.uid)
Â  Â  Â  Â  );
Â  Â  Â  Â Â 
Â  Â  Â  Â  const snapshot = await getDocs(q);
Â  Â  Â  Â  const sentTasks = snapshot.docs.map(d => ({id: d.id, ...d.data()}));
Â  Â  Â  Â Â 
Â  Â  Â  Â  setFriendTasksModal({ visible: true, tasks: sentTasks, friendName });
Â  Â  } catch (e) {
Â  Â  Â  Â  showToast(t('error_title'), t('tasks_fetch_error'), 'error');
Â  Â  }
Â  };
Â  const rejectRequest = async (reqId: string) => { try { await deleteDoc(doc(db, "users", user.uid, "friend_requests", reqId)); } catch (e) { } };
Â  const togglePermission = async (contact: Contact) => { await updateDoc(doc(db, "users", user.uid, "contacts", contact.uid), { canAssignToMe: !contact.canAssignToMe }); };
Â  const setContactCategory = async (contact: Contact, categoryId: string) => { await updateDoc(doc(db, "users", user.uid, "contacts", contact.uid), { defaultCategoryId: categoryId }); };
Â  const fetchDeviceContacts = async () => {
Â  Â  Â  const { status } = await Contacts.requestPermissionsAsync();
Â  Â  Â  if (status === 'granted') {
Â  Â  Â  Â  Â  const { data } = await Contacts.getContactsAsync({ fields: [Contacts.Fields.PhoneNumbers, Contacts.Fields.Name] });
Â  Â  Â  Â  Â  if (data.length > 0) {
Â  Â  Â  Â  Â  Â  Â  const formattedContacts: DeviceContact[] = [];
Â  Â  Â  Â  Â  Â  Â  for (const contact of data) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  if (contact.phoneNumbers && contact.phoneNumbers.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let number = contact.phoneNumbers[0].number || "";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  number = number.replace(/\s/g, '').replace(/-/g, '').replace(/\(/g, '').replace(/\)/g, '');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formattedContacts.push({ id: contact.id || Math.random().toString(), name: contact.name || t('no_name'), phoneNumber: number, isAppUser: false });
Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  setDeviceContacts(formattedContacts);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else { showToast(t('permission_required'), t('contacts_permission'), 'warning'); } Â };
Â Â 
Â  const inviteContact = async (phoneNumber: string) => {
Â  Â  Â  const isAvailable = await SMS.isAvailableAsync();
Â  Â  Â  if (isAvailable) { await SMS.sendSMSAsync([phoneNumber], t('social_invite_sms')); } else { showToast(t('error_title'), t('sms_error'), 'error'); }
Â  };
const handleDeleteAccount = async () => {
Â  Â  // Silme MantÄ±ÄŸÄ±
Â  Â  const performDelete = async () => {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  if (!user) return;
Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db, "users", user.uid));
Â  Â  Â  Â  Â  Â  try { await deleteDoc(doc(db, "public_users", user.uid)); } catch (e) {}
Â  Â  Â  Â  Â  Â  await user.delete();
Â  Â  Â  Â  Â  Â  setTasks([]);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // BaÅŸarÄ±lÄ± MesajÄ±
Â  Â  Â  Â  Â  Â  showToast( t('delete_account_success_title'), t('delete_account_success_msg'), 'success');

Â  Â  Â  Â  } catch (error: any) {
Â  Â  Â  Â  Â  Â  console.log("Silme hatasÄ±:", error);
Â  Â  Â  Â  Â  Â  // Hata MesajÄ±
Â  Â  Â  Â  Â  Â  showToast( t('error_title'), t('account_delete_error'), 'error');
Â  Â  Â  Â  }
Â  Â  };

Â  Â  // Onay Kutusu
Â  Â  askConfirmation(
Â  Â  Â  Â  t('delete_account'), // "HesabÄ± Sil"
Â  Â  Â  Â  t('account_delete_confirm'), // "Emin misin?..."
Â  Â  Â  Â  performDelete,
Â  Â  Â  Â  true // KÄ±rmÄ±zÄ± buton
Â  Â  );
};

Â  // --- UI HELPERS ---
Â  const isSystemDark = systemScheme === 'dark';
Â  // --- YENÄ° BÄ°LDÄ°RÄ°M FONKSÄ°YONU ---
Â  // type kÄ±smÄ±na 'warning' ekledik
const showToast = (title: string, message: string, type: 'success' | 'error' | 'info' | 'warning' = 'success') => {
Â  Â  setCustomToast({ visible: true, title, message, type });
Â  Â  setTimeout(() => setCustomToast(prev => ({ ...prev, visible: false })), 4000);
};

Â  // --- YENÄ° ONAY KUTUSU FONKSÄ°YONU ---
Â  const askConfirmation = (title: string, message: string, onConfirm: () => void, isDestructive = false) => {
Â  Â  Â  setConfirmModal({
Â  Â  Â  Â  Â  visible: true,
Â  Â  Â  Â  Â  title,
Â  Â  Â  Â  Â  message,
Â  Â  Â  Â  Â  onConfirm,
Â  Â  Â  Â  Â  isDestructive
Â  Â  Â  });
Â  };
Â  // 1. Android Geri TuÅŸu KontrolÃ¼
useEffect(() => {
Â  const onBackPress = () => {
Â  Â  // EÄŸer sohbet aÃ§Ä±ksa, sohbeti kapat ve listeye dÃ¶n
Â  Â  if (activeTab === 'chat_room' && chatTarget) {
Â  Â  Â  setChatTarget(null);
Â  Â  Â  setActiveTab('messages');
Â  Â  Â  setChatMessages([]);
Â  Â  Â  return true; // Ä°ÅŸlemi biz hallettik, uygulama kapanmasÄ±n
Â  Â  }
Â  Â  return false; // DiÄŸer durumlarda varsayÄ±lan davranÄ±ÅŸ
Â  };

Â  // DeÄŸiÅŸiklik burada: Dinleyiciyi bir deÄŸiÅŸkene atÄ±yoruz
Â  const backHandler = BackHandler.addEventListener('hardwareBackPress', onBackPress);

Â  // Temizleme fonksiyonunda .remove() Ã§aÄŸÄ±rÄ±yoruz
Â  return () => backHandler.remove();
}, [activeTab, chatTarget]);

Â  // 2. KaydÄ±rma (Swipe) AlgÄ±layÄ±cÄ± (iOS Stili Geri DÃ¶nÃ¼ÅŸ)
Â  const panResponder = useRef(
Â  Â  PanResponder.create({
Â  Â  Â  // Dokunma baÅŸladÄ±ÄŸÄ±nda devreye girsin mi?
Â  Â  Â  onMoveShouldSetPanResponder: (evt, gestureState) => {
Â  Â  Â  Â  // Sadece soldan saÄŸa doÄŸru belirgin bir kaydÄ±rma varsa (dx > 10)
Â  Â  Â  Â  // Ve dikey kaydÄ±rma Ã§ok azsa (dy < 20 - yani kullanÄ±cÄ± mesajlarÄ± aÅŸaÄŸÄ± yukarÄ± kaydÄ±rmÄ±yorsa)
Â  Â  Â  Â  // AyrÄ±ca hareket ekranÄ±n sol kenarÄ±na yakÄ±n baÅŸlamÄ±ÅŸsa (pageX < 100)
Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  activeTab === 'chat_room' &&Â 
Â  Â  Â  Â  Â  gestureState.dx > 10 &&Â 
Â  Â  Â  Â  Â  Math.abs(gestureState.dy) < 20 &&
Â  Â  Â  Â  Â  evt.nativeEvent.pageX < 100 // Sadece sol kenardan Ã§ekince Ã§alÄ±ÅŸsÄ±n (isteÄŸe baÄŸlÄ± bu satÄ±rÄ± kaldÄ±rabilirsin)
Â  Â  Â  Â  );
Â  Â  Â  },
Â  Â  Â  onPanResponderRelease: (evt, gestureState) => {
Â  Â  Â  Â  // EÄŸer parmak 50 birimden fazla saÄŸa kaydÄ±ysa "Geri DÃ¶n" iÅŸlemini yap
Â  Â  Â  Â  if (gestureState.dx > 50) {
Â  Â  Â  Â  Â  setChatTarget(null);
Â  Â  Â  Â  Â  setActiveTab('messages');
Â  Â  Â  Â  Â  setChatMessages([]);
Â  Â  Â  Â  }
Â  Â  Â  },
Â  Â  })
Â  ).current;
Â  // --- CHAT ODASI RENDER FONKSÄ°YONU ---

const renderChatRoom = () => {
Â  Â  // Dinamik Stiller (Tema deÄŸiÅŸimi iÃ§in)
Â  Â  const activeChatUser = contacts.find(c => c.uid === chatTarget?.uid) || chatTarget;
Â  Â  const dynamicStyles = {
Â  Â  Â  Â  container: { backgroundColor: currentColors.bg },
Â  Â  Â  Â  header: {Â 
Â  Â  Â  Â  Â  Â  backgroundColor: currentColors.surface,
Â  Â  Â  Â  Â  Â  borderBottomColor: isDark ? '#334155' : '#e2e8f0',
Â  Â  Â  Â  },
Â  Â  Â  Â  text: { color: currentColors.text },
Â  Â  Â  Â  subText: { color: currentColors.subText },
Â  Â  Â  Â  inputContainer: {Â 
Â  Â  Â  Â  Â  Â  backgroundColor: currentColors.surface,
Â  Â  Â  Â  Â  Â  borderColor: isDark ? '#334155' : '#e2e8f0',
Â  Â  Â  Â  },
Â  Â  Â  Â  menu: {
Â  Â  Â  Â  Â  Â  backgroundColor: currentColors.surface,
Â  Â  Â  Â  Â  Â  borderColor: isDark ? '#334155' : '#e2e8f0',
Â  Â  Â  Â  },
Â  Â  Â  Â  backBtn: {
Â  Â  Â  Â  Â  Â  backgroundColor: isDark ? 'rgba(255,255,255,0.08)' : '#f1f5f9',
Â  Â  Â  Â  }
Â  Â  };

Â  Â  // Mesaj GÃ¶nderme Tetikleyicisi
Â  Â  const handleSend = () => {
Â  Â  Â  Â  if (chatInput.trim()) {
Â  Â  Â  Â  Â  Â  sendMessage();
Â  Â  Â  Â  }
Â  Â  };

Â  Â  // MenÃ¼ dÄ±ÅŸÄ±na tÄ±klanÄ±nca kapatma mantÄ±ÄŸÄ±
Â  Â  const handleDismissMenu = () => {
Â  Â  Â  Â  if (isMenuOpen) setIsMenuOpen(false);
Â  Â  Â  Â  return false;
Â  Â  };

Â  Â  return (
Â  Â  Â  Â  <ViewÂ 
Â  Â  Â  Â  Â  Â  style={[styles.container, dynamicStyles.container]}Â 
Â  Â  Â  Â  Â  Â  // Pan responder ve dokunma olaylarÄ±nÄ± koruyoruz
Â  Â  Â  Â  Â  Â  onStartShouldSetResponder={handleDismissMenu}
Â  Â  Â  Â  Â  Â  {...panResponder.panHandlers}
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  {/* --- MODERN HEADER --- */}
Â  Â  Â  Â  Â  Â  <View style={[styles.header, dynamicStyles.header, styles.shadow]}>
Â  Â  Â  Â  Â  Â  Â  Â  <View style={styles.headerLeft}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Geri Butonu */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setIsMenuOpen(false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setChatTarget(null);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setChatMessages([]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setActiveTab('messages');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={[styles.iconButton, dynamicStyles.backBtn]}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ChevronLeft size={24} color={currentColors.text} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Profil AlanÄ± */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={styles.avatarContainer}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {chatTarget?.photoURL ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Image source={{ uri: chatTarget.photoURL }} style={styles.avatarImage} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={[styles.avatarPlaceholder, { backgroundColor: COLORS.secondary }]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={styles.avatarText}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {chatTarget?.username?.[0]?.toUpperCase()}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Ä°sim & Durum */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flex: 1, justifyContent: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text numberOfLines={1} style={[styles.headerTitle, dynamicStyles.text]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {chatTarget?.displayName || chatTarget?.username}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text numberOfLines={1} style={[styles.headerSubtitle, dynamicStyles.subText]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @{chatTarget?.username}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  {/* SaÄŸ Taraf - MenÃ¼ Butonu */}
Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ position: 'relative', zIndex: 50 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => setIsMenuOpen(!isMenuOpen)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={[styles.iconButton, { backgroundColor: 'transparent' }]}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <MoreVertical size={24} color={currentColors.text} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- POPUP MENÃœ --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isMenuOpen && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={[styles.menuDropdown, dynamicStyles.menu, styles.shadow]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setIsMenuOpen(false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleDeleteChat();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={[styles.menuItem, { backgroundColor: isDark ? 'rgba(239, 68, 68, 0.15)' : '#fee2e2' }]}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Trash2 size={18} color={COLORS.danger} style={{ marginRight: 10 }} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: COLORS.danger, fontWeight: '600', fontSize: 14 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Sohbeti Sil
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  {/* --- MESAJ LÄ°STESÄ° --- */}
Â  Â  Â  Â  Â  Â  <KeyboardAvoidingViewÂ 
Â  Â  Â  Â  Â  Â  Â  Â  style={{ flex: 1 }}Â 
Â  Â  Â  Â  Â  Â  Â  Â  behavior={Platform.OS === 'ios' ? 'padding' : undefined}
Â  Â  Â  Â  Â  Â  Â  Â  keyboardVerticalOffset={Platform.OS === 'ios' ? 0 : 0}
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  <FlatList
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data={chatMessages}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  keyExtractor={(item) => item.id}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  inverted={true}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  contentContainerStyle={styles.listContainer}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showsVerticalScrollIndicator={false}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onTouchStart={() => isMenuOpen && setIsMenuOpen(false)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onEndReached={() => setMsgLimit((prev) => prev + 25)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderItem={({ item: msg }) => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <MessageItemÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  msg={msg}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  user={user}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatTarget={activeChatUser} // <--- DÃœZELTÄ°LMÄ°Åž HALÄ° (CanlÄ± veriyi gÃ¶nderiyoruz)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentColors={currentColors}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isDark={isDark}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  {/* --- MODERN INPUT ALANI --- */}
Â  Â  Â  Â  Â  Â  Â  Â  <View style={[styles.inputWrapper, { backgroundColor: currentColors.bg }]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={[styles.inputContainer, dynamicStyles.inputContainer, styles.shadow]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TextInput
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value={chatInput}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onChangeText={setChatInput}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Mesaj yazÄ±n..."
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholderTextColor={currentColors.subText}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  multiline={true}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  blurOnSubmit={false}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onFocus={() => setIsMenuOpen(false)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={[styles.textInput, { color: currentColors.text }]}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onKeyPress={(e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const keyEvent = e.nativeEvent as any;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (keyEvent.key === 'Enter' && !keyEvent.shiftKey) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (Platform.OS === 'web') e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleSend();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* GÃ¶nder Butonu - Animasyonlu hissi veren renk deÄŸiÅŸimi */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={handleSend}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  disabled={!chatInput.trim()}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={[
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  styles.sendButton,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { backgroundColor: chatInput.trim() ? COLORS.primary : (isDark ? '#475569' : '#cbd5e1') }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ]}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Send size={20} color="#fff" style={{ marginLeft: 2 }} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  </KeyboardAvoidingView>
Â  Â  Â  Â  </View>
Â  Â  );
};
Â  const renderGroupHabitCard = (group: GroupHabit) => {
Â  Â  const today = getISODate(new Date());
Â  Â  const doneToday = group.completions && group.completions[today] ? group.completions[today] : [];
Â  Â  const isMeDone = doneToday.includes(user.uid);

Â  Â  return (
Â  Â  Â  Â  <View key={group.id} style={{Â 
Â  Â  Â  Â  Â  Â  backgroundColor: currentColors.surface,Â 
Â  Â  Â  Â  Â  Â  borderRadius: 24,Â 
Â  Â  Â  Â  Â  Â  padding: 16,Â 
Â  Â  Â  Â  Â  Â  marginBottom: 15,
Â  Â  Â  Â  Â  Â  borderWidth: 1,
Â  Â  Â  Â  Â  Â  borderColor: isMeDone ? COLORS.success : (isDark ? '#334155' : '#e2e8f0'),
Â  Â  Â  Â  Â  Â  shadowColor: "#000", shadowOpacity: 0.05, shadowRadius: 8, elevation: 3
Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  {/* Ãœst KÄ±sÄ±m: BaÅŸlÄ±k ve Buton */}
Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', marginBottom: 15 }}>
Â  Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 18, fontWeight: '800', color: currentColors.text }}>{group.title}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 12, color: currentColors.subText }}>{group.memberDetails?.length || 0} Ãœye â€¢ {doneToday.length} kiÅŸi tamamladÄ±</Text>
Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => toggleGroupHabit(group.id, group.completions)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isMeDone ? '#dcfce7' : COLORS.primary,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingHorizontal: 16,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingVertical: 10,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 14,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: isMeDone ? 1 : 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: '#16a34a'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isMeDone ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{flexDirection:'row', gap:5, alignItems:'center'}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Check size={16} color="#16a34a" strokeWidth={3} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: '#16a34a', fontWeight: 'bold' }}>Tamam</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: '#fff', fontWeight: 'bold' }}>Ben YaptÄ±m</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  {/* Alt KÄ±sÄ±m: Ãœyeler ve DurumlarÄ± */}
Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', backgroundColor: isDark ? 'rgba(0,0,0,0.2)' : '#f8fafc', padding: 10, borderRadius: 16 }}>
Â  Â  Â  Â  Â  Â  Â  Â  <ScrollView horizontal showsHorizontalScrollIndicator={false} contentContainerStyle={{ gap: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {group.memberDetails?.map((member: any) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isDone = doneToday.includes(member.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View key={member.uid} style={{ alignItems: 'center', opacity: isDone ? 1 : 0.5 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 44, height: 44, borderRadius: 22,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 3,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: isDone ? '#10b981' : 'transparent', // Yapanlar yeÅŸil Ã§erÃ§eve
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding: 2, // BoÅŸluk
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marginBottom: 4
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ImageÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  source={member.photoURL ? { uri: member.photoURL } : require('../../assets/Logo/Logo.png')} // Default avatar yoksa logo koydum, sen User ikonu koyabilirsin
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{ width: '100%', height: '100%', borderRadius: 20, backgroundColor: '#cbd5e1' }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isDone && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ position:'absolute', bottom:-2, right:-2, backgroundColor:'#10b981', borderRadius:8, padding:2, borderWidth:1, borderColor:'#fff' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Check size={10} color="#fff" strokeWidth={4} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 10, color: currentColors.text, fontWeight: isDone ? 'bold' : '400', maxWidth: 50 }} numberOfLines={1}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {member.uid === user.uid ? "Sen" : member.displayName}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })}
Â  Â  Â  Â  Â  Â  Â  Â  </ScrollView>
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  </View>
Â  Â  );
Â  };
Â  const isDark = theme === 'system' ? isSystemDark : theme === 'dark';
Â  const currentColors = isDark ? { bg: COLORS.darkBg, surface: COLORS.darkSurface, text: '#fff', subText: '#94a3b8' } : { bg: COLORS.background, surface: COLORS.surface, text: COLORS.textDark, subText: COLORS.textLight };
Â  Â  const getCategoryColor = (catId: string) => {
Â  Â  Â  Â  // Kategorinin rengini bul, eÄŸer bulamazsan varsayÄ±lan 'blue' al
Â  Â  Â  Â  const cat = categories.find(c => c.id === catId);
Â  Â  Â  Â  const colorKey = cat?.color || 'blue';
Â  Â  Â  Â  // Rengin HEX kodunu ve arka planÄ±nÄ± bul
Â  Â  Â  Â  return CATEGORY_COLORS.find(c => c.id === colorKey) || CATEGORY_COLORS[0];
Â  Â  };
Â  const currentISODate = getISODate(selectedDate);
Â  const todaysTasks = tasks.filter(t => {
Â  Â  Â  if (t.date === currentISODate) return true;
Â  Â  Â  if (t.showEveryDayUntilDue && t.dueDate) return currentISODate >= t.date && currentISODate <= convertDDMMYYYYtoISO(t.dueDate);
Â  Â  Â  return false;
Â  });

Â  const activeTasks = todaysTasks.filter(t => !t.completed).sort((a,b) => parseDueDate(a.dueDate) - parseDueDate(b.dueDate));
Â  const completedTasks = todaysTasks.filter(t => t.completed);
Â  const overdueTasks = tasks.filter(t => !t.completed && !t.showEveryDayUntilDue && t.date < getISODate(new Date()));
Â  // --- BURAYI KOPYALA VE overdueTasks TANIMININ ALTINA YAPIÅžTIR ---
Â Â 
Â  const getUpcomingTasks = () => {
Â  Â  const today = new Date();
Â  Â  const nextWeek = new Date();
Â  Â  nextWeek.setDate(today.getDate() + 7);

Â  Â  const todayISO = getISODate(today);
Â  Â  const nextWeekISO = getISODate(nextWeek);

Â  Â  // Tarihi yarÄ±n ve sonraki 7 gÃ¼n iÃ§inde olan, tamamlanmamÄ±ÅŸ gÃ¶revler
Â  Â  return tasks.filter((t: Task) => { // 't: Task' diyerek tip hatasÄ±nÄ± da Ã§Ã¶zÃ¼yoruz
Â  Â  Â  return !t.completed && t.date > todayISO && t.date <= nextWeekISO;
Â  Â  }).sort((a, b) => a.date.localeCompare(b.date));
Â  };
Â Â 
Â  const upcomingTasks = getUpcomingTasks();
Â Â 
Â  // ----------------------------------------------------------------
Â Â 
Â  const todaysHabits = habits.filter(h => {
Â  Â  Â  if (h.endDate && h.endDate < currentISODate) return false;
Â  Â  Â  if (h.frequency === 'daily') return true;
Â  Â  Â  if (h.frequency === 'weekly') return h.selectedDays.includes(selectedDate.getDay());
Â  Â  Â  return false;
Â  }).sort((a,b) => (a.notificationTime || "24:00").localeCompare(b.notificationTime || "24:00"));
Â  // --- PROGRESS BAR HESAPLAMASI ---
Â  const totalTodaysHabits = todaysHabits.length;
Â  const completedTodaysHabits = todaysHabits.filter(h => h.completedDates.includes(currentISODate)).length;
Â  const habitProgress = totalTodaysHabits > 0 ? (completedTodaysHabits / totalTodaysHabits) * 100 : 0;
Â  const filteredContacts = contacts.filter(c => c.username.toLowerCase().includes(assignSearchText.toLowerCase()));
Â  // --- GÃ–REVLER PROGRESS BAR HESAPLAMASI ---
Â  const totalTodaysTasks = todaysTasks.length;
Â  const completedTodaysTasks = todaysTasks.filter(t => t.completed).length;
Â  const taskProgress = totalTodaysTasks > 0 ? (completedTodaysTasks / totalTodaysTasks) * 100 : 0;
Â  Â // --- TAKVÄ°M Ä°ÅžARETLEME MANTIÄžI (BUGÃœN ve SEÃ‡Ä°LÄ° GÃœN) ---
Â  const todayStr = getISODate(new Date());
Â  const selectedStr = getISODate(selectedDate || new Date());
Â Â 

Â  const calendarMarks: any = {};

Â  // 1. Ã–nce BugÃ¼nÃ¼ Ä°ÅŸaretle (VarsayÄ±lan Stil)
Â  calendarMarks[todayStr] = {
Â  Â  customStyles: {
Â  Â  Â  text: { color: COLORS.primary, fontWeight: '900' }
Â  Â  }
Â  };

Â  // 2. SeÃ§ili GÃ¼nÃ¼ Ä°ÅŸaretle (EÄŸer bugÃ¼n seÃ§iliyse, Ã¼stteki stilin Ã¼zerine yazar)
Â  calendarMarks[selectedStr] = {
Â  Â  selected: true,
Â  Â  customStyles: {
Â  Â  Â  container: {
Â  Â  Â  Â  backgroundColor: COLORS.primary, // MOR KUTU
Â  Â  Â  Â  borderRadius: 8,
Â  Â  Â  Â  width: 36,
Â  Â  Â  Â  height: 36,
Â  Â  Â  Â  alignItems: 'center',
Â  Â  Â  Â  justifyContent: 'center',
Â  Â  Â  Â  elevation: 4,
Â  Â  Â  Â  shadowColor: "#000", shadowOpacity: 0.2, shadowRadius: 3
Â  Â  Â  },
Â  Â  Â  text: {
Â  Â  Â  Â  color: '#ffffff', // BEYAZ YAZI
Â  Â  Â  Â  fontWeight: 'bold'
Â  Â  Â  }
Â  Â  }
Â  };
const styles = useMemo(() => getDynamicStyles(currentColors, isDark), [currentColors, isDark]);
Â  // --- renderTask FONKSÄ°YONUNU BUNUNLA DEÄžÄ°ÅžTÄ°R ---
const renderTask = (task: Task) => {
Â  Â  const catInfo = categories.find(c => c.id === task.categoryId) || categories[0];
Â  Â  const catColor = CATEGORY_COLORS.find(c => c.id === catInfo.color) || CATEGORY_COLORS[0];
Â  Â  const isAssignedByOther = task.assignedBy && task.assignedBy !== user.uid;
Â  Â  const isExpanded = expandedTaskId === task.id;
Â  Â  const isMultiDay = task.showEveryDayUntilDue;
Â  Â  const priorityColor = task.priority === 'high' ? '#ef4444' : (task.priority === 'low' ? '#10b981' : '#f59e0b');
Â  Â Â 
Â  Â  return (
Â  Â  Â  Â  <View key={task.id} style={[styles.taskCard, { backgroundColor: currentColors.surface, opacity: task.completed ? 0.6 : 1, borderLeftWidth: isAssignedByOther ? 4 : 0, borderLeftColor: COLORS.warning }]}>
Â  Â  Â  Â  Â  Â  {/* Ãœst SatÄ±r: Checkbox + Metin + Ä°konlar */}
Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  {/* Checkbox */}
Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => toggleTask(task)} style={[styles.checkBox, task.completed ? { backgroundColor: COLORS.success, borderColor: COLORS.success } : { borderColor: '#cbd5e1' }]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {task.completed && <Check size={14} color="#fff" />}
Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  Â  Â  Â  {/* GÃ¶rev Metni ve Meta Veriler */}
Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => toggleExpand(task.id)} style={{ flex: 1 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={[styles.taskText, { color: currentColors.text, textDecorationLine: task.completed ? 'line-through' : 'none' }]}>{task.text}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <View style={styles.taskMeta}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Ã–ncelik BayraÄŸÄ± */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 3 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Flag size={12} color={priorityColor} fill={priorityColor} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Dosya Ä°konu (Varsa) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {task.attachments && task.attachments.length > 0 && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 3, backgroundColor: '#e0f2fe', paddingHorizontal: 6, paddingVertical: 2, borderRadius: 6 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Paperclip size={10} color="#0284c7" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 10, color: '#0284c7', fontWeight: 'bold' }}>{task.attachments.length}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={[styles.miniBadge, { backgroundColor: isDark ? '#334155' : catColor.bg }]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ width: 6, height: 6, borderRadius: 3, backgroundColor: catColor.hex }} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 10, color: isDark ? '#fff' : catColor.hex, fontWeight: 'bold' }}>{catInfo.name}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isAssignedByOther && <View style={[styles.miniBadge, { backgroundColor: '#fef3c7' }]}><User size={10} color={COLORS.warning} /><Text style={{ fontSize: 10, color: COLORS.warning, fontWeight: 'bold' }}>{task.assignedByName || 'Patron'}</Text></View>}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {task.dueDate && <View style={styles.metaItem}><CalendarClock size={10} color={COLORS.danger} /><Text style={{ fontSize: 10, color: COLORS.danger }}>{task.dueDate}</Text></View>}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  Â  Â  Â  {/* --- AKILLI SOHBET BUTONU (Bildirimli) --- */}
Â  Â  Â  Â  Â  Â  Â  Â  <TaskChatButtonÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  task={task}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  user={user}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setSelectedTask(task);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTaskModalTab('chat');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}Â 
Â  Â  Â  Â  Â  Â  Â  Â  />

Â  Â  Â  Â  Â  Â  Â  Â  {/* Expand Butonu */}
Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => toggleExpand(task.id)} style={{ padding: 5 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isExpanded ? <ChevronUp size={20} color={currentColors.subText} /> : <ChevronDown size={20} color={currentColors.subText} />}
Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  {/* GeniÅŸletilmiÅŸ Alan (AÃ§Ä±klama ve Butonlar) */}
Â  Â  Â  Â  Â  Â  {isExpanded && (
Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ marginTop: 15, paddingTop: 15, borderTopWidth: 1, borderColor: isDark ? '#334155' : '#f1f5f9' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {task.description ? (<View style={{ flexDirection: 'row', gap: 5, marginBottom: 10 }}><AlignLeft size={14} color={currentColors.subText} style={{ marginTop: 2 }} /><Text style={{ color: currentColors.text, fontSize: 14, flex: 1 }}>{task.description}</Text></View>) : (<Text style={{ color: currentColors.subText, fontSize: 12, fontStyle: 'italic', marginBottom: 10 }}>{t('task_no_desc')}</Text>)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', justifyContent: 'flex-end', gap: 15, marginTop: 5 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => { askConfirmation(t('delete_btn'), t('task_delete_confirm'), () => deleteTask(task), true); }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{flexDirection:'row', alignItems:'center', gap:4}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Trash2 size={16} color={COLORS.danger} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: COLORS.danger, fontSize: 12, fontWeight: 'bold' }}>{t('delete')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {(task.assignedBy === user.uid || task.assignedTo === user.uid) && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => openEditModal(task)} style={{ flexDirection: 'row', alignItems: 'center', gap: 5, padding: 5, backgroundColor: COLORS.primary + '20', borderRadius: 8, paddingHorizontal: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Edit2 size={16} color={COLORS.primary} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: COLORS.primary, fontSize: 12, fontWeight: 'bold' }}>{t('edit')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  </View>
Â  Â  );
};

// EÄŸer Splash animasyonu daha bitmediyse, Auth yÃ¼klense bile Splash gÃ¶ster.
// --- A) SPLASH EKRANI ---
Â  if (!isSplashAnimationComplete && Platform.OS !== 'web') {Â 
Â  Â  Â  return (
Â  Â  Â  Â  <AnimatedSplashÂ 
Â  Â  Â  Â  Â  Â  onAnimationFinish={() => {
Â  Â  Â  Â  Â  Â  Â  Â  setIsSplashAnimationComplete(true);Â 
Â  Â  Â  Â  Â  Â  Â  Â  setShowAuth(true);
Â  Â  Â  Â  Â  Â  }}Â 
Â  Â  Â  Â  />Â 
Â  Â  Â  );
Â  }

Â  // --- B) KULLANICI YOKSA (GiriÅŸ / KayÄ±t EkranÄ±) ---
Â  if (!user) {
Â  Â  // 1. Landing Page mi gÃ¶sterilsin?
Â  Â  if (!showAuth) {
Â  Â  Â  return (
Â  Â  Â  Â  <LandingPageÂ 
Â  Â  Â  Â  Â  Â  lang={lang}Â 
Â  Â  Â  Â  Â  Â  isDark={isDark}Â 
Â  Â  Â  Â  Â  Â  onGetStarted={(mode) => {
Â  Â  Â  Â  Â  Â  Â  Â  // Landing Page'deki butona basÄ±lÄ±nca Ã§alÄ±ÅŸÄ±r
Â  Â  Â  Â  Â  Â  Â  Â  setAuthMode(mode); // 'login' veya 'signup' modunu ayarla
Â  Â  Â  Â  Â  Â  Â  Â  setShowAuth(true); // ArtÄ±k GiriÅŸ ekranÄ±nÄ± gÃ¶ster
Â  Â  Â  Â  Â  Â  }}Â 
Â  Â  Â  Â  Â  Â  onLanguageChange={(newLang) => setLang(newLang as LangCode)}
Â  Â  Â  Â  />
Â  Â  Â  ); Â  Â 
Â  Â  }

Â  Â  // 2. HAYIR, GÄ°RÄ°Åž EKRANI (Login/Signup) GÃ–STERÄ°LSÄ°N
Â  Â  // (Senin kodunda eksik veya karÄ±ÅŸÄ±k olan kÄ±sÄ±m burasÄ±ydÄ±)
Â  Â  return (
Â  Â  Â  <KeyboardAvoidingView behavior={Platform.OS === "ios" ? "padding" : "height"} style={{ flex: 1 }}>
Â  Â  Â  Â  <TouchableWithoutFeedback onPress={Platform.OS !== 'web' ? Keyboard.dismiss : undefined}>
Â  Â  Â  Â  Â  <View style={{ flex: 1, backgroundColor: currentColors.bg, justifyContent: 'center', padding: 20 }}>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  {/* LOGO */}
Â  Â  Â  Â  Â  Â  <View style={{ alignItems: 'center', marginBottom: 40 }}>
Â  Â  Â  Â  Â  Â  Â  Â <Image source={require('../../assets/Logo/Logo.png')} style={{ width: 200, height: 60, resizeMode: 'contain' }} />
Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  {/* INPUTLAR (KullanÄ±cÄ± AdÄ± / Åžifre) */}
Â  Â  Â  Â  Â  Â  <View style={{ gap: 15 }}>
Â  Â  Â  Â  Â  Â  Â  Â {/* KayÄ±t Modundaysa KullanÄ±cÄ± AdÄ± Inputu */}
Â  Â  Â  Â  Â  Â  Â  Â {authMode === 'signup' && (
Â  Â  Â  Â  Â  Â  Â  Â  <View style={styles.authInputRow}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <User size={20} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TextInput value={username} onChangeText={setUsername} placeholder={t('social_search_tab_username')} placeholderTextColor={currentColors.subText} style={[styles.authInput, {color: currentColors.text}]} autoCapitalize='none' />
Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  )}

Â  Â  Â  Â  Â  Â  <View style={styles.authInputRow}>
Â  Â  Â  Â  Â  Â  Â  Â  <Mail size={20} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  Â  <TextInputÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value={email}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onChangeText={setEmail}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Placeholder'Ä± deÄŸiÅŸtirdik:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder={authMode === 'login' ? t('auth_email_username_placeholder') : t('email')}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholderTextColor={currentColors.subText}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={[styles.authInput, {color: currentColors.text}]}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  autoCapitalize='none'Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Login sÄ±rasÄ±nda klavyede @ iÅŸareti zorunlu olmasÄ±n diye default yapÄ±yoruz
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  keyboardType={authMode === 'login' ? "default" : "email-address"}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  returnKeyType="next" // Klavyede "Ä°leri" butonu gÃ¶sterir
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  blurOnSubmit={false} // Enter'a basÄ±nca klavyeyi kapatma
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onSubmitEditing={() => passwordRef.current?.focus()} // Åžifre kutusuna atla
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  <View style={styles.authInputRow}>
Â  Â  Â  Â  Â  Â  Â  Â  <Lock size={20} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  Â  <TextInput value={password} onChangeText={setPassword} placeholder={t('auth_password_placeholder')} placeholderTextColor={currentColors.subText} style={[styles.authInput, {color: currentColors.text}]} secureTextEntry ref={passwordRef} returnKeyType="done" Â onSubmitEditing={handleAuth} />
Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  {/* --- YENÄ° YER: BENÄ° HATIRLA (Sadece GiriÅŸ Modunda) --- */}
Â  Â  Â  Â  Â  Â  {authMode === 'login' && (
Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => setRememberMe(!rememberMe)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{flexDirection:'row', alignItems:'center', gap:10, marginBottom: 15, marginTop: 5}}
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 20, height: 20, borderRadius: 4, borderWidth: 2,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: rememberMe ? COLORS.primary : currentColors.subText,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems:'center', justifyContent:'center',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: rememberMe ? COLORS.primary : 'transparent'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {rememberMe && <Check size={14} color="#fff" />}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{color: currentColors.text, fontSize: 14}}>{t('remember_me')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  {/* -------------------------------------------------- */}

Â  Â  Â  Â  Â  Â  {/* 3. GÄ°RÄ°Åž BUTONU */}
Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={handleAuth} style={[styles.createBtn, {marginTop: 10}]}>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{color:'#fff', fontWeight:'bold', fontSize:16}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {authMode === 'login' ? t('auth_login_tab') : t('auth_signup_tab')}
Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  Â  {/* 4. ÅžÄ°FREMÄ° UNUTTUM BUTONU */}
Â  Â  Â  Â  Â  Â  Â  Â  {authMode === 'login' && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => router.push('/auth/forgot-password')}style={{ marginTop: 15, alignSelf: 'center', padding: 5 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.subText, fontSize: 14, fontWeight: '500' }}>{t('forgot_password')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  {/* ðŸ‘‡ðŸ‘‡ðŸ‘‡ BURAYI EKLE: GÄ°RÄ°Åž / KAYIT ARASI GEÃ‡Ä°Åž YAPMA BUTONU ðŸ‘‡ðŸ‘‡ðŸ‘‡ */}
Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', justifyContent: 'center', marginTop: 25, alignItems: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.subText, fontSize: 14 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {authMode === 'login' ? "HesabÄ±n yok mu? " : "Zaten hesabÄ±n var mÄ±? "}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => setAuthMode(authMode === 'login' ? 'signup' : 'login')}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: COLORS.primary, fontWeight: 'bold', fontSize: 14 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {authMode === 'login' ? t('auth_signup_tab') : t('auth_login_tab')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  </View>
Â  Â  Â  Â  <View style={{marginTop: 20, gap: 10}}>
Â  Â  Â  Â  Â  Â <TouchableOpacity disabled={!request} onPress={() => promptAsync()} style={[styles.socialBtn, {backgroundColor: currentColors.surface, flexDirection:'row', gap:10, justifyContent: 'center'}]}>
Â  Â  Â  Â  Â  Â  Â  <Globe size={20} color={currentColors.text} />Â 
Â  Â  Â  Â  Â  Â  Â  <Text style={{color: currentColors.text, fontWeight:'600'}}>{t('auth_google_continue')}</Text>
Â  Â  Â  Â  Â  Â </TouchableOpacity>
Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â {Platform.OS === 'ios' && (
Â  Â  Â  Â  Â  Â  Â <AppleAuthentication.AppleAuthenticationButtonÂ 
Â  Â  Â  Â  Â  Â  Â  Â buttonType={AppleAuthentication.AppleAuthenticationButtonType.SIGN_IN}Â 
Â  Â  Â  Â  Â  Â  Â  Â buttonStyle={isDark ? AppleAuthentication.AppleAuthenticationButtonStyle.WHITE : AppleAuthentication.AppleAuthenticationButtonStyle.BLACK}Â 
Â  Â  Â  Â  Â  Â  Â  Â cornerRadius={12}Â 
Â  Â  Â  Â  Â  Â  Â  Â style={{ width: '100%', height: 50 }}Â 
Â  Â  Â  Â  Â  Â  Â  Â onPress={handleAppleLogin}Â 
Â  Â  Â  Â  Â  Â  Â />
Â  Â  Â  Â  Â  Â )}
Â  Â  Â  Â  Â  Â {/* MÄ°SAFÄ°R GÄ°RÄ°ÅžÄ° - SADECE MOBÄ°LDE GÃ–ZÃœKSÃœN (WEB'DE GÄ°ZLE) */}
Â  Â  Â  Â  Â  Â  {Platform.OS !== 'web' && (
Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={handleGuestLogin}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{marginTop: 15, padding: 10, alignItems:'center'}}
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{color: currentColors.subText, fontSize: 14, textDecorationLine:'underline'}}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('continue_guest')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  {customToast.visible && (
Â  Â  Â  Â  Â  Â  Â  <View style={{
Â  Â  Â  Â  Â  Â  Â  Â  position: 'absolute', top: 50, left: 20, right: 20, zIndex: 9999, // Top deÄŸerini 50 yaptÄ±m
Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: customToast.type === 'error' ? '#fee2e2' : (customToast.type === 'warning' ? '#fef3c7' : '#f0fdf4'),
Â  Â  Â  Â  Â  Â  Â  Â  padding: 15, borderRadius: 16, flexDirection: 'row', alignItems: 'center', gap: 12,
Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: "#000", shadowOpacity: 0.2, shadowRadius: 10, elevation: 10,
Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 1, borderColor: customToast.type === 'error' ? '#ef4444' : (customToast.type === 'warning' ? '#f59e0b' : '#10b981')
Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ width: 36, height: 36, borderRadius: 18, backgroundColor: customToast.type === 'error' ? '#ef4444' : (customToast.type === 'warning' ? '#f59e0b' : '#10b981'), alignItems: 'center', justifyContent: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  {customToast.type === 'success' && <Check size={18} color="#fff" />}
Â  Â  Â  Â  Â  Â  Â  Â  Â  {customToast.type === 'error' && <X size={18} color="#fff" />}
Â  Â  Â  Â  Â  Â  Â  Â  Â  {customToast.type === 'warning' && <AlertCircle size={18} color="#fff" />}
Â  Â  Â  Â  Â  Â  Â  Â  Â  {customToast.type === 'info' && <Bell size={18} color="#fff" />}
Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flex: 1 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: '#1e293b', fontWeight: 'bold', fontSize: 13 }}>{customToast.title}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: '#475569', fontSize: 11 }}>{customToast.message}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => setCustomToast({ ...customToast, visible: false })}><X size={16} color="#475569" /></TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  </TouchableWithoutFeedback>
Â  Â  Â  </KeyboardAvoidingView>
Â  Â  );
Â  }

Â  Â  Â  Â  // --- E-POSTA DOÄžRULAMA EKRANI (Ara Katman) ---
Â  // KullanÄ±cÄ± giriÅŸ yapmÄ±ÅŸ ama e-postasÄ±nÄ± doÄŸrulamamÄ±ÅŸsa burasÄ± Ã§alÄ±ÅŸÄ±r.
Â  // Misafir kullanÄ±cÄ±lar (isAnonymous) bu kontrole takÄ±lmaz.
Â  if (user && !user.isAnonymous && !user.emailVerified) {
Â  Â  return (
Â  Â  Â  <SafeAreaView style={{ flex: 1, backgroundColor: currentColors.bg, justifyContent: 'center', alignItems: 'center', padding: 20 }}>
Â  Â  Â  Â  <View style={{ alignItems: 'center', maxWidth: 300 }}>
Â  Â  Â  Â  Â  <View style={{ width: 80, height: 80, borderRadius: 40, backgroundColor: '#fef3c7', alignItems: 'center', justifyContent: 'center', marginBottom: 20 }}>
Â  Â  Â  Â  Â  Â  <Mail size={40} color="#d97706" />
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  <Text style={{ fontSize: 22, fontWeight: 'bold', color: currentColors.text, textAlign: 'center', marginBottom: 10 }}>
Â  Â  Â  Â  Â  Â  E-posta DoÄŸrulamasÄ±
Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  <Text style={{ fontSize: 14, color: currentColors.subText, textAlign: 'center', marginBottom: 30, lineHeight: 22 }}>
Â  Â  Â  Â  Â  Â  GÃ¼venliÄŸiniz iÃ§in lÃ¼tfen <Text style={{fontWeight:'bold', color: currentColors.text}}>{user.email}</Text> adresine gÃ¶nderdiÄŸimiz baÄŸlantÄ±ya tÄ±klayarak hesabÄ±nÄ±zÄ± onaylayÄ±n.
Â  Â  Â  Â  Â  </Text>

Â  Â  Â  Â  Â  {/* 1. Kontrol Butonu: KullanÄ±cÄ± maildeki linke tÄ±kladÄ±ktan sonra buraya basÄ±p sayfayÄ± yeniler */}
Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  onPress={async () => {
Â  Â  Â  Â  Â  Â  Â  Â  setIsAuthLoading(true);
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await user.reload(); // Firebase'den gÃ¼ncel veriyi Ã§ek
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (auth.currentUser?.emailVerified) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // State'i gÃ¼ncelle ki ekran deÄŸiÅŸsin
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setUser({ ...user, emailVerified: true });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(t('success'), "HesabÄ±nÄ±z doÄŸrulandÄ±!", 'success');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(t('info'), "HenÃ¼z doÄŸrulanmamÄ±ÅŸ gÃ¶rÃ¼nÃ¼yor. LÃ¼tfen mailinizi kontrol edip tekrar deneyin.", 'warning');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log(e);
Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setIsAuthLoading(false);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  style={{ backgroundColor: COLORS.primary, width: '100%', padding: 15, borderRadius: 12, alignItems: 'center', marginBottom: 15 }}
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  {isAuthLoading ? <ActivityIndicator color="#fff" /> : <Text style={{ color: '#fff', fontWeight: 'bold', fontSize: 16 }}>DoÄŸrulamayÄ± Kontrol Et</Text>}
Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  {/* 2. Tekrar GÃ¶nder Butonu */}
Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  onPress={async () => {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await sendEmailVerification(user);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(t('success'), "DoÄŸrulama e-postasÄ± tekrar gÃ¶nderildi.", 'success');
Â  Â  Â  Â  Â  Â  Â  Â  } catch(e: any) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(e.code === 'auth/too-many-requests') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast("Hata", "Ã‡ok sÄ±k istek gÃ¶nderdiniz, lÃ¼tfen bekleyin.", 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast("Hata", "E-posta gÃ¶nderilemedi.", 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  style={{ padding: 15, width: '100%', alignItems: 'center', marginBottom: 15 }}
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  <Text style={{ color: COLORS.primary, fontWeight: '600' }}>Tekrar E-posta GÃ¶nder</Text>
Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  {/* 3. Ã‡Ä±kÄ±ÅŸ Yap / YanlÄ±ÅŸ Mail */}
Â  Â  Â  Â  Â  <TouchableOpacity onPress={handleLogout}>
Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.subText, fontSize: 13, textDecorationLine: 'underline' }}>
Â  Â  Â  Â  Â  Â  Â  FarklÄ± bir e-posta ile giriÅŸ yap
Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  </View>
Â  Â  Â  Â Â 
Â  Â  Â  Â  {/* Toast MesajÄ± GÃ¶stermek Ä°Ã§in */}
Â  Â  Â  Â  {customToast.visible && (
Â  Â  Â  Â  Â  Â  <View style={{
Â  Â  Â  Â  Â  Â  Â  Â  position: 'absolute', top: 50, left: 20, right: 20,
Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: customToast.type === 'error' ? '#fee2e2' : (customToast.type === 'warning' ? '#fef3c7' : '#f0fdf4'),
Â  Â  Â  Â  Â  Â  Â  Â  padding: 15, borderRadius: 16, flexDirection: 'row', alignItems: 'center', gap: 12,
Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: "#000", shadowOpacity: 0.1, elevation: 5, borderWidth: 1,Â 
Â  Â  Â  Â  Â  Â  Â  Â  borderColor: customToast.type === 'error' ? '#ef4444' : (customToast.type === 'warning' ? '#f59e0b' : '#10b981')
Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ flex: 1, color: '#1e293b', fontSize: 13 }}>{customToast.message}</Text>
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  )}
Â  Â  Â  </SafeAreaView>
Â  Â  );
Â  }

Â  Â  Â  Â  {/* ================================================================================= */}
Â  Â  Â  Â  {/* 1. HEADER (LOGO) - Chat odasÄ± hariÃ§ her yerde gÃ¶rÃ¼nÃ¼r */}
Â  Â  Â  Â  {/* ================================================================================= */}
Â  Â  Â  Â  return (
Â  Â  <KeyboardAvoidingView behavior={Platform.OS === "ios" ? "padding" : "height"} style={{ flex: 1 }}>
Â  Â  Â  <SafeAreaView style={[styles.container, { backgroundColor: currentColors.bg }]}>
Â  Â  Â  Â  <StatusBar barStyle={isDark ? 'light-content' : 'dark-content'} />

Â  Â  Â  Â  {activeTab !== 'chat_room' && (
Â  Â  Â  Â  Â  <View style={[styles.header, { justifyContent: 'center', paddingBottom: 5 }]}>
Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => setActiveTab('list')} activeOpacity={0.7}>
Â  Â  Â  Â  Â  Â  Â  <Image
Â  Â  Â  Â  Â  Â  Â  Â  source={require('../../assets/Logo/Logo.png')}
Â  Â  Â  Â  Â  Â  Â  Â  style={{ width: 150, height: 50, resizeMode: 'contain' }}
Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  {/* --- 1. YENÄ° EKLENEN: SOL BUTON (GEÃ‡MÄ°Åž) --- */}
Â  Â  Â  Â  Â  Â  {activeTab === 'list' && (
Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => setIsHistoryModalOpen(true)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  position: 'absolute',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  left: 20, // SOL TARAFTA
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  top: 25,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding: 8,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isDark ? 'rgba(255,255,255,0.1)' : '#f1f5f9',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 12Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <CheckCircle2 size={22} color={COLORS.success} />
Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  {/* SAÄž BUTON: TÃœM GÃ–REVLER (Sadece 'list' sekmesinde gÃ¶rÃ¼nsÃ¼n) */}
Â  Â  Â  Â  Â  Â  {activeTab === 'list' && (
Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => setIsAllTasksModalOpen(true)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  position: 'absolute',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  right: 20,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  top: 25, // HizalamayÄ± ayarlamak gerekebilir
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding: 8,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isDark ? 'rgba(255,255,255,0.1)' : '#f1f5f9',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 12Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <CalendarDays size={22} color={COLORS.primary} />
Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  {/* SAÄž BUTON: ALIÅžKANLIK ANALÄ°ZÄ° (Sadece 'habits' sekmesinde) */}
Â  Â  Â  Â  Â  Â  {activeTab === 'habits' && (
Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => setIsHabitStatsModalOpen(true)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{ position: 'absolute', right: 20, top: 25, padding: 8, backgroundColor: isDark ? 'rgba(255,255,255,0.1)' : '#f1f5f9', borderRadius: 12 }}
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <BarChart3 size={22} color={COLORS.primary} />
Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  )}

Â  Â  Â  Â  {/* ================================================================================= */}
Â  Â  Â  Â  {/* 2. MODERN TARÄ°H NAVÄ°GASYONU & TAKVÄ°M */}
Â  Â  Â  Â  {/* ================================================================================= */}
Â  Â  Â  Â  {(activeTab === 'list' || activeTab === 'habits') && (
Â  Â  Â  Â  Â  <View style={{ marginBottom: 10, zIndex: 20 }}>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  {/* ÃœST NAVÄ°GASYON BARI */}
Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  flexDirection: 'row',Â 
Â  Â  Â  Â  Â  Â  Â  alignItems: 'center',Â 
Â  Â  Â  Â  Â  Â  Â  justifyContent: 'space-between',Â 
Â  Â  Â  Â  Â  Â  Â  paddingHorizontal: 20,Â 
Â  Â  Â  Â  Â  Â  Â  marginBottom: isCalendarExpanded ? 15 : 5Â 
Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  {/* SOL OK */}
Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => changeDate(-1)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  style={{
Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 40, height: 40, borderRadius: 20,
Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isDark ? 'rgba(255,255,255,0.05)' : '#fff',
Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center', justifyContent: 'center',
Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 1, borderColor: isDark ? 'transparent' : '#f1f5f9',
Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: "#000", shadowOpacity: 0.05, shadowRadius: 5, elevation: 2
Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  <ChevronLeft size={20} color={currentColors.text} />
Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  Â  Â  {/* ORTA TARÄ°H BUTONU (Pill Shape) */}
Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity
Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  LayoutAnimation.configureNext(LayoutAnimation.Presets.easeInEaseOut);
Â  Â  Â  Â  Â  Â  Â  Â  Â  setIsCalendarExpanded(!isCalendarExpanded);
Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  activeOpacity={0.7}
Â  Â  Â  Â  Â  Â  Â  Â  style={{
Â  Â  Â  Â  Â  Â  Â  Â  Â  flexDirection: 'row',
Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center',
Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isCalendarExpanded ? COLORS.primary : (isDark ? 'rgba(255,255,255,0.05)' : '#fff'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingHorizontal: 20,
Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingVertical: 10,
Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 24,
Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: isCalendarExpanded ? COLORS.primary : (isDark ? 'transparent' : '#f1f5f9'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: isCalendarExpanded ? COLORS.primary : "#000",
Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowOpacity: isCalendarExpanded ? 0.3 : 0.05,
Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowRadius: 8, elevation: isCalendarExpanded ? 4 : 2,
Â  Â  Â  Â  Â  Â  Â  Â  Â  gap: 8
Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  <CalendarIcon size={16} color={isCalendarExpanded ? '#fff' : COLORS.primary} />
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  fontSize: 15,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  fontWeight: '700',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  color: isCalendarExpanded ? '#fff' : currentColors.textÂ 
Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  {selectedDate.getDate()} {getGreeting(lang) === 'tr' ? ' ' : '/'} {selectedDate.getMonth() + 1} {selectedDate.getFullYear()}
Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  {isCalendarExpanded ?Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  <ChevronUp size={16} color="#fff" /> :Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  <ChevronDown size={16} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  Â  Â  {/* SAÄž OK */}
Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => changeDate(1)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  style={{
Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 40, height: 40, borderRadius: 20,
Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isDark ? 'rgba(255,255,255,0.05)' : '#fff',
Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center', justifyContent: 'center',
Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 1, borderColor: isDark ? 'transparent' : '#f1f5f9',
Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: "#000", shadowOpacity: 0.05, shadowRadius: 5, elevation: 2
Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  <ChevronRight size={20} color={currentColors.text} />
Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  {/* AÃ‡ILIR TAKVÄ°M (AKORDEON) */}
Â  Â  Â  Â  Â  Â  {isCalendarExpanded && (
Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: currentColors.surface,Â 
Â  Â  Â  Â  Â  Â  Â  Â  marginHorizontal: 20,Â 
Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 24,Â 
Â  Â  Â  Â  Â  Â  Â  Â  padding: 15,Â 
Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 1,Â 
Â  Â  Â  Â  Â  Â  Â  Â  borderColor: isDark ? '#334155' : '#f1f5f9',Â 
Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: "#000", shadowOffset: { width: 0, height: 10 }, shadowOpacity: 0.1, shadowRadius: 20, elevation: 10Â 
Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  <Calendar
Â  Â  Â  Â  Â  Â  Â  Â  Â  current={getISODate(selectedDate)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  key={`${lang}-${theme}`}
Â  Â  Â  Â  Â  Â  Â  Â  Â  markingType={'custom'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  markedDates={calendarMarks}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onDayPress={(day: any) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newDate = new Date(day.timestamp);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  newDate.setMinutes(newDate.getMinutes() + newDate.getTimezoneOffset());
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setSelectedDate(newDate);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  LayoutAnimation.configureNext(LayoutAnimation.Presets.easeInEaseOut);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setIsCalendarExpanded(false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  theme={{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: 'transparent',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  calendarBackground: 'transparent',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textSectionTitleColor: currentColors.subText,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedDayBackgroundColor: COLORS.primary,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedDayTextColor: '#ffffff',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  todayTextColor: COLORS.primary,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayTextColor: currentColors.text,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textDisabledColor: isDark ? '#475569' : '#d9e1e8',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  arrowColor: COLORS.primary,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  monthTextColor: currentColors.text,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  indicatorColor: COLORS.primary,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textDayFontWeight: '600',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textMonthFontWeight: '800',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textDayHeaderFontWeight: 'bold',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textDayFontSize: 14,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textMonthFontSize: 16,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textDayHeaderFontSize: 12
Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  )}

Â  Â  Â  Â  {/* ================================================================================= */}
Â  Â  Â  Â  {/* 3. ANA Ä°Ã‡ERÄ°K (PAGER VIEW veya CHAT ROOM) */}
Â  Â  Â  Â  {/* ================================================================================= */}
Â  Â  Â  Â  {activeTab === 'chat_room' && chatTarget ? (
Â  Â  Â  Â  Â  renderChatRoom()
Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  <View style={{ flex: 1 }}>
Â  Â  Â  Â  Â  Â  <PagerView
Â  Â  Â  Â  Â  Â  Â  ref={pagerRef}
Â  Â  Â  Â  Â  Â  Â  style={{ flex: 1,width: '100%', height: '100%' }}
Â  Â  Â  Â  Â  Â  Â  initialPage={TAB_ORDER.indexOf(activeTab) >= 0 ? TAB_ORDER.indexOf(activeTab) : 0}
Â  Â  Â  Â  Â  Â  Â  onPageSelected={handlePageScroll}
Â  Â  Â  Â  Â  Â  Â  scrollEnabled={Platform.OS !== 'web'}
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â {/* --- SAYFA 0: GÃ–REVLER (TASKS) --- */}
Â  Â  Â  Â  Â  Â  Â  <View key="0" style={{ flex: 1, width: '100%' }}>
Â  Â  Â  Â  Â  Â  Â  Â  <ScrollViewÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  contentContainerStyle={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingHorizontal: 20,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingBottom: 120,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: '100%',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maxWidth: 600, // Web'de iÃ§eriÄŸin Ã§ok geniÅŸlemesini engeller
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignSelf: 'center', // Web'de iÃ§eriÄŸi ortalar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingTop: 10
Â  Â  Â  Â  Â  Â  Â  Â  Â  }}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  showsVerticalScrollIndicator={false}
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- 1. MODERN PROGRESS BAR --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  {totalTodaysTasks > 0 && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: COLORS.primary,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 24,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding: 20,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marginBottom: 25,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: COLORS.primary,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowOpacity: 0.4,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowRadius: 12,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowOffset: { width: 0, height: 8 },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  elevation: 8,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  position: 'relative',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  overflow: 'hidden'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Arka Plan SÃ¼slemesi (Circle) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ position: 'absolute', top: -60, left: -60, width: 320, height: 140, borderRadius: 50, backgroundColor: 'rgba(255,255,255,0.1)' }} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', marginBottom: 15 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: 'rgba(255,255,255,0.9)', fontSize: 13, fontWeight: '600', letterSpacing: 0.5 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('daily_progress').toUpperCase()}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: '#fff', fontSize: 32, fontWeight: '900', marginTop: 4 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {Math.round(taskProgress)}%
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ backgroundColor: 'rgba(255,255,255,0.2)', paddingHorizontal: 12, paddingVertical: 6, borderRadius: 12 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: '#fff', fontSize: 14, fontWeight: 'bold' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {completedTodaysTasks} / {totalTodaysTasks}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ height: 8, backgroundColor: 'rgba(255,255,255,0.2)', borderRadius: 4, overflow: 'hidden' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ width: `${taskProgress}%`, height: '100%', backgroundColor: '#fff', borderRadius: 4 }} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  )}

Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- 2. GECÄ°KEN GÃ–REVLER (OVERDUE) - GÃœNCELLENMÄ°Åž --- */}
Â  Â  Â  {overdueTasks.length > 0 && (
Â  Â  Â  Â  <View style={{ marginBottom: 25 }}>
Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  onPress={() => {Â 
Â  Â  Â  Â  Â  Â  Â  LayoutAnimation.configureNext(LayoutAnimation.Presets.easeInEaseOut);Â 
Â  Â  Â  Â  Â  Â  Â  setIsOverdueExpanded(!isOverdueExpanded);Â 
Â  Â  Â  Â  Â  Â  }}Â 
Â  Â  Â  Â  Â  Â  activeOpacity={0.8}
Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  flexDirection: 'row',Â 
Â  Â  Â  Â  Â  Â  Â  alignItems: 'center',Â 
Â  Â  Â  Â  Â  Â  Â  justifyContent: 'space-between',Â 
Â  Â  Â  Â  Â  Â  Â  padding: 16,Â 
Â  Â  Â  Â  Â  Â  Â  backgroundColor: isDark ? 'rgba(239, 68, 68, 0.1)' : '#fef2f2',Â 
Â  Â  Â  Â  Â  Â  Â  borderRadius: 18,Â 
Â  Â  Â  Â  Â  Â  Â  borderWidth: 1,Â 
Â  Â  Â  Â  Â  Â  Â  borderColor: isDark ? 'rgba(239, 68, 68, 0.3)' : '#fee2e2'
Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 12 }}>
Â  Â  Â  Â  Â  Â  Â  <View style={{ backgroundColor: COLORS.danger, padding: 8, borderRadius: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  <AlertCircle size={20} color="#fff" />
Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: COLORS.danger, fontWeight: '800', fontSize: 15 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('overdue')}
Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: COLORS.danger, fontSize: 11, opacity: 0.8, fontWeight: '500' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  {overdueTasks.length} {t('tasks_waiting')}
Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  <View style={{ backgroundColor: COLORS.danger + '15', padding: 6, borderRadius: 20 }}>
Â  Â  Â  Â  Â  Â  Â  {isOverdueExpanded ? <ChevronUp size={20} color={COLORS.danger} /> : <ChevronDown size={20} color={COLORS.danger} />}
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  {isOverdueExpanded && (
Â  Â  Â  Â  Â  Â  <View style={{ marginTop: 12, gap: 10, paddingHorizontal: 4 }}>
Â  Â  Â  Â  Â  Â  Â  {overdueTasks.map((task, index) => (
Â  Â  Â  Â  Â  Â  Â  Â  <ViewÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  key={task.id}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flexDirection: 'row', alignItems: 'center', justifyContent: 'space-between',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding: 16, backgroundColor: currentColors.surface,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 16, borderLeftWidth: 4, borderLeftColor: COLORS.danger,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: COLORS.danger, shadowOffset: { width: 0, height: 2 }, shadowOpacity: 0.05, shadowRadius: 4, elevation: 2Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* 1. TAMAMLAMA KUTUCUÄžU (YENÄ° EKLENDÄ°) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => toggleTask(task)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 24, height: 24, borderRadius: 12, borderWidth: 2,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: COLORS.danger, marginRight: 12,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center', justifyContent: 'center'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* BoÅŸ daire, basÄ±nca tamamlandÄ± sayÄ±lÄ±r ve listeden gider */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flex: 1, marginRight: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text numberOfLines={2} style={{ fontSize: 15, fontWeight: '600', color: currentColors.text, marginBottom: 6 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {task.text}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 6 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <CalendarIcon size={12} color={COLORS.danger} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 12, color: COLORS.danger, fontWeight: '600' }}>{task.date}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  {/* AKSÄ°YON BUTONLARI */}
Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', gap: 8 }}>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  {/* 2. DÃœZENLEME BUTONU (YENÄ° EKLENDÄ° - Tarihi deÄŸiÅŸtirmek iÃ§in) */}
Â  Â  Â  Â  Â  Â  Â  Â  {(task.assignedBy === user.uid || task.assignedTo === user.uid) && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => openEditModal(task)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{ padding: 10, backgroundColor: COLORS.primary + '15', borderRadius: 12 }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Edit2 size={18} color={COLORS.primary} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  )}

Â  Â  Â  Â  Â  Â  Â  Â  {/* 3. SÄ°LME BUTONU (Zaten vardÄ±) */}
Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => deleteTask(task)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  hitSlop={{ top: 10, bottom: 10, left: 10, right: 10 }}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{ padding: 10, backgroundColor: isDark ? 'rgba(239, 68, 68, 0.1)' : '#fef2f2', borderRadius: 12 }}
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  <Trash2 size={18} color={COLORS.danger} />
Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  ))}
Â  Â  Â  </View>
Â  Â  )}
Â  </View>
)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- 3. AKTÄ°F GÃ–REVLER LÄ°STESÄ° --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ gap: 12 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {activeTasks.length > 0 ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  activeTasks.map((task, index) => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <React.Fragment key={task.id}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {renderTask(task)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Reklam AlanÄ± (Her 5 gÃ¶revde bir) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {!isPremium && (index + 1) % 5 === 0 && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ marginVertical: 15, alignItems: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <OmmioAdBanner isPremium={false} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </React.Fragment>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  /* BOÅž DURUM (EMPTY STATE) */
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completedTasks.length === 0 && overdueTasks.length === 0 && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ alignItems: 'center', justifyContent: 'center', marginTop: 40, padding: 30 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 100, height: 100, borderRadius: 50,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isDark ? 'rgba(99, 102, 241, 0.1)' : '#e0e7ff',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center', justifyContent: 'center', marginBottom: 20Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Check size={48} color={COLORS.primary} strokeWidth={2.5} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 22, fontWeight: '800', color: currentColors.text, marginBottom: 8, textAlign: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('all_good')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 15, color: currentColors.subText, textAlign: 'center', lineHeight: 22, maxWidth: 250 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('no_tasks_today')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- 4. TAMAMLANAN GÃ–REVLER (AKORDEON) --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  {completedTasks.length > 0 && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ marginTop: 30 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => { LayoutAnimation.configureNext(LayoutAnimation.Presets.easeInEaseOut); setIsCompletedExpanded(!isCompletedExpanded); }}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  activeOpacity={0.7}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flexDirection: 'row', alignItems: 'center', justifyContent: 'space-between',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding: 14, backgroundColor: isDark ? 'rgba(255,255,255,0.05)' : '#f8fafc',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 14, borderWidth: 1, borderColor: isDark ? 'rgba(255,255,255,0.1)' : '#e2e8f0'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ backgroundColor: COLORS.success + '20', padding: 6, borderRadius: 8 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <CheckCircle2 size={18} color={COLORS.success} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.text, fontWeight: '700', fontSize: 14 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('completed')} <Text style={{color: currentColors.subText}}>({completedTasks.length})</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isCompletedExpanded ? <ChevronUp size={18} color={currentColors.subText} /> : <ChevronDown size={18} color={currentColors.subText} />}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isCompletedExpanded && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ opacity: 0.6, gap: 10, marginTop: 15 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {completedTasks.map(task => renderTask(task))}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  )}

Â  Â  Â  Â  Â  Â  Â  Â  </ScrollView>
Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  {/* --- SAYFA 1: ALIÅžKANLIKLAR (HABITS) --- */}
Â  Â  Â  Â  Â  Â  Â  <View key="1" style={{ flex: 1, width: '100%' }}>
Â  Â  Â  Â  Â  Â  Â  Â  <ScrollViewÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  contentContainerStyle={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingHorizontal: 20,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingBottom: 120,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: '100%',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maxWidth: 600, // Web'de iÃ§eriÄŸin yayÄ±lmasÄ±nÄ± engeller
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignSelf: 'center', // Web'de iÃ§eriÄŸi ortalar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingTop: 10
Â  Â  Â  Â  Â  Â  Â  Â  Â  }}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  showsVerticalScrollIndicator={false}
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- 1. MODERN PROGRESS BAR --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: COLORS.primary,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 24,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding: 20,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marginBottom: 25,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: COLORS.primary,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowOpacity: 0.4,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowRadius: 12,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowOffset: { width: 0, height: 8 },Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  elevation: 8,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  position: 'relative',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  overflow: 'hidden'
Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Dekoratif Arka Plan */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ position: 'absolute', top: -60, left: -60, width: 320, height: 140, borderRadius: 70, backgroundColor: 'rgba(255,255,255,0.1)' }} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', marginBottom: 15 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: 'rgba(255,255,255,0.9)', fontSize: 13, fontWeight: '600', letterSpacing: 0.5 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('daily_progress').toUpperCase()}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: '#fff', fontSize: 32, fontWeight: '900', marginTop: 4 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {Math.round(habitProgress)}%
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ backgroundColor: 'rgba(255,255,255,0.2)', paddingHorizontal: 12, paddingVertical: 6, borderRadius: 12 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: '#fff', fontSize: 14, fontWeight: 'bold' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {completedTodaysHabits} / {totalTodaysHabits}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ height: 8, backgroundColor: 'rgba(255,255,255,0.2)', borderRadius: 4, overflow: 'hidden' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ width: `${habitProgress}%`, height: '100%', backgroundColor: '#fff', borderRadius: 4 }} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- 2. ALIÅžKANLIK LÄ°STESÄ° --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ gap: 12 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {todaysHabits.length > 0 ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  todaysHabits.map((habit, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isDone = habit.completedDates.includes(currentISODate);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const streak = habit.completedDates.length;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cat = categories.find(c => c.id === habit.categoryId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cc = getCategoryColor(cat?.color || 'purple');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <React.Fragment key={habit.id}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => toggleHabitCompletion(habit, currentISODate)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  activeOpacity={0.8}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flexDirection: 'row',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  justifyContent: 'space-between',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding: 16,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: currentColors.surface,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 20,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: isDone ? 'transparent' : (isDark ? '#334155' : '#f1f5f9'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opacity: isDone ? 0.7 : 1, // TamamlanÄ±nca hafif silikleÅŸsin
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: "#000",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowOffset: { width: 0, height: 4 },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowOpacity: isDone ? 0 : 0.05, // TamamlanÄ±nca gÃ¶lge kalksÄ±n
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowRadius: 8,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  elevation: isDone ? 0 : 3
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 14, flex: 1 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Custom Checkbox (Yuvarlak) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 28, height: 28, borderRadius: 14,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: isDone ? 0 : 2,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: isDone ? 'transparent' : '#cbd5e1',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isDone ? COLORS.primary : 'transparent',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center', justifyContent: 'center'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isDone && <Check size={16} color="#fff" strokeWidth={3} />}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flex: 1 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fontSize: 16,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fontWeight: '700',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: currentColors.text,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textDecorationLine: isDone ? 'line-through' : 'none',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marginBottom: 6
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {habit.title}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Rozetler (Badges) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', flexWrap: 'wrap', gap: 6 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Streak (Seri) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 4, backgroundColor: '#fff7ed', paddingHorizontal: 8, paddingVertical: 3, borderRadius: 8, borderWidth: 1, borderColor: '#ffedd5' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Flame size={12} color="#f97316" fill="#f97316" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 11, color: '#c2410c', fontWeight: '700' }}>{streak} {t('day')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Kategori */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ backgroundColor: cc.bg, paddingHorizontal: 8, paddingVertical: 3, borderRadius: 8 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 11, color: cc.hex, fontWeight: '600' }}>{cat?.name}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Saat */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {habit.notificationTime && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 4, backgroundColor: isDark ? 'rgba(255,255,255,0.05)' : '#f1f5f9', paddingHorizontal: 8, paddingVertical: 3, borderRadius: 8 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 11, color: currentColors.subText }}>â° {habit.notificationTime}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Silme Butonu */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => askConfirmation(t('delete'), t('delete_habit_confirm'), () => deleteHabit(habit), true)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hitSlop={{ top: 10, bottom: 10, left: 10, right: 10 }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{ padding: 8 }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Trash2 size={18} color={currentColors.subText} style={{ opacity: 0.6 }} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Reklam AlanÄ± (Her 5 alÄ±ÅŸkanlÄ±kta bir) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {!isPremium && (index + 1) % 5 === 0 && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ marginVertical: 15, alignItems: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <OmmioAdBanner isPremium={false} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </React.Fragment>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  /* BOÅž DURUM (EMPTY STATE) */
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ alignItems: 'center', justifyContent: 'center', marginTop: 40, padding: 30 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 100, height: 100, borderRadius: 50,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isDark ? 'rgba(99, 102, 241, 0.1)' : '#e0e7ff',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center', justifyContent: 'center', marginBottom: 20Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Repeat size={48} color={COLORS.primary} strokeWidth={2.5} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 22, fontWeight: '800', color: currentColors.text, marginBottom: 8, textAlign: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('new_habit')}!
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 15, color: currentColors.subText, textAlign: 'center', lineHeight: 22, maxWidth: 250 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('motivational_daily')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  </ScrollView>
Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  {/* --- SAYFA 2: MESAJLAR (MESSAGES) --- */}
Â  Â  Â  Â  Â  Â  Â  <View key="2" style={{ flex: 1, width: '100%' }}>
Â  Â  Â  Â  Â  Â  Â  Â  <ScrollViewÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  contentContainerStyle={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingHorizontal: 20,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingBottom: 120,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: '100%',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maxWidth: 600, // Web'de iÃ§eriÄŸi sÄ±nÄ±rlar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignSelf: 'center', // Ortalar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingTop: 10
Â  Â  Â  Â  Â  Â  Â  Â  Â  }}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  showsVerticalScrollIndicator={false}
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- MÄ°SAFÄ°R KULLANICI UYARISI --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  {user.isAnonymous ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  justifyContent: 'center',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marginTop: 40,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: currentColors.surface,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding: 30,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 24,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: "#000", shadowOpacity: 0.05, shadowRadius: 10, elevation: 5
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ width: 80, height: 80, borderRadius: 40, backgroundColor: COLORS.primary + '15', alignItems: 'center', justifyContent: 'center', marginBottom: 20 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <MessageCircle size={40} color={COLORS.primary} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ textAlign: 'center', fontWeight: '800', fontSize: 20, color: currentColors.text, marginBottom: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('profile_edit_desc')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ textAlign: 'center', color: currentColors.subText, marginBottom: 25, fontSize: 14, lineHeight: 20, maxWidth: 280 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('messaging_guest_desc')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => setIsGuestModalOpen(true)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: COLORS.primary,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingHorizontal: 30,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingVertical: 14,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 16,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: COLORS.primary, shadowOpacity: 0.3, shadowRadius: 8, elevation: 4
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: '#fff', fontWeight: 'bold', fontSize: 16 }}>{t('create_ac')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  /* --- MESAJ LÄ°STESÄ° --- */
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ gap: 12 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {contacts.length === 0 ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  /* BOÅž DURUM (EMPTY STATE) */
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ alignItems: 'center', marginTop: 60, opacity: 0.8 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ width: 100, height: 100, borderRadius: 50, backgroundColor: isDark ? 'rgba(255,255,255,0.05)' : '#f1f5f9', alignItems: 'center', justifyContent: 'center', marginBottom: 20 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <MessageCircle size={40} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 18, fontWeight: '700', color: currentColors.text, marginBottom: 8 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('no_connections')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.subText, textAlign: 'center', maxWidth: 250 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ArkadaÅŸ ekleyerek sohbet etmeye baÅŸlayÄ±n.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  contacts
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .sort((a, b) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const timeA = chatPreviews[a.uid]?.timestamp?.seconds || 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const timeB = chatPreviews[b.uid]?.timestamp?.seconds || 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return timeB - timeA;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .map(contact => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const preview = chatPreviews[contact.uid] || { text: "", timestamp: null, unread: 0 };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const hasUnread = preview.unread > 0;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  key={contact.uid}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => { setActiveTab('chat_room'); setChatTarget(contact); }}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  activeOpacity={0.7}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flexDirection: 'row',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: currentColors.surface,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding: 16,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 20,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: isDark ? '#334155' : 'transparent',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: "#000", shadowOffset: { width: 0, height: 2 }, shadowOpacity: 0.05, shadowRadius: 5, elevation: 2
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Avatar */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ position: 'relative', marginRight: 15 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 56, height: 56, borderRadius: 28,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: COLORS.secondary,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center', justifyContent: 'center',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 2, borderColor: currentColors.bgÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {contact.photoURL ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Image source={{ uri: contact.photoURL }} style={{ width: '100%', height: '100%', borderRadius: 28 }} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontWeight: '800', color: '#fff', fontSize: 20 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {contact.username[0].toUpperCase()}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Opsiyonel: Online Status Indicator (Åžu an statik, ilerde dinamik yapÄ±labilir) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* <View style={{ position: 'absolute', bottom: 2, right: 2, width: 14, height: 14, borderRadius: 7, backgroundColor: '#10b981', borderWidth: 2, borderColor: currentColors.surface }} /> */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Ä°Ã§erik */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flex: 1 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', justifyContent: 'space-between', marginBottom: 4, alignItems: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TextÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  numberOfLines={1}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{ fontSize: 16, fontWeight: '700', color: currentColors.text, flex: 1, marginRight: 10 }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {contact.displayName || contact.username}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {preview.timestamp && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fontSize: 11,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: hasUnread ? COLORS.primary : currentColors.subText,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fontWeight: hasUnread ? '700' : '500'Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {formatChatTime(preview.timestamp)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TextÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  numberOfLines={1}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fontSize: 13,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: hasUnread ? currentColors.text : currentColors.subText,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fontWeight: hasUnread ? '600' : '400',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flex: 1,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marginRight: 10Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {preview.text || t('start_chatting')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {hasUnread && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: COLORS.primary,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingHorizontal: 8,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  height: 20,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 10,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  justifyContent: 'center'Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: '#fff', fontSize: 10, fontWeight: 'bold' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {preview.unread > 9 ? '9+' : preview.unread}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  </ScrollView>
Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  {/* --- SAYFA 3: SOSYAL (SOCIAL) --- */}
Â  Â  Â  Â  Â  Â  Â  <View key="3" style={{ flex: 1, width: '100%' }}>
Â  Â  Â  Â  Â  Â  Â  Â  <ScrollViewÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  contentContainerStyle={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingHorizontal: 20,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingBottom: 120,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: '100%',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maxWidth: 600, // Web uyumluluÄŸu
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignSelf: 'center', // Ortala
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingTop: 10
Â  Â  Â  Â  Â  Â  Â  Â  Â  }}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  showsVerticalScrollIndicator={false}
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- MÄ°SAFÄ°R KULLANICI UYARISI --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  {user.isAnonymous ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  justifyContent: 'center',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marginTop: 40,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: currentColors.surface,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding: 30,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 24,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: "#000", shadowOpacity: 0.05, shadowRadius: 10, elevation: 5
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ width: 80, height: 80, borderRadius: 40, backgroundColor: COLORS.primary + '15', alignItems: 'center', justifyContent: 'center', marginBottom: 20 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Users size={40} color={COLORS.primary} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ textAlign: 'center', fontWeight: '800', fontSize: 20, color: currentColors.text, marginBottom: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('social1')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ textAlign: 'center', color: currentColors.subText, marginBottom: 25, fontSize: 14, lineHeight: 20, maxWidth: 280 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('register_af')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => setIsGuestModalOpen(true)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: COLORS.primary,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingHorizontal: 30,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingVertical: 14,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 16,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: COLORS.primary, shadowOpacity: 0.3, shadowRadius: 8, elevation: 4
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: '#fff', fontWeight: 'bold', fontSize: 16 }}>{t('create_ac')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ gap: 25 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- BAÅžLIK & EKLEME BUTONU --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', marginTop: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 24, fontWeight: '800', color: currentColors.text }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('friends')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => { if (!checkGuest("ArkadaÅŸ Ekleme")) setIsNetworkModalOpen(true); }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 40, height: 40, borderRadius: 14,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: COLORS.primary + '15',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center', justifyContent: 'center'Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <UserPlus size={22} color={COLORS.primary} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- ARKADAÅžLIK Ä°STEKLERÄ° --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {friendRequests.length > 0 && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 13, fontWeight: '700', color: currentColors.subText, marginBottom: 12, letterSpacing: 0.5 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('social_pending_requests').toUpperCase()}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {friendRequests.map(req => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ViewÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  key={req.id}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: currentColors.surface,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding: 16,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 20,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marginBottom: 12,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flexDirection: 'row',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  justifyContent: 'space-between',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderLeftWidth: 4,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderLeftColor: COLORS.warning,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: "#000", shadowOpacity: 0.05, shadowRadius: 8, elevation: 3
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.text, fontWeight: '700', fontSize: 16 }}>{req.fromUsername}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.subText, fontSize: 12, marginTop: 2 }}>Ä°stek gÃ¶nderdi</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', gap: 12 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => rejectRequest(req.id)} style={{ padding: 6, backgroundColor: '#fee2e2', borderRadius: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <X size={20} color={COLORS.danger} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => acceptRequest(req)} style={{ padding: 6, backgroundColor: '#dcfce7', borderRadius: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Check size={20} color={COLORS.success} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- GRUP ALIÅžKANLIKLARI BÃ–LÃœMÃœ --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', marginBottom: 15, marginTop: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 20, fontWeight: '800', color: currentColors.text }}>{t('groups') || "Gruplar"}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => setIsGroupModalOpen(true)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{ backgroundColor: isDark ? 'rgba(255,255,255,0.1)' : '#f1f5f9', padding: 8, borderRadius: 12 }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Plus size={20} color={COLORS.primary} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {groupHabits.length > 0 ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {groupHabits.map(group => renderGroupHabitCard(group))}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ padding: 20, backgroundColor: currentColors.surface, borderRadius: 20, alignItems: 'center', marginBottom: 20, borderStyle:'dashed', borderWidth:1, borderColor: currentColors.subText }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Users size={32} color={currentColors.subText} style={{ marginBottom: 10 }} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.subText, textAlign: 'center' }}>ArkadaÅŸlarÄ±nla ortak bir hedef belirle!</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => setIsGroupModalOpen(true)}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: COLORS.primary, fontWeight: 'bold', marginTop: 5 }}>+ Grup OluÅŸtur</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- ARKADAÅž LÄ°STESÄ° --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {contacts.length === 0 && friendRequests.length === 0 ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ alignItems: 'center', marginTop: 40, opacity: 0.6 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Users size={48} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ textAlign: 'center', color: currentColors.subText, marginTop: 15, fontSize: 15 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('no_users')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ gap: 12 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- SOSYAL SEKME KÄ°ÅžÄ° LÄ°STESÄ° (TEMÄ°ZLENMÄ°Åž) --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {contacts.map(contact => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isExpanded = expandedContactId === contact.uid;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // GÃ¶rev yorum sayÄ±sÄ±nÄ± gÃ¼venli al
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const taskUnread = taskUnreadCounts[contact.uid] || 0;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ViewÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  key={contact.uid}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: currentColors.surface,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 24,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marginBottom: 10,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 1,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: isDark ? '#334155' : 'transparent',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: "#000", shadowOpacity: 0.05, shadowRadius: 8, elevation: 2,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  overflow: 'hidden'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* 1. TIKLANABÄ°LÄ°R ANA SATIR */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  LayoutAnimation.configureNext(LayoutAnimation.Presets.easeInEaseOut);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setExpandedContactId(isExpanded ? null : contact.uid);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  activeOpacity={0.7}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{ flexDirection: 'row', alignItems: 'center', padding: 16 }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* AVATAR ALANI */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ position: 'relative', marginRight: 15 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ width: 52, height: 52, borderRadius: 26, backgroundColor: COLORS.secondary, alignItems: 'center', justifyContent: 'center', borderWidth: 2, borderColor: currentColors.bg }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {contact.photoURL ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Image source={{ uri: contact.photoURL }} style={{ width: '100%', height: '100%', borderRadius: 26 }} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontWeight: '800', color: '#fff', fontSize: 20 }}>{contact.username[0].toUpperCase()}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* ðŸ‘‡ KIRMIZI KUTUCUK (Sadece GÃ¶rev MesajÄ± Varsa) ðŸ‘‡ */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {taskUnread > 0 && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  position: 'absolute', top: -2, right: -2, width: 20, height: 20,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 10, backgroundColor: COLORS.danger, borderWidth: 2, borderColor: currentColors.surface,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center', justifyContent: 'center', zIndex: 999, elevation: 10
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ListTodo size={10} color="#fff" strokeWidth={4} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Ä°SÄ°M ALANI */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flex: 1 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 16, fontWeight: '700', color: currentColors.text }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {contact.displayName || contact.username}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Alt metin */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text numberOfLines={1} style={{ fontSize: 13, color: taskUnread > 0 ? COLORS.primary : currentColors.subText, fontWeight: taskUnread > 0 ? '600' : '400' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {taskUnread > 0 ? `ðŸ“‹ ${taskUnread} gÃ¶rev yorumu` : `@${contact.username}`}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* OK Ä°KONU */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ backgroundColor: isDark ? 'rgba(255,255,255,0.05)' : '#f8fafc', padding: 8, borderRadius: 12 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isExpanded ? <ChevronUp size={18} color={currentColors.subText} /> : <ChevronDown size={18} color={currentColors.subText} />}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* 2. GENÄ°ÅžLEYEN DETAY ALANI (TouchableOpacity'nin DIÅžINDA olmalÄ±) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isExpanded && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ backgroundColor: isDark ? 'rgba(0,0,0,0.2)' : '#f8fafc', padding: 20, paddingTop: 10, borderTopWidth: 1, borderTopColor: isDark ? '#334155' : '#f1f5f9' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Ä°zin AyarÄ± */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', marginBottom: 20, paddingBottom: 15, borderBottomWidth: 1, borderColor: isDark ? 'rgba(255,255,255,0.1)' : '#e2e8f0' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flex: 1, marginRight: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontWeight: '700', color: currentColors.text, fontSize: 14 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('task_assign_permission')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 11, color: currentColors.subText, marginTop: 2 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('c_sendtask')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 8 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 12, fontWeight: '700', color: contact.canAssignToMe ? COLORS.success : currentColors.subText }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {contact.canAssignToMe ? t('open_label') : t('closed_label')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <SwitchÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value={contact.canAssignToMe}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onValueChange={() => togglePermission(contact)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  trackColor={{ false: "#cbd5e1", true: "#10b981" }}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  thumbColor={"#fff"}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Aksiyon ButonlarÄ± */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ gap: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => showTasksAssignedToFriend(contact.uid, contact.username)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{ flexDirection: 'row', alignItems: 'center', justifyContent: 'center', gap: 10, padding: 14, borderRadius: 14, backgroundColor: COLORS.primary + '15' }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ListTodo size={18} color={COLORS.primary} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 13, fontWeight: '700', color: COLORS.primary }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('my_assigned_tasks')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', gap: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => handleRemoveFriend(contact.uid, contact.username)} style={{ flex: 1, flexDirection: 'row', alignItems: 'center', justifyContent: 'center', gap: 8, padding: 14, borderRadius: 14, backgroundColor: '#fee2e2' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <UserMinus size={18} color={COLORS.danger} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 12, fontWeight: '700', color: COLORS.danger }}>{t('remove_friend')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => handleBlockFriend(contact.uid, contact.username)} style={{ flex: 1, flexDirection: 'row', alignItems: 'center', justifyContent: 'center', gap: 8, padding: 14, borderRadius: 14, backgroundColor: isDark ? '#334155' : '#e2e8f0' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <XCircle size={18} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 12, fontWeight: '700', color: currentColors.subText }}>{t('block')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  </ScrollView>
Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  {/* --- SAYFA 4: PROFÄ°L (PROFILE) --- */}
Â  Â  Â  Â  Â  Â  Â  <View key="4" style={{ flex: 1, width: '100%' }}>
Â  Â  Â  Â  Â  Â  Â  Â  <ScrollViewÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  contentContainerStyle={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingHorizontal: 20,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingBottom: 120,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: '100%',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maxWidth: 600, // Web'de iÃ§eriÄŸin Ã§ok yayÄ±lmasÄ±nÄ± engeller
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignSelf: 'center', // Web'de iÃ§eriÄŸi ortalar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingTop: 10
Â  Â  Â  Â  Â  Â  Â  Â  Â  }}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  showsVerticalScrollIndicator={false}
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- 1. PROFÄ°L KARTI (FOTOÄžRAF & Ä°SÄ°M) --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={[styles.card, { backgroundColor: currentColors.surface, alignItems: 'center', paddingVertical: 25, marginBottom: 15, borderRadius: 24 }]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* FotoÄŸraf AlanÄ± */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (user.isAnonymous || user.isGuest) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast(t('warning_title'), t('guest_edit_warning') || t('guest_cannot_change_photo'), 'warning');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pickImage();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  activeOpacity={0.8}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{ position: 'relative', marginBottom: 15 }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 110, height: 110, borderRadius: 55,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: COLORS.primary, alignItems: 'center', justifyContent: 'center',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 4, borderColor: currentColors.bg, // FotoÄŸrafÄ±n etrafÄ±na temiz bir Ã§erÃ§eve
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: COLORS.primary, shadowOpacity: 0.3, shadowRadius: 10, elevation: 5
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {user.photoURL ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Image source={{ uri: user.photoURL }} style={{ width: '100%', height: '100%', borderRadius: 55 }} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <User size={50} color="#fff" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* DÃ¼zenleme Ä°konu (SaÄŸ Alt) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {!(user.isAnonymous || user.isGuest) && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  position: 'absolute', bottom: 0, right: 0,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: currentColors.surface, borderRadius: 20, padding: 6,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 1, borderColor: '#e2e8f0', shadowColor: "#000", shadowOpacity: 0.1, elevation: 2
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Edit2 size={14} color={COLORS.primary} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Ä°sim ve KullanÄ±cÄ± AdÄ± */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ alignItems: 'center', gap: 4 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 24, fontWeight: '800', color: currentColors.text, textAlign: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {user.displayName || user.username || t('no_name')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (user.isAnonymous || user.isGuest) return;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setEditUsernameInput(user.username || "");Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setEditDisplayNameInput(user.displayName || "");Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setIsEditProfileVisible(true);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  activeOpacity={(user.isAnonymous || user.isGuest) ? 1 : 0.6}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{ flexDirection: 'row', alignItems: 'center', gap: 4, backgroundColor: isDark ? 'rgba(255,255,255,0.05)' : '#f1f5f9', paddingHorizontal: 10, paddingVertical: 4, borderRadius: 12 }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 14, color: COLORS.primary, fontWeight: '600' }}>@{user.username}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {!(user.isAnonymous || user.isGuest) && <Edit2 size={10} color={COLORS.primary} style={{ opacity: 0.7 }} />}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {(user.isAnonymous || user.isGuest) && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ marginTop: 8, backgroundColor: '#fff7ed', paddingHorizontal: 10, paddingVertical: 4, borderRadius: 8, borderWidth: 1, borderColor: '#ffedd5' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 11, color: '#c2410c', fontWeight: 'bold' }}>Misafir HesabÄ±</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- 2. AYARLAR KARTI --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={[styles.card, { backgroundColor: currentColors.surface, padding: 0, borderRadius: 24, marginBottom: 15 }]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ padding: 20, paddingBottom: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={[styles.cardTitle, { color: currentColors.text, fontSize: 18, marginBottom: 15 }]}>{t('settings')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Kategoriler */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => setIsCategoryModalOpen(true)} style={[styles.settingBtn, { marginBottom: 12, justifyContent: 'space-between', backgroundColor: isDark ? 'rgba(255,255,255,0.03)' : '#f8fafc', borderWidth: 0 }]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', gap: 12, alignItems: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ padding: 8, borderRadius: 10, backgroundColor: COLORS.primary + '15' }}><Layers size={20} color={COLORS.primary} /></View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.text, fontSize: 15, fontWeight: '500' }}>{t('edit_categories')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ChevronRight size={18} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Dil SeÃ§imi */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => setIsLangModalOpen(true)} style={[styles.settingBtn, { marginBottom: 12, justifyContent: 'space-between', backgroundColor: isDark ? 'rgba(255,255,255,0.03)' : '#f8fafc', borderWidth: 0 }]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', gap: 12, alignItems: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ padding: 8, borderRadius: 10, backgroundColor: COLORS.primary + '15' }}><Globe size={20} color={COLORS.primary} /></View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.text, fontSize: 15, fontWeight: '500' }}>{t('language')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 5 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 22 }}>{LANGUAGES.find(l => l.code === lang)?.flag}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ChevronRight size={18} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Åžifre Ä°ÅŸlemleri */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => setIsPasswordModalOpen(true)} style={[styles.settingBtn, { marginBottom: 12, justifyContent: 'space-between', backgroundColor: isDark ? 'rgba(255,255,255,0.03)' : '#f8fafc', borderWidth: 0 }]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', gap: 12, alignItems: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ padding: 8, borderRadius: 10, backgroundColor: COLORS.primary + '15' }}><Lock size={20} color={COLORS.primary} /></View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.text, fontSize: 15, fontWeight: '500' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {user.providerData.some((p: any) => p.providerId === 'password') ? t('change_password') : t('create_password')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ChevronRight size={18} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* GÃ¶rÃ¼nÃ¼m (Theme) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ paddingHorizontal: 20, paddingBottom: 20 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 12, color: currentColors.subText, fontWeight: '700', marginBottom: 10, marginLeft: 4 }}>{t('appearance')?.toUpperCase() || 'GÃ–RÃœNÃœM'}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', backgroundColor: isDark ? 'rgba(0,0,0,0.2)' : '#f1f5f9', padding: 4, borderRadius: 14 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {['light', 'dark', 'system'].map((mode) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isActive = theme === mode;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const icon = mode === 'light' ? <Sun size={16} color={isActive ? COLORS.primary : currentColors.subText} /> :Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mode === 'dark' ? <Moon size={16} color={isActive ? COLORS.primary : currentColors.subText} /> :Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Monitor size={16} color={isActive ? COLORS.primary : currentColors.subText} />;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const labelKey = `theme_${mode}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  key={mode}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => setTheme(mode as ThemeMode)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flex: 1, flexDirection: 'row', alignItems: 'center', justifyContent: 'center', gap: 6,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingVertical: 10, borderRadius: 10,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isActive ? currentColors.surface : 'transparent',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: "#000", shadowOpacity: isActive ? 0.1 : 0, shadowRadius: 2, elevation: isActive ? 1 : 0
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {icon}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 12, fontWeight: isActive ? 'bold' : '500', color: isActive ? COLORS.primary : currentColors.subText }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t(labelKey)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Gizlilik Linki */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => { setIsSettingsOpen(false); router.push(`/${lang}/privacy`); }} style={{ borderTopWidth: 1, borderColor: isDark ? '#334155' : '#f1f5f9', padding: 15 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.subText, textAlign: 'center', fontSize: 12, fontWeight: '500' }}>{t('privacy_terms')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- 3. PREMIUM VE ÃœYELÄ°K DURUMU ALANI --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ marginBottom: 25 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {!isPremium ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  /* DURUM 1: KULLANICI PREMIUM DEÄžÄ°L */
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  user.isGuest ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  /* A. MÄ°SAFÄ°R UYARISI KARTI (SarÄ±) */
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ backgroundColor: '#fffbeb', borderColor: '#fcd34d', borderWidth: 1, padding: 20, borderRadius: 24 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 10, marginBottom: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ backgroundColor: '#fff7ed', padding: 8, borderRadius: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <AlertCircle size={24} color="#d97706" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 16, fontWeight: 'bold', color: '#9a3412' }}>{t('guest_acc')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: '#9a3412', marginBottom: 15, fontSize: 13, lineHeight: 20 }}>{t('guest_now')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => setIsGuestModalOpen(true)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  activeOpacity={0.8}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{ backgroundColor: '#d97706', padding: 14, borderRadius: 14, alignItems: 'center', shadowColor: "#d97706", shadowOpacity: 0.2, shadowRadius: 5, elevation: 3 }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: '#fff', fontWeight: 'bold', fontSize: 15 }}>{t('save_register')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  /* B. PREMIUM SATIN ALMA KARTI (Ana Renk) */
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  activeOpacity={0.9}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => setIsUpsellVisible(true)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: COLORS.primary, // Ana tema rengin
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 24,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding: 20,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flexDirection: 'row',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  justifyContent: 'space-between',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Modern GÃ¶lge Efekti
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: COLORS.primary,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowOffset: { width: 0, height: 8 },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowOpacity: 0.4,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowRadius: 12,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  elevation: 10,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: 'rgba(255,255,255,0.2)'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flex: 1, paddingRight: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 6, marginBottom: 6 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Trophy size={16} color="#fbbf24" fill="#fbbf24" />Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: '#fbbf24', fontWeight: '800', fontSize: 11, letterSpacing: 1.5 }}>{t('premium_label')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: '#fff', fontSize: 18, fontWeight: 'bold', marginBottom: 4 }}>{t('premium_cta')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: 'rgba(255,255,255,0.9)', fontSize: 13, fontWeight: '500' }}>{t('premium_price')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 44, height: 44, borderRadius: 22,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: 'rgba(255,255,255,0.2)',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center', justifyContent: 'center'Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ChevronRight size={24} color="#fff" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  /* DURUM 2: KULLANICI ZATEN PREMIUM (YeÅŸil Bilgi KartÄ±) */
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isDark ? 'rgba(16, 185, 129, 0.15)' : '#ecfdf5',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: '#10b981',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 24,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding: 20,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flexDirection: 'row',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gap: 15
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ width: 44, height: 44, borderRadius: 22, backgroundColor: '#10b981', alignItems: 'center', justifyContent: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Check size={24} color="#fff" strokeWidth={3} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.text, fontWeight: 'bold', fontSize: 16 }}>Premium Ãœyesiniz</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.subText, fontSize: 12, marginTop: 2 }}>TÃ¼m Ã¶zellikler aktif âœ¨</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- 4. Ã‡IKIÅž & SÄ°LME --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ gap: 12 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={handleLogout} style={[styles.card, { backgroundColor: currentColors.surface, flexDirection: 'row', alignItems: 'center', justifyContent: 'center', gap: 10, padding: 16, borderRadius: 20, marginBottom: 0 }]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <LogOut size={20} color={COLORS.danger} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: COLORS.danger, fontWeight: 'bold', fontSize: 16 }}>{t('logout')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={handleDeleteAccount} style={{ flexDirection: 'row', alignItems: 'center', justifyContent: 'center', gap: 8, padding: 10, opacity: 0.7 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.subText, fontWeight: '500', fontSize: 13 }}>{t('delete_account')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  </ScrollView>
Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  </PagerView>
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  )}

Â  Â  Â  Â  {/* ================================================================================= */}
Â  Â  Â  Â  {/* 4. REKLAM (Sabit) */}
Â  Â  Â  Â  {/* ================================================================================= */}
Â  Â  Â  Â  {!isSettingsOpen && (<OmmioAdBanner isPremium={isPremium} />)}

Â  Â  Â  Â {/* ================================================================================= */}
Â  Â  Â  Â  {/* 5. BOTTOM TABS */}
Â  Â  Â  Â  {/* ================================================================================= */}
Â  Â  Â  Â  {!isSettingsOpen && (
Â  Â  Â  Â  Â  <View style={[ styles.tabBar, { backgroundColor: currentColors.surface, borderTopColor: isDark ? '#334155' : '#e2e8f0' } ]}>
Â  Â  Â  Â  Â  Â  {[
Â  Â  Â  Â  Â  Â  Â  { key: 'list', Icon: ListTodo, label: t('tasks_tab') },
Â  Â  Â  Â  Â  Â  Â  { key: 'habits', Icon: Repeat, label: t('habits_tab') },
Â  Â  Â  Â  Â  Â  Â  { key: 'messages', Icon: MessageCircle, label: t('messages_tab') }, // Normal Chat Buraya
Â  Â  Â  Â  Â  Â  Â  { key: 'social', Icon: Users, label: t('social_tab') }, // Task Chat Buraya
Â  Â  Â  Â  Â  Â  Â  { key: 'profile', Icon: User, label: t('profile_tab') },
Â  Â  Â  Â  Â  Â  ].map((item) => {
Â  Â  Â  Â  Â  Â  Â  const isActive = activeTab === item.key;
Â  Â  Â  Â  Â  Â  Â  const iconColor = isActive ? COLORS.primary : currentColors.subText;

Â  Â  Â  Â  Â  Â  Â  // --- HESAPLAMA MANTIÄžI ---
Â  Â  Â  Â  Â  Â  Â  Â  let badgeCount = 0;

Â  Â  Â  Â  Â  Â  Â  Â  // EÄŸer SOSYAL sekmesiyse -> SADECE GÃ–REV YORUMLARINI Say
Â  Â  Â  Â  Â  Â  Â  Â  if (item.key === 'social') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  badgeCount = Object.values(taskUnreadCounts).reduce((acc: number, curr: any) => acc + (curr || 0), 0);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // EÄŸer MESAJLAR sekmesiyse -> Normal Chatleri Say (Ä°stersen bunu kaldÄ±rabilirsin)
Â  Â  Â  Â  Â  Â  Â  Â  if (item.key === 'messages') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  badgeCount = Object.values(chatPreviews).reduce((acc: number, curr: any) => acc + (curr.unread || 0), 0);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  // -------------------------

Â  Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity key={item.key} onPress={() => onBottomTabPress(item.key)} style={styles.tabItem}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ opacity: isActive ? 1 : 0.5, alignItems: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <item.Icon size={24} color={iconColor} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* KIRMIZI KUTUCUK (TaskChatButton'daki mantÄ±ÄŸÄ±n aynÄ±sÄ±) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {badgeCount > 0 && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  position: 'absolute', top: -4, right: -6, minWidth: 16, height: 16,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 8, backgroundColor: COLORS.danger, alignItems: 'center', justifyContent: 'center',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 1.5, borderColor: currentColors.surface, zIndex: 999
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{color:'#fff', fontSize:9, fontWeight:'bold'}}>{badgeCount}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={[styles.tabLabel, { color: iconColor }]}>{item.label}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  })}
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  )}
Â  Â  Â  Â {/* ================================================================================= */}
{/* 6. FLOATING ACTION BUTTONS & TASK INPUT BAR */}
{/* ================================================================================= */}

{/* A. ALIÅžKANLIK EKLEME BUTONU (Sadece Habits Sekmesi) */}
{!isSettingsOpen && activeTab === 'habits' && (
Â  <View style={[styles.fabContainer, { bottom: !isPremium ? 175 : 105 }]}>
Â  Â  <TouchableOpacity
Â  Â  Â  onPress={() => { setAddMode('habit'); setIsAddModalOpen(true); }}
Â  Â  Â  style={styles.fabButton}
Â  Â  Â  activeOpacity={0.8}
Â  Â  >
Â  Â  Â  <Plus size={28} color="#fff" />
Â  Â  </TouchableOpacity>
Â  </View>
)}

{/* B. GÃ–REV EKLEME BARI (Sadece List Sekmesi) */}
{!isSettingsOpen && activeTab === 'list' && (
Â  <>
Â  Â  {/* DÄ±ÅŸarÄ± TÄ±klama AlanÄ± (Overlay) */}
Â  Â  {isInputExpanded && (
Â  Â  Â  <TouchableWithoutFeedback
Â  Â  Â  Â  onPress={() => {
Â  Â  Â  Â  Â  LayoutAnimation.configureNext(LayoutAnimation.Presets.easeInEaseOut);
Â  Â  Â  Â  Â  setIsInputExpanded(false);
Â  Â  Â  Â  Â  Keyboard.dismiss();
Â  Â  Â  Â  }}
Â  Â  Â  >
Â  Â  Â  Â  <View style={styles.overlay} />
Â  Â  Â  </TouchableWithoutFeedback>
Â  Â  )}

Â  Â  {/* Blur Input Bar */}
Â  Â  <BlurView
Â  Â  Â  intensity={Platform.OS === 'ios' ? 80 : 100}
Â  Â  Â  tint={isDark ? 'dark' : 'light'}
Â  Â  Â  style={[
Â  Â  Â  Â  styles.blurInputContainer,
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  bottom: !isPremium ? 185 : 120,
Â  Â  Â  Â  Â  backgroundColor: isDark ? 'rgba(30, 41, 59, 0.6)' : 'rgba(255, 255, 255, 0.65)',
Â  Â  Â  Â  Â  borderColor: isDark ? 'rgba(255,255,255,0.1)' : 'rgba(255,255,255,0.4)',
Â  Â  Â  Â  }
Â  Â  Â  ]}
Â  Â  >
Â  Â  Â  {/* 1. GENÄ°ÅžLETÄ°LMÄ°Åž SEÃ‡ENEKLER */}
Â  Â  Â  {isInputExpanded && (
Â  Â  Â  Â  <View style={styles.expandedContent}>
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  {/* 1. BÃ–LÃœM: Ã‡OKLU ATAMA (Multi-Assign) */}
Â  Â  Â  Â  Â  <Text style={styles.sectionTitle}>{t('assign_to')} {assignTargets.length > 0 && `(${assignTargets.length})`}</Text>
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  <ScrollView horizontal showsHorizontalScrollIndicator={false} contentContainerStyle={{ gap: 10, paddingBottom: 10 }}>
Â  Â  Â  Â  Â  Â  Â {/* SeÃ§enek: Ben (VarsayÄ±lan) */}
Â  Â  Â  Â  Â  Â  Â <TouchableOpacity
Â  Â  Â  Â  Â  Â  Â  Â onPress={() => setAssignTargets([])} // Listeyi temizle = Sadece Ben
Â  Â  Â  Â  Â  Â  Â  Â style={[
Â  Â  Â  Â  Â  Â  Â  Â  Â styles.assignChip,
Â  Â  Â  Â  Â  Â  Â  Â  Â assignTargets.length === 0Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ? { backgroundColor: COLORS.primary, borderColor: COLORS.primary }Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â : { backgroundColor: isDark ? '#334155' : '#fff', borderColor: isDark ? '#475569' : '#e2e8f0' }
Â  Â  Â  Â  Â  Â  Â  Â ]}
Â  Â  Â  Â  Â  Â  Â >
Â  Â  Â  Â  Â  Â  Â  Â <View style={[styles.avatarSmall, { backgroundColor: assignTargets.length === 0 ? 'rgba(255,255,255,0.2)' : (isDark ? '#475569' : '#f1f5f9') }]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â {user.photoURL ? <Image source={{ uri: user.photoURL }} style={styles.avatarImage} /> : <User size={16} color={currentColors.subText} />}
Â  Â  Â  Â  Â  Â  Â  Â </View>
Â  Â  Â  Â  Â  Â  Â  Â <Text style={[styles.chipText, { color: assignTargets.length === 0 ? '#fff' : currentColors.text }]}>{t('me')}</Text>
Â  Â  Â  Â  Â  Â  Â </TouchableOpacity>

Â  Â  Â  Â  Â  Â  Â {/* KiÅŸiler */}
Â  Â  Â  Â  Â  Â  Â {contacts.map(contact => {
Â  Â  Â  Â  Â  Â  Â  Â const isSelected = assignTargets.some(t => t.uid === contact.uid);
Â  Â  Â  Â  Â  Â  Â  Â return (
Â  Â  Â  Â  Â  Â  Â  Â  Â <TouchableOpacity
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â key={contact.uid}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â onPress={() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (isSelected) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Varsa Ã§Ä±kar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setAssignTargets(prev => prev.filter(t => t.uid !== contact.uid));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Yoksa ekle
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setAssignTargets(prev => [...prev, contact]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â style={[
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â styles.assignChip,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â isSelectedÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ? { backgroundColor: COLORS.primary, borderColor: COLORS.primary }Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â : { backgroundColor: isDark ? '#334155' : '#fff', borderColor: isDark ? '#475569' : '#e2e8f0' }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ]}
Â  Â  Â  Â  Â  Â  Â  Â  Â >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <View style={[styles.avatarSmall]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 12, fontWeight: 'bold' }}>{contact.username[0].toUpperCase()}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <Text style={[styles.chipText, { color: isSelected ? '#fff' : currentColors.text }]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â {contact.displayName || contact.username}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â {isSelected && <CheckCircle2 size={14} color="#fff" style={{ marginLeft: 6 }} />}
Â  Â  Â  Â  Â  Â  Â  Â  Â </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â );
Â  Â  Â  Â  Â  Â  Â })}
Â  Â  Â  Â  Â  </ScrollView>

Â  Â  Â  Â  Â  {/* 2. BÃ–LÃœM: Ã–NCELÄ°K (Priority) & DOSYA */}
Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', gap: 15, marginBottom: 15 }}>
Â  Â  Â  Â  Â  Â  Â {/* Ã–ncelik SeÃ§imi */}
Â  Â  Â  Â  Â  Â  Â <View style={{ flex: 1 }}>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={styles.sectionTitle}>Ã–ncelik</Text>
Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', backgroundColor: isDark ? '#334155' : '#f1f5f9', borderRadius: 12, padding: 4 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {['low', 'medium', 'high'].map((p) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isSelected = priority === p;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let color = '#10b981'; // Low (Green)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (p === 'medium') color = '#f59e0b'; // Medium (Orange)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (p === 'high') color = '#ef4444'; // High (Red)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  key={p}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => setPriority(p as any)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flex: 1, alignItems: 'center', paddingVertical: 8, borderRadius: 8,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isSelected ? color : 'transparent'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Flag size={16} color={isSelected ? '#fff' : color} fill={isSelected ? '#fff' : 'none'} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })}
Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â </View>

Â  Â  Â  Â  Â  Â  Â {/* Dosya Ekleme */}
Â  Â  Â  Â  Â  Â  Â <View style={{ flex: 1 }}>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={styles.sectionTitle}>Ekler ({attachments.length})</Text>
Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={pickDocument}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flexDirection: 'row', alignItems: 'center', justifyContent: 'center', gap: 8,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isDark ? '#334155' : '#f1f5f9', borderRadius: 12, paddingVertical: 8, height: 40,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 1, borderColor: attachments.length > 0 ? COLORS.primary : 'transparent'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Paperclip size={18} color={attachments.length > 0 ? COLORS.primary : currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 12, fontWeight: '600', color: attachments.length > 0 ? COLORS.primary : currentColors.subText }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {attachments.length > 0 ? `${attachments.length} Dosya` : "Dosya Ekle"}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â </View>
Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  {/* BÃ¶lÃ¼m: AÃ§Ä±klama */}
Â  Â  Â  Â  Â  <View style={{ marginBottom: 10 }}>
Â  Â  Â  Â  Â  Â  <Text style={styles.sectionTitle}>{t('description')}</Text>
Â  Â  Â  Â  Â  Â  <TextInput
Â  Â  Â  Â  Â  Â  Â  value={inputDesc}
Â  Â  Â  Â  Â  Â  Â  onChangeText={setInputDesc}
Â  Â  Â  Â  Â  Â  Â  placeholder="..."
Â  Â  Â  Â  Â  Â  Â  placeholderTextColor={currentColors.subText}
Â  Â  Â  Â  Â  Â  Â  style={[styles.smallInput, { backgroundColor: currentColors.bg, color: currentColors.text }]}
Â  Â  Â  Â  Â  Â  Â  onSubmitEditing={addTask}
Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  {/* BÃ¶lÃ¼m: Tarihler */}
Â  Â  Â  Â  Â  <View style={styles.dateRow}>
Â  Â  Â  Â  Â  Â  {/* BaÅŸlangÄ±Ã§ Tarihi */}
Â  Â  Â  Â  Â  Â  <View style={{ flex: 1 }}>
Â  Â  Â  Â  Â  Â  Â  <Text style={styles.sectionTitle}>{t('start_date')}</Text>
Â  Â  Â  Â  Â  Â  Â  <View style={styles.dateInputWrapper}>
Â  Â  Â  Â  Â  Â  Â  Â  <TextInput
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={inputStartDate}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChangeText={handleInputStartDateChange}
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="DD-MM-YYYY"
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholderTextColor={currentColors.subText}
Â  Â  Â  Â  Â  Â  Â  Â  Â  maxLength={10}
Â  Â  Â  Â  Â  Â  Â  Â  Â  keyboardType="numeric"
Â  Â  Â  Â  Â  Â  Â  Â  Â  style={[styles.dateInput, { backgroundColor: currentColors.bg, color: currentColors.text }]}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onSubmitEditing={addTask}
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => openDatePicker('start')} style={styles.calendarBtn}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <CalendarIcon size={16} color="#fff" />
Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  {/* BitiÅŸ Tarihi */}
Â  Â  Â  Â  Â  Â  <View style={{ flex: 1 }}>
Â  Â  Â  Â  Â  Â  Â  <Text style={styles.sectionTitle}>{t('due_date')}</Text>
Â  Â  Â  Â  Â  Â  Â  <View style={styles.dateInputWrapper}>
Â  Â  Â  Â  Â  Â  Â  Â  <TextInput
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={inputDueDate}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChangeText={handleInputDueDateChange}
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="DD-MM-YYYY"
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholderTextColor={currentColors.subText}
Â  Â  Â  Â  Â  Â  Â  Â  Â  maxLength={10}
Â  Â  Â  Â  Â  Â  Â  Â  Â  keyboardType="numeric"
Â  Â  Â  Â  Â  Â  Â  Â  Â  style={[styles.dateInput, { backgroundColor: currentColors.bg, color: currentColors.text }]}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onSubmitEditing={addTask}
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => openDatePicker('due')} style={styles.calendarBtn}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <CalendarIcon size={16} color="#fff" />
Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  {/* BÃ¶lÃ¼m: Kategoriler veya UyarÄ± */}
Â  Â  Â  Â  Â  <View style={[styles.divider, { borderColor: isDark ? '#334155' : '#f1f5f9' }]}>
Â  Â  Â  Â  Â  Â  {!assignTarget ? (
Â  Â  Â  Â  Â  Â  Â  <ScrollView horizontal showsHorizontalScrollIndicator={false} contentContainerStyle={{ gap: 8 }}>
Â  Â  Â  Â  Â  Â  Â  Â  {categories.map(cat => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  const cc = CATEGORY_COLORS.find(c => c.id === cat.color) || CATEGORY_COLORS[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â  const isSelected = selectedCategory.id === cat.id;
Â  Â  Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  key={cat.id}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => setSelectedCategory(cat)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={[
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  styles.categoryPill,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: isDark ? '#334155' : '#e2e8f0',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isSelected ? cc.hex : (isDark ? '#334155' : '#fff')Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isSelected && { borderColor: 'transparent' }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ]}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={[styles.dot, { backgroundColor: cc.hex }]} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={[styles.categoryText, { color: currentColors.text }]}>{cat.name}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  })}
Â  Â  Â  Â  Â  Â  Â  </ScrollView>
Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 11, color: COLORS.warning, fontStyle: 'italic' }}>
Â  Â  Â  Â  Â  Â  Â  Â  {tFormat("task_assign_info", { name: assignTarget.username })}
Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  {/* BÃ¶lÃ¼m: Alt Butonlar (Alarm, Bildirim, Recurring) */}
Â  Â  Â  Â  Â  <View style={styles.bottomActions}>
Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', gap: 5 }}>
Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity
Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => setIsNotifOn(!isNotifOn)}
Â  Â  Â  Â  Â  Â  Â  Â  style={[styles.iconToggle, isNotifOn && styles.iconToggleActiveBlue]}
Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  <Bell size={16} color={isNotifOn ? '#3b82f6' : currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity
Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => setIsAlarmOn(!isAlarmOn)}
Â  Â  Â  Â  Â  Â  Â  Â  style={[styles.iconToggle, isAlarmOn && styles.iconToggleActiveRed]}
Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  <AlarmClock size={16} color={isAlarmOn ? '#ef4444' : currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  Â  Â  {inputDueDate && (
Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity
Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => setIsEveryDayOn(!isEveryDayOn)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  style={[styles.iconToggle, isEveryDayOn && styles.iconToggleActiveGreen, { width: 'auto', paddingHorizontal: 8, gap: 5 }]}
Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  <CalendarDays size={16} color={isEveryDayOn ? '#10b981' : currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 10, fontWeight: 'bold', color: isEveryDayOn ? '#10b981' : currentColors.subText }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t('every_day')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', gap: 5 }}>
Â  Â  Â  Â  Â  Â  Â  {isNotifOn && (
Â  Â  Â  Â  Â  Â  Â  Â  <TextInput
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={notifInput}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChangeText={handleNotifInputChange}
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="09:00"
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholderTextColor="#94a3b8"
Â  Â  Â  Â  Â  Â  Â  Â  Â  style={[styles.timeInput, { color: COLORS.primary, borderColor: COLORS.primary }]}
Â  Â  Â  Â  Â  Â  Â  Â  Â  maxLength={5}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onSubmitEditing={addTask}
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  {isAlarmOn && (
Â  Â  Â  Â  Â  Â  Â  Â  <TextInput
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={alarmInput}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChangeText={handleAlarmInputChange}
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="07:00"
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholderTextColor="#94a3b8"
Â  Â  Â  Â  Â  Â  Â  Â  Â  style={[styles.timeInput, { color: COLORS.danger, borderColor: COLORS.danger }]}
Â  Â  Â  Â  Â  Â  Â  Â  Â  maxLength={5}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onSubmitEditing={addTask}
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  </View>
Â  Â  Â  )}

Â  Â  Â  {/* 2. ANA INPUT SATIRI */}
Â  Â  Â  <View style={styles.mainInputRow}>
Â  Â  Â  Â  <TouchableOpacity
Â  Â  Â  Â  Â  onPress={() => {
Â  Â  Â  Â  Â  Â  LayoutAnimation.configureNext(LayoutAnimation.Presets.easeInEaseOut);
Â  Â  Â  Â  Â  Â  setIsInputExpanded(!isInputExpanded);
Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  style={styles.expandBtn}
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  {isInputExpanded ? <X size={20} color={currentColors.subText} /> : <Sliders size={20} color={currentColors.subText} />}
Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <TextInput
Â  Â  Â  Â  Â  value={inputValue}
Â  Â  Â  Â  Â  onChangeText={setInputValue}
Â  Â  Â  Â  Â  placeholder={t('addTask')}
Â  Â  Â  Â  Â  placeholderTextColor={currentColors.subText}
Â  Â  Â  Â  Â  style={[styles.mainTextInput, { color: currentColors.text }]}
Â  Â  Â  Â  Â  onSubmitEditing={addTask}
Â  Â  Â  Â  />
Â  Â  Â  Â Â 
Â  Â  Â  Â  <TouchableOpacity
Â  Â  Â  Â  Â  onPress={addTask}
Â  Â  Â  Â  Â  style={[
Â  Â  Â  Â  Â  Â  styles.sendBtn,
Â  Â  Â  Â  Â  Â  {Â 
Â  Â  Â  Â  Â  Â  Â  backgroundColor: inputValue.trim() ? (assignTarget ? COLORS.warning : COLORS.primary) : (isDark ? '#334155' : '#e2e8f0')Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  ]}
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  <Plus size={24} color={inputValue.trim() ? '#fff' : '#94a3b8'} />
Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  </View>

Â  Â  </BlurView>
Â  </>
)}
Â  Â  Â  Â {/* ================================================================================= */}
Â  Â  Â  Â  {/* 7. TOAST BÄ°LDÄ°RÄ°MLER */}
Â  Â  Â  Â  {/* ================================================================================= */}
Â  Â  Â  Â  {customToast.visible && (() => {
Â  Â  Â  Â  Â  // Toast Tiplerine GÃ¶re Ayarlar (Renkler ve Ä°konlar)
Â  Â  Â  Â  Â  const TOAST_CONFIG = {
Â  Â  Â  Â  Â  Â  success: { bg: '#ecfdf5', border: '#10b981', iconBg: '#10b981', Icon: Check },
Â  Â  Â  Â  Â  Â  error: Â  { bg: '#fef2f2', border: '#ef4444', iconBg: '#ef4444', Icon: X },
Â  Â  Â  Â  Â  Â  warning: { bg: '#fffbeb', border: '#f59e0b', iconBg: '#f59e0b', Icon: AlertCircle },
Â  Â  Â  Â  Â  Â  info: Â  Â { bg: '#f0f9ff', border: '#0ea5e9', iconBg: '#0ea5e9', Icon: Bell },
Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  // GeÃ§erli ayarÄ± seÃ§ (yoksa varsayÄ±lan olarak info kullan)
Â  Â  Â  Â  Â  const currentToast = TOAST_CONFIG[customToast.type] || TOAST_CONFIG.info;
Â  Â  Â  Â  Â  const ToastIcon = currentToast.Icon;

Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  <View style={[styles.toastContainer, { backgroundColor: currentToast.bg, borderColor: currentToast.border }]}>
Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  {/* Sol Ä°kon */}
Â  Â  Â  Â  Â  Â  Â  <View style={[styles.toastIconBox, { backgroundColor: currentToast.iconBg }]}>
Â  Â  Â  Â  Â  Â  Â  Â  <ToastIcon size={20} color="#fff" strokeWidth={2.5} />
Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  {/* Metin Ä°Ã§eriÄŸi */}
Â  Â  Â  Â  Â  Â  Â  <View style={{ flex: 1 }}>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={styles.toastTitle}>{customToast.title}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={styles.toastMessage} numberOfLines={2}>{customToast.message}</Text>
Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  {/* Kapat Butonu */}
Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => setCustomToast({ ...customToast, visible: false })}
Â  Â  Â  Â  Â  Â  Â  Â  style={styles.toastCloseBtn}
Â  Â  Â  Â  Â  Â  Â  Â  hitSlop={{ top: 10, bottom: 10, left: 10, right: 10 }} // TÄ±klama alanÄ±nÄ± geniÅŸletir
Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  <X size={18} color="#64748b" />
Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  );
Â  Â  Â  Â  })()}

Â  Â  Â  Â {/* ================================================================================= */}
{/* 8. MODALLAR (Modernize EdilmiÅŸ) */}
{/* ================================================================================= */}

{/* A. ALIÅžKANLIK EKLEME MODALI */}
<Modal visible={isAddModalOpen} transparent animationType="slide" statusBarTranslucent>
Â  <KeyboardAvoidingView behavior={Platform.OS === "ios" ? "padding" : "height"} style={styles.modalOverlay}>
Â  Â  <TouchableWithoutFeedback onPress={() => { setIsAddModalOpen(false); Keyboard.dismiss(); }}>
Â  Â  Â  <View style={styles.modalBackdrop} />
Â  Â  </TouchableWithoutFeedback>
Â  Â Â 
Â  Â  <View style={styles.bottomSheetCard}>
Â  Â  Â  <View style={styles.modalHeader}>
Â  Â  Â  Â  <Text style={styles.modalTitle}>{t('new_habit')}</Text>
Â  Â  Â  Â  <TouchableOpacity onPress={() => setIsAddModalOpen(false)} style={styles.closeBtn}>
Â  Â  Â  Â  Â  <X size={24} color={currentColors.text} />
Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  </View>

Â  Â  Â  <View style={styles.formGap}>
Â  Â  Â  Â  {/* Ä°sim */}
Â  Â  Â  Â  <TextInputÂ 
Â  Â  Â  Â  Â  placeholder={t('habit_name')}Â 
Â  Â  Â  Â  Â  placeholderTextColor={currentColors.subText}Â 
Â  Â  Â  Â  Â  value={newHabitTitle}Â 
Â  Â  Â  Â  Â  onChangeText={setNewHabitTitle}Â 
Â  Â  Â  Â  Â  style={styles.inputField}Â 
Â  Â  Â  Â  />

Â  Â  Â  Â  {/* SÄ±klÄ±k (HaftalÄ±k/GÃ¼nlÃ¼k) */}
Â  Â  Â  Â  <View style={styles.freqRow}>
Â  Â  Â  Â  Â  {(['daily', 'weekly'] as const).map((freq) => (
Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  key={freq}
Â  Â  Â  Â  Â  Â  Â  onPress={() => setNewHabitFreq(freq)}Â 
Â  Â  Â  Â  Â  Â  Â  style={[styles.freqPill, newHabitFreq === freq && styles.freqPillActive]}
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  <Text style={[styles.freqText, newHabitFreq === freq && styles.freqTextActive]}>
Â  Â  Â  Â  Â  Â  Â  Â  {t(freq)}
Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  </View>

Â  Â  Â  Â  {/* GÃ¼n SeÃ§imi (Sadece Weekly ise) */}
Â  Â  Â  Â  {newHabitFreq === 'weekly' && (
Â  Â  Â  Â  Â  <View style={styles.daysWrapper}>
Â  Â  Â  Â  Â  Â  <Text style={styles.sectionLabel}>{t('which_days')}</Text>
Â  Â  Â  Â  Â  Â  <View style={styles.daysContainer}>
Â  Â  Â  Â  Â  Â  Â  {getDaysOfWeek(lang).map((dayObj) => {
Â  Â  Â  Â  Â  Â  Â  Â  const isSelected = newHabitDays.includes(dayObj.id);
Â  Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  key={dayObj.id}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => toggleHabitDay(dayObj.id)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={[styles.dayCircle, isSelected && styles.dayCircleActive]}
Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={[styles.dayText, isSelected && styles.dayTextActive]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {dayObj.label.substring(0, 2)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  })}
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  )}

Â  Â  Â  Â  {/* Bildirim Saati */}
Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â <Text style={styles.sectionLabel}>{t('time_placeholder')}</Text>
Â  Â  Â  Â  Â  Â <TextInputÂ 
Â  Â  Â  Â  Â  Â  placeholder="09:00"Â 
Â  Â  Â  Â  Â  Â  placeholderTextColor={currentColors.subText}Â 
Â  Â  Â  Â  Â  Â  value={habitNotifInput}Â 
Â  Â  Â  Â  Â  Â  onChangeText={(t) => setHabitNotifInput(maskTimeInput(t))}Â 
Â  Â  Â  Â  Â  Â  style={styles.inputField}Â 
Â  Â  Â  Â  Â  Â  maxLength={5}Â 
Â  Â  Â  Â  Â  Â  keyboardType="numeric"Â 
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  </View>

Â  Â  Â  Â  {/* Kategori SeÃ§imi */}
Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  <Text style={styles.sectionLabel}>{t('category')}</Text>
Â  Â  Â  Â  Â  <ScrollView horizontal showsHorizontalScrollIndicator={false} contentContainerStyle={{ gap: 8 }}>
Â  Â  Â  Â  Â  Â  {categories.map(c => (
Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  key={c.id}Â 
Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => setSelectedCategory(c)}Â 
Â  Â  Â  Â  Â  Â  Â  Â  style={[
Â  Â  Â  Â  Â  Â  Â  Â  Â  styles.categoryTag,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedCategory.id === c.id && { backgroundColor: COLORS.secondary, borderColor: COLORS.secondary }
Â  Â  Â  Â  Â  Â  Â  Â  ]}
Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: selectedCategory.id === c.id ? '#fff' : currentColors.text, fontSize: 12, fontWeight: '600' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  {c.name}
Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  </ScrollView>
Â  Â  Â  Â  </View>

Â  Â  Â  Â  <TouchableOpacity onPress={addHabit} style={styles.primaryButton}>
Â  Â  Â  Â  Â  <Text style={styles.primaryButtonText}>{t('start_habit')}</Text>
Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  </View>
Â  Â  </View>
Â  </KeyboardAvoidingView>
</Modal>

{/* B. MÄ°SAFÄ°R DÃ–NÃœÅžÃœM MODALI */}
<Modal visible={isGuestModalOpen} transparent animationType="fade">
Â  <TouchableWithoutFeedback onPress={Keyboard.dismiss}>
Â  Â  <View style={styles.centerModalOverlay}>
Â  Â  Â  <View style={styles.centerCard}>
Â  Â  Â  Â  <View style={styles.modalHeader}>
Â  Â  Â  Â  Â  <Text style={styles.modalTitle}>{t('create_ac')}</Text>
Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => setIsGuestModalOpen(false)}><X size={24} color={currentColors.subText} /></TouchableOpacity>
Â  Â  Â  Â  </View>
Â  Â  Â  Â  <Text style={styles.modalSubtitle}>{t('protect_data_msg')}</Text>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <View style={styles.formGap}>
Â  Â  Â  Â  Â  <View style={styles.iconInputRow}>
Â  Â  Â  Â  Â  Â  <User size={20} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  <TextInput value={username} onChangeText={setUsername} placeholder={t('social_search_tab_username')} placeholderTextColor={currentColors.subText} style={styles.flexInput} autoCapitalize='none' />
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  <View style={styles.iconInputRow}>
Â  Â  Â  Â  Â  Â  <Mail size={20} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  <TextInput value={email} onChangeText={setEmail} placeholder="E-posta" placeholderTextColor={currentColors.subText} style={styles.flexInput} autoCapitalize='none' keyboardType="email-address" />
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  <View style={styles.iconInputRow}>
Â  Â  Â  Â  Â  Â  <Lock size={20} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  <TextInput value={password} onChangeText={setPassword} placeholder={t('auth_password_placeholder')} placeholderTextColor={currentColors.subText} style={styles.flexInput} secureTextEntry />
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  <TouchableOpacity onPress={handleConvertGuest} style={styles.primaryButton}>
Â  Â  Â  Â  Â  Â  {isAuthLoading ? <ActivityIndicator color="#fff" /> : <Text style={styles.primaryButtonText}>{t('complete_profile')}</Text>}
Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  </View>
Â  Â  Â  </View>
Â  Â  </View>
Â  </TouchableWithoutFeedback>
</Modal>

{/* C. TARÄ°H SEÃ‡Ä°CÄ°LER (Date Pickers) */}
{/* 1. Genel Date Picker */}
{showDatePicker && (
Â  Platform.OS === 'android' ? (
Â  Â  <DateTimePicker value={selectedDate || new Date()} mode="date" display="default" onChange={onDateChange} />
Â  ) : (
Â  Â  <Modal transparent visible={true} animationType="fade">
Â  Â  Â  <TouchableOpacity activeOpacity={1} onPress={() => setShowDatePicker(false)} style={styles.centerModalOverlay}>
Â  Â  Â  Â  <View style={[styles.centerCard, { width: 340, padding: 0 }]}>
Â  Â  Â  Â  Â  <View style={{ padding: 20, borderBottomWidth: 1, borderColor: isDark ? '#334155' : '#f1f5f9', flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center' }}>
Â  Â  Â  Â  Â  Â  Â <Text style={styles.modalTitle}>Tarih SeÃ§</Text>
Â  Â  Â  Â  Â  Â  Â <TouchableOpacity onPress={() => setShowDatePicker(false)}><X size={24} color={currentColors.subText} /></TouchableOpacity>
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  <View style={{ padding: 10 }}>
Â  Â  Â  Â  Â  Â  <CalendarÂ 
Â  Â  Â  Â  Â  Â  Â  current={selectedStr}Â 
Â  Â  Â  Â  Â  Â  Â  key={`${lang}-${selectedStr}`}Â 
Â  Â  Â  Â  Â  Â  Â  onDayPress={(day) => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  const newDate = new Date(day.timestamp);Â 
Â  Â  Â  Â  Â  Â  Â  Â  newDate.setMinutes(newDate.getMinutes() + newDate.getTimezoneOffset());Â 
Â  Â  Â  Â  Â  Â  Â  Â  onDateChange(null, newDate);Â 
Â  Â  Â  Â  Â  Â  Â  }}Â 
Â  Â  Â  Â  Â  Â  Â  theme={{
Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: 'transparent',Â 
Â  Â  Â  Â  Â  Â  Â  Â  calendarBackground: 'transparent',Â 
Â  Â  Â  Â  Â  Â  Â  Â  textSectionTitleColor: currentColors.subText,Â 
Â  Â  Â  Â  Â  Â  Â  Â  selectedDayBackgroundColor: COLORS.primary,Â 
Â  Â  Â  Â  Â  Â  Â  Â  selectedDayTextColor: '#ffffff',Â 
Â  Â  Â  Â  Â  Â  Â  Â  todayTextColor: COLORS.primary,Â 
Â  Â  Â  Â  Â  Â  Â  Â  dayTextColor: currentColors.text,Â 
Â  Â  Â  Â  Â  Â  Â  Â  arrowColor: COLORS.primary,Â 
Â  Â  Â  Â  Â  Â  Â  Â  monthTextColor: currentColors.text,
Â  Â  Â  Â  Â  Â  Â  Â  textDayFontWeight: '600',
Â  Â  Â  Â  Â  Â  Â  Â  textMonthFontWeight: 'bold'
Â  Â  Â  Â  Â  Â  Â  }}Â 
Â  Â  Â  Â  Â  Â  Â  markingType={'custom'}
Â  Â  Â  Â  Â  Â  Â  markedDates={calendarMarks}
Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  </View>
Â  Â  Â  </TouchableOpacity>
Â  Â  </Modal>
Â  )
)}

{/* 2. iOS Detail & Habit Date Pickers (Inline Wrapper) */}
{(showDetailDatePicker || (showHabitDatePicker && Platform.OS === 'ios')) && Platform.OS === 'ios' && (
Â  <Modal transparent visible={true} animationType="slide">
Â  Â  <View style={styles.modalOverlay}>
Â  Â  Â  <TouchableOpacity style={styles.modalBackdrop} onPress={() => { setShowDetailDatePicker(false); setShowHabitDatePicker(false); }} />
Â  Â  Â  <View style={styles.bottomSheetCard}>
Â  Â  Â  Â  <View style={styles.modalHeader}>
Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => { setShowDetailDatePicker(false); setShowHabitDatePicker(false); }}>
Â  Â  Â  Â  Â  Â  <Text style={{ color: COLORS.danger, fontSize: 16 }}>{t('cancel')}</Text>
Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => { setShowDetailDatePicker(false); setShowHabitDatePicker(false); }}>
Â  Â  Â  Â  Â  Â  <Text style={{ color: COLORS.primary, fontWeight: 'bold', fontSize: 16 }}>{t('ok_btn')}</Text>
Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  </View>
Â  Â  Â  Â  <DateTimePickerÂ 
Â  Â  Â  Â  Â  value={new Date()}Â 
Â  Â  Â  Â  Â  mode="date"Â 
Â  Â  Â  Â  Â  display="inline"Â 
Â  Â  Â  Â  Â  onChange={showDetailDatePicker ? onDetailDateChange : onHabitDateChange}Â 
Â  Â  Â  Â  Â  style={{ height: 320 }}
Â  Â  Â  Â  />
Â  Â  Â  </View>
Â  Â  </View>
Â  </Modal>
)}
{/* Android Habit Picker */}
{showHabitDatePicker && Platform.OS === 'android' && (
Â  <DateTimePicker value={new Date()} mode="date" display="default" onChange={onHabitDateChange} />
)}

{/* D. GÃ–REV DETAY MODALI - GÃœNCELLENMÄ°Åž VERSÄ°YON */}
<Modal visible={!!selectedTask} animationType="slide" presentationStyle="pageSheet">
Â  <KeyboardAvoidingView behavior={Platform.OS === 'ios' ? 'padding' : undefined} style={{ flex: 1, backgroundColor: currentColors.bg }}>
Â  Â  <View style={{ flex: 1, padding: 20, paddingBottom: Platform.OS === 'ios' ? 40 : 20 }}>
Â  Â  Â Â 
Â  Â  Â  {/* Header */}
Â  Â  Â  <View style={styles.modalHeader}>
Â  Â  Â  Â  <Text style={styles.modalTitle}>
Â  Â  Â  Â  Â  Â  {/* BaÅŸlÄ±k Dinamik: Chat ise "Yorumlar", Detay ise "Detaylar" yazar */}
Â  Â  Â  Â  Â  Â  {taskModalTab === 'chat' ? t('messaging_title') : t('task_detail_title')}
Â  Â  Â  Â  </Text>
Â  Â  Â  Â  <TouchableOpacity onPress={() => setSelectedTask(null)}>
Â  Â  Â  Â  Â  <Text style={{ color: COLORS.primary, fontWeight: 'bold', fontSize: 16 }}>{t('close_btn')}</Text>
Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  </View>

Â  Â  Â  {/* Segmented Control (Tabs) */}
Â  Â  Â  <View style={styles.segmentedControl}>
Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  onPress={() => setTaskModalTab('chat')}Â 
Â  Â  Â  Â  Â  Â  style={[styles.segmentBtn, taskModalTab === 'chat' && styles.segmentBtnActive, { flexDirection: 'row', alignItems: 'center', justifyContent: 'center', gap: 6 }]}
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  <Text style={{ fontWeight: '600', color: taskModalTab === 'chat' ? currentColors.text : currentColors.subText }}>
Â  Â  Â  Â  Â  Â  Â  {t('messaging_title')}
Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  {/* EÄŸer okunmamÄ±ÅŸ mesaj varsa kÄ±rmÄ±zÄ± nokta koy */}
Â  Â  Â  Â  Â  Â  {hasUnreadInSelectedTask && (Â 
Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ width: 8, height: 8, borderRadius: 4, backgroundColor: COLORS.danger }} />
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  {/* Content */}
Â  Â  Â  <View style={{ flex: 1, marginTop: 15 }}>
Â  Â  Â  Â  {taskModalTab === 'details' ? (
Â  Â  Â  Â  Â  <ScrollView showsVerticalScrollIndicator={false} contentContainerStyle={{ gap: 20 }}>
Â  Â  Â  Â  Â  Â  Â {/* ... (Detaylar kÄ±smÄ± aynÄ± kalsÄ±n, burayÄ± deÄŸiÅŸtirmene gerek yok) ... */}
Â  Â  Â  Â  Â  Â  Â <View>
Â  Â  Â  Â  Â  Â  Â  <Text style={styles.sectionLabel}>{t('title_label')}</Text>
Â  Â  Â  Â  Â  Â  Â  <TextInput value={detailText} onChangeText={setDetailText} multiline style={[styles.inputField, { height: 'auto', minHeight: 60, paddingTop: 12 }]} />
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  <Text style={styles.sectionLabel}>{t('description_label')}</Text>
Â  Â  Â  Â  Â  Â  Â  <TextInput value={detailDesc} onChangeText={setDetailDesc} multiline numberOfLines={4} placeholder={t('add_note_placeholder')} placeholderTextColor={currentColors.subText} style={[styles.inputField, { height: 120, textAlignVertical: 'top', paddingTop: 12 }]} />
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  {selectedTask?.attachments && selectedTask.attachments.length > 0 && (
Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={styles.sectionLabel}>Ekli Dosyalar</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ gap: 8 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {selectedTask.attachments.map((file: any, index: number) => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  key={index}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // WebBrowser ile aÃ§ (PDF, Resim vb. gÃ¶rÃ¼ntÃ¼lenir)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (file.url) WebBrowser.openBrowserAsync(file.url);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flexDirection: 'row', alignItems: 'center',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isDark ? '#334155' : '#f1f5f9',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding: 12, borderRadius: 12, gap: 10Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ backgroundColor: '#fff', padding: 6, borderRadius: 8 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <FileText size={20} color={COLORS.primary} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flex: 1 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text numberOfLines={1} style={{ color: currentColors.text, fontWeight: '600' }}>{file.name}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 10, color: currentColors.subText }}>DokÃ¼man / GÃ¶rsel</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Download size={20} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  <Text style={styles.sectionLabel}>{t('due_date_label')}</Text>
Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row' }}>
Â  Â  Â  Â  Â  Â  Â  Â  <TextInput value={detailDueDate} onChangeText={handleDetailDueDateChange} placeholder="dd-mm-yyyy" placeholderTextColor={currentColors.subText} maxLength={10} keyboardType="numeric" style={[styles.inputField, { borderTopRightRadius: 0, borderBottomRightRadius: 0, flex: 1 }]} />
Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => openDatePicker('detail')} style={styles.inputAppendBtn}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <CalendarIcon size={22} color="#fff" />
Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={saveTaskDetail} style={styles.primaryButton}>
Â  Â  Â  Â  Â  Â  Â  <Text style={styles.primaryButtonText}>{t('save')}</Text>
Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  </ScrollView>
Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  /* --- YENÄ° MODERN GÃ–REV SOHBET TASARIMI --- */
Â  Â  Â  Â  Â  <View style={{ flex: 1, backgroundColor: isDark ? '#0f172a' : '#f1f5f9', borderRadius: 20, overflow: 'hidden' }}>
Â  Â  Â  Â  Â  Â  <FlatListÂ 
Â  Â  Â  Â  Â  Â  Â  data={taskComments}Â 
Â  Â  Â  Â  Â  Â  Â  keyExtractor={item => item.id}Â 
Â  Â  Â  Â  Â  Â  Â  contentContainerStyle={{ padding: 15, paddingBottom: 20 }}Â 
Â  Â  Â  Â  Â  Â  Â  showsVerticalScrollIndicator={false}
Â  Â  Â  Â  Â  Â  Â  renderItem={({ item }) => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  const isMe = item.senderId === user.uid;Â 
Â  Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flexDirection: 'row',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marginBottom: 15,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  justifyContent: isMe ? 'flex-end' : 'flex-start',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'flex-end'
Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* KarÅŸÄ± TarafÄ±n AvatarÄ± */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {!isMe && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 32, height: 32, borderRadius: 16,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: COLORS.secondary, marginRight: 8,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center', justifyContent: 'center',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 1, borderColor: currentColors.bgÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 12, fontWeight: 'bold', color: '#fff' }}>{item.senderName?.[0]?.toUpperCase()}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Mesaj BaloncuÄŸu */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ maxWidth: '75%' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Ä°sim (Sadece karÅŸÄ± tarafsa ve grup mantÄ±ÄŸÄ± varsa, ama burada ÅŸÄ±k durur) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {!isMe && <Text style={{ fontSize: 10, color: currentColors.subText, marginLeft: 4, marginBottom: 2 }}>{item.senderName}</Text>}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isMe ? COLORS.primary : (isDark ? '#334155' : '#fff'),Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingVertical: 10, paddingHorizontal: 14,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 18,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderBottomLeftRadius: isMe ? 18 : 4,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderBottomRightRadius: isMe ? 4 : 18,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: "#000", shadowOpacity: 0.05, shadowRadius: 2, elevation: 1
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: isMe ? '#fff' : currentColors.text, fontSize: 15, lineHeight: 20 }}>{item.text}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  );Â 
Â  Â  Â  Â  Â  Â  Â  }}Â 
Â  Â  Â  Â  Â  Â  Â  ListEmptyComponent={
Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ alignItems: 'center', justifyContent: 'center', height: 200, opacity: 0.6 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ backgroundColor: isDark ? '#1e293b' : '#e2e8f0', padding: 20, borderRadius: 50, marginBottom: 15 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <MessageCircle size={40} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.text, fontWeight: '600' }}>{t('no_comments_yet')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.subText, fontSize: 12 }}>Bu gÃ¶rev hakkÄ±nda not veya yorum ekleyin.</Text>
Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  />

Â  Â  Â  Â  Â  Â  {/* Mesaj Yazma AlanÄ± */}
Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  padding: 10,Â 
Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: currentColors.surface,Â 
Â  Â  Â  Â  Â  Â  Â  Â  borderTopWidth: 1, borderColor: isDark ? '#334155' : '#e2e8f0',
Â  Â  Â  Â  Â  Â  Â  Â  flexDirection: 'row', alignItems: 'center', gap: 10Â 
Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  <TextInputÂ 
Â  Â  Â  Â  Â  Â  Â  Â  value={taskCommentInput}Â 
Â  Â  Â  Â  Â  Â  Â  Â  onChangeText={setTaskCommentInput}Â 
Â  Â  Â  Â  Â  Â  Â  Â  placeholder={t('add_comment_placeholder')}Â 
Â  Â  Â  Â  Â  Â  Â  Â  placeholderTextColor={currentColors.subText}Â 
Â  Â  Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flex: 1,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isDark ? '#1e293b' : '#f8fafc',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 24,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingHorizontal: 16,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  height: 44, // Biraz daha yÃ¼ksek
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: currentColors.text,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 1, borderColor: isDark ? '#334155' : '#e2e8f0'
Â  Â  Â  Â  Â  Â  Â  Â  }}Â 
Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  onPress={sendTaskComment}Â 
Â  Â  Â  Â  Â  Â  Â  Â  disabled={!taskCommentInput.trim()}Â 
Â  Â  Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 44, height: 44, borderRadius: 22,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: taskCommentInput.trim() ? COLORS.primary : (isDark ? '#334155' : '#e2e8f0'),Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center', justifyContent: 'center'Â 
Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  <Send size={20} color={taskCommentInput.trim() ? '#fff' : '#94a3b8'} />
Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  )}
Â  Â  Â  </View>
Â  Â  </View>
Â  </KeyboardAvoidingView>
</Modal>

{/* E. KATEGORÄ° MODALI */}
<Modal visible={isCategoryModalOpen} transparent animationType="fade">
Â  <TouchableOpacity activeOpacity={1} onPress={() => { setIsCategoryModalOpen(false); Keyboard.dismiss(); }} style={styles.centerModalOverlay}>
Â  Â  <KeyboardAvoidingView behavior={Platform.OS === "ios" ? "padding" : "height"} style={{ width: '100%', alignItems: 'center' }}>
Â  Â  Â  <TouchableWithoutFeedback>
Â  Â  Â  Â  <View style={[styles.centerCard, { height: '80%', maxHeight: 600 }]}>
Â  Â  Â  Â  Â  <View style={styles.modalHeader}>
Â  Â  Â  Â  Â  Â  <Text style={styles.modalTitle}>{t('categories_title')}</Text>
Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => setIsCategoryModalOpen(false)}><X size={24} color={currentColors.subText} /></TouchableOpacity>
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  <ScrollView style={{ flex: 1, marginBottom: 15 }} showsVerticalScrollIndicator={false}>
Â  Â  Â  Â  Â  Â  {categories.map((cat) => (
Â  Â  Â  Â  Â  Â  Â  <View key={cat.id} style={styles.categoryListItem}>
Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 12 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={[styles.colorDot, { backgroundColor: CATEGORY_COLORS.find(c => c.id === cat.color)?.hex || 'gray' }]} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 16, fontWeight: '600', color: currentColors.text }}>{cat.name}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => handleDeleteCategory(cat.id)} style={styles.deleteIconBtn}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <Trash2 size={18} color={COLORS.danger} />
Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  </ScrollView>

Â  Â  Â  Â  Â  <View style={{ paddingTop: 15, borderTopWidth: 1, borderColor: isDark ? '#334155' : '#f1f5f9' }}>
Â  Â  Â  Â  Â  Â  <Text style={styles.sectionLabel}>{t('create_new_category')}</Text>
Â  Â  Â  Â  Â  Â  <TextInput value={newCategoryName} onChangeText={setNewCategoryName} placeholder={t('category_name_placeholder')} placeholderTextColor={currentColors.subText} style={[styles.inputField, { marginBottom: 15 }]} />
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <ScrollView horizontal showsHorizontalScrollIndicator={false} contentContainerStyle={{ gap: 10, paddingBottom: 15 }}>
Â  Â  Â  Â  Â  Â  Â  {CATEGORY_PALETTE.map(colorName => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  const colorHex = CATEGORY_COLORS.find(c => c.id === colorName)?.hex || '#000';Â 
Â  Â  Â  Â  Â  Â  Â  Â  const isSelected = newCategoryColor === colorName;Â 
Â  Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity key={colorName} onPress={() => setNewCategoryColor(colorName)} style={[styles.colorCircle, { backgroundColor: colorHex }, isSelected && styles.colorCircleSelected]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isSelected && <Check size={18} color="#fff" strokeWidth={3} />}
Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  )Â 
Â  Â  Â  Â  Â  Â  Â  })}
Â  Â  Â  Â  Â  Â  </ScrollView>

Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={handleAddCategory} disabled={!newCategoryName.trim()} style={[styles.primaryButton, !newCategoryName.trim() && { backgroundColor: '#94a3b8' }]}>
Â  Â  Â  Â  Â  Â  Â  <Plus size={20} color="#fff" strokeWidth={3} />
Â  Â  Â  Â  Â  Â  Â  <Text style={styles.primaryButtonText}>{t('create_new_category')}</Text>
Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  </View>
Â  Â  Â  </TouchableWithoutFeedback>
Â  Â  </KeyboardAvoidingView>
Â  </TouchableOpacity>
</Modal>
{/* --- H. ARKADAÅž EKLEME (NETWORK) MODALI --- */}
<Modal visible={isNetworkModalOpen} animationType="slide" presentationStyle="pageSheet">
Â  <KeyboardAvoidingView behavior={Platform.OS === 'ios' ? 'padding' : undefined} style={{ flex: 1, backgroundColor: currentColors.bg }}>
Â  Â  <View style={{ flex: 1, padding: 20 }}>
Â  Â  Â Â 
Â  Â  Â  {/* Header */}
Â  Â  Â  <View style={styles.modalHeader}>
Â  Â  Â  Â  <Text style={styles.modalTitle}>{t('connections') || "BaÄŸlantÄ±lar"}</Text>
Â  Â  Â  Â  <TouchableOpacity onPress={() => setIsNetworkModalOpen(false)}>
Â  Â  Â  Â  Â  <Text style={{ color: COLORS.primary, fontWeight: 'bold', fontSize: 16 }}>{t('close_btn')}</Text>
Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  </View>

Â  Â  Â  {/* Sekmeler (KullanÄ±cÄ± AdÄ± ile Ara / Rehberden Bul) */}
Â  Â  Â  <View style={{ flexDirection: 'row', marginBottom: 20, backgroundColor: isDark ? '#334155' : '#e2e8f0', borderRadius: 12, padding: 4 }}>
Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  onPress={() => setNetworkTab('ommio')}Â 
Â  Â  Â  Â  Â  style={{ flex: 1, padding: 8, alignItems: 'center', borderRadius: 10, backgroundColor: networkTab === 'ommio' ? (isDark ? '#1e293b' : '#fff') : 'transparent', shadowColor: networkTab === 'ommio' ? "#000" : "transparent", shadowOpacity: 0.1, elevation: networkTab === 'ommio' ? 2 : 0 }}
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  <Text style={{ fontWeight: 'bold', color: networkTab === 'ommio' ? currentColors.text : currentColors.subText }}>
Â  Â  Â  Â  Â  Â  {t('auth_username_placeholder') || "KullanÄ±cÄ± AdÄ±"}
Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  onPress={() => { setNetworkTab('contacts'); fetchDeviceContacts(); }}Â 
Â  Â  Â  Â  Â  style={{ flex: 1, padding: 8, alignItems: 'center', borderRadius: 10, backgroundColor: networkTab === 'contacts' ? (isDark ? '#1e293b' : '#fff') : 'transparent', shadowColor: networkTab === 'contacts' ? "#000" : "transparent", shadowOpacity: 0.1, elevation: networkTab === 'contacts' ? 2 : 0 }}
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  <Text style={{ fontWeight: 'bold', color: networkTab === 'contacts' ? currentColors.text : currentColors.subText }}>
Â  Â  Â  Â  Â  Â  {t('find_from_contacts') || "Rehber"}
Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  </View>

Â  Â  Â  {/* --- SEKME 1: KULLANICI ADI Ä°LE ARA --- */}
Â  Â  Â  {networkTab === 'ommio' ? (
Â  Â  Â  Â  <View style={{ gap: 20 }}>
Â  Â  Â  Â  Â  <Text style={{ color: currentColors.subText, fontSize: 14 }}>
Â  Â  Â  Â  Â  Â  {t('add_friend_prompt') || "ArkadaÅŸÄ±nÄ±n kullanÄ±cÄ± adÄ±nÄ± girerek istek gÃ¶nder."}
Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', gap: 10 }}>
Â  Â  Â  Â  Â  Â  <View style={[styles.authInputRow, { flex: 1, marginBottom: 0, height: 50 }]}>
Â  Â  Â  Â  Â  Â  Â  <User size={20} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  <TextInputÂ 
Â  Â  Â  Â  Â  Â  Â  Â  value={searchUsername}Â 
Â  Â  Â  Â  Â  Â  Â  Â  onChangeText={setSearchUsername}Â 
Â  Â  Â  Â  Â  Â  Â  Â  placeholder={t('search_username') || "kullaniciadi"}Â 
Â  Â  Â  Â  Â  Â  Â  Â  placeholderTextColor={currentColors.subText}Â 
Â  Â  Â  Â  Â  Â  Â  Â  style={[styles.authInput, { color: currentColors.text }]}Â 
Â  Â  Â  Â  Â  Â  Â  Â  autoCapitalize='none'Â 
Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  onPress={sendFriendRequest}Â 
Â  Â  Â  Â  Â  Â  Â  style={{ backgroundColor: COLORS.primary, width: 50, borderRadius: 12, alignItems: 'center', justifyContent: 'center' }}
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  <UserPlus size={24} color="#fff" />
Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  {/* Bilgilendirme */}
Â  Â  Â  Â  Â  <View style={{ backgroundColor: isDark ? 'rgba(59, 130, 246, 0.1)' : '#eff6ff', padding: 15, borderRadius: 12, borderLeftWidth: 4, borderLeftColor: COLORS.primary }}>
Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.text, fontSize: 13 }}>
Â  Â  Â  Â  Â  Â  Â  ðŸ’¡ KullanÄ±cÄ± adÄ± tam eÅŸleÅŸmelidir. BÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf duyarlÄ± deÄŸildir.
Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  </View>
Â  Â  Â  ) : (
Â  Â  Â  Â  /* --- SEKME 2: REHBER (CONTACTS) --- */
Â  Â  Â  Â  <FlatListÂ 
Â  Â  Â  Â  Â  data={deviceContacts}Â 
Â  Â  Â  Â  Â  keyExtractor={item => item.id}Â 
Â  Â  Â  Â  Â  contentContainerStyle={{ paddingBottom: 20 }}
Â  Â  Â  Â  Â  renderItem={({ item }) => (
Â  Â  Â  Â  Â  Â  <View style={{ backgroundColor: currentColors.surface, padding: 15, borderRadius: 16, marginBottom: 10, flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', borderWidth: 1, borderColor: isDark ? '#334155' : '#f1f5f9' }}>
Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.text, fontWeight: 'bold' }}>{item.name}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.subText, fontSize: 12 }}>{item.phoneNumber}</Text>
Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => inviteContact(item.phoneNumber)} style={{ backgroundColor: isDark ? '#334155' : '#eff6ff', padding: 8, borderRadius: 8, flexDirection: 'row', alignItems: 'center', gap: 5 }}>
Â  Â  Â  Â  Â  Â  Â  Â  <Send size={14} color={COLORS.primary} />
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: COLORS.primary, fontSize: 12, fontWeight: 'bold' }}>Davet Et</Text>
Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  )}Â 
Â  Â  Â  Â  Â  ListEmptyComponent={
Â  Â  Â  Â  Â  Â  <Text style={{ textAlign: 'center', color: currentColors.subText, marginTop: 40 }}>
Â  Â  Â  Â  Â  Â  Â  {t('contacts_loading_or_denied') || "KiÅŸiler yÃ¼kleniyor veya izin verilmedi."}
Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  />
Â  Â  Â  )}
Â  Â  </View>
Â  </KeyboardAvoidingView>
</Modal>

{/* F. PREMIUM & UPSELL & ADS */}
<Modal visible={isAdVisible} transparent animationType="fade">
Â  <View style={styles.fullScreenOverlay}>
Â  Â  <View style={styles.adCard}>
Â  Â  Â  <View style={{ flexDirection: 'row', justifyContent: 'space-between', width: '100%', marginBottom: 10 }}>
Â  Â  Â  Â  <Text style={styles.adBadge}>{t('ad_label_full')}</Text>
Â  Â  Â  </View>
Â  Â  Â  <View style={styles.adContentPlaceholder}>
Â  Â  Â  Â  <Text style={{ color: '#666' }}>Google Ads Component</Text>
Â  Â  Â  </View>
Â  Â  Â  <TouchableOpacity disabled={adCountdown > 0} onPress={() => { setIsAdVisible(false); setIsUpsellVisible(true); }} style={styles.adCloseBtn}>
Â  Â  Â  Â  <Text style={{ color: '#000', fontWeight: 'bold' }}>{adCountdown > 0 ? `${t('ad_skip')} ${adCountdown}` : `${t('ad_close')} âœ•`}</Text>
Â  Â  Â  </TouchableOpacity>
Â  Â  </View>
Â  </View>
</Modal>

<Modal visible={isUpsellVisible} transparent animationType="slide">
Â  <View style={styles.centerModalOverlay}>
Â  Â  <View style={styles.centerCard}>
Â  Â  Â  <View style={{ alignItems: 'center', marginBottom: 20 }}>
Â  Â  Â  Â  <View style={styles.upsellIconCircle}><Trophy size={40} color="#d97706" fill="#d97706" /></View>
Â  Â  Â  Â  <Text style={styles.upsellTitle}>{t('premium_unlock')}</Text>
Â  Â  Â  Â  <Text style={styles.upsellSubtitle}>{t('premium_subtitle')}</Text>
Â  Â  Â  </View>
Â  Â  Â Â 
Â  Â  Â  <View style={{ gap: 12, marginBottom: 25 }}>
Â  Â  Â  Â  {[t('premium_feat_ads'), t('premium_feat_habits'), t('premium_feat_stats'), t('premium_feat_themes')].map((feat, i) => (
Â  Â  Â  Â  Â  <View key={i} style={{ flexDirection: 'row', alignItems: 'center', gap: 10 }}>
Â  Â  Â  Â  Â  Â  Â <View style={styles.checkCircleSmall}><Check size={12} color="#fff" strokeWidth={3} /></View>
Â  Â  Â  Â  Â  Â  Â <Text style={{ color: currentColors.text, fontSize: 14 }}>{feat}</Text>
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  ))}
Â  Â  Â  </View>

Â  Â  Â  <TouchableOpacity onPress={async () => { if (user) { await setDoc(doc(db, "users", user.uid), { isPremium: true }, { merge: true }); setIsUpsellVisible(false); } }} style={styles.primaryButton}>
Â  Â  Â  Â  <View style={{ alignItems: 'center' }}>
Â  Â  Â  Â  Â  <Text style={styles.primaryButtonText}>{t('premium_cta')}</Text>
Â  Â  Â  Â  Â  <Text style={{ color: 'rgba(255,255,255,0.8)', fontSize: 10 }}>{t('premium_price')}</Text>
Â  Â  Â  Â  </View>
Â  Â  Â  </TouchableOpacity>
Â  Â  Â  <TouchableOpacity onPress={() => setIsUpsellVisible(false)} style={{ padding: 15, alignItems: 'center' }}>
Â  Â  Â  Â  <Text style={{ color: currentColors.subText, fontSize: 13, fontWeight: '600' }}>{t('keep_ads')}</Text>
Â  Â  Â  </TouchableOpacity>
Â  Â  </View>
Â  </View>
</Modal>

{/* G. DÄ°ÄžER KÃœÃ‡ÃœK MODALLAR (Onboarding, Language, Confirm vb.) */}
{/* ONBOARDING */}
<Modal visible={showOnboarding} animationType="fade">
Â  <View style={styles.onboardingContainer}>
Â  Â  <View style={{ alignItems: 'center', gap: 20, paddingHorizontal: 20 }}>
Â  Â  Â  <View style={styles.onboardingIconCircle}>
Â  Â  Â  Â  {onboardingStep === 0 ? <ListTodo size={60} color="#fff" /> : (onboardingStep === 1 ? <Repeat size={60} color="#fff" /> : <Users size={60} color="#fff" />)}
Â  Â  Â  </View>
Â  Â  Â  <Text style={styles.onboardingTitle}>
Â  Â  Â  Â  {onboardingStep === 0 ? t('welcome') : (onboardingStep === 1 ? t('onboard_step2_title') : t('onboard_step3_title'))}
Â  Â  Â  </Text>
Â  Â  Â  <Text style={styles.onboardingDesc}>
Â  Â  Â  Â  {onboardingStep === 0 ? t('onboard_step1_desc') : (onboardingStep === 1 ? t('onboard_step2_desc') : t('onboard_step3_desc'))}
Â  Â  Â  </Text>
Â  Â  </View>
Â  Â  <View style={styles.onboardingFooter}>
Â  Â  Â  <View style={{ flexDirection: 'row', gap: 6 }}>
Â  Â  Â  Â  {[0, 1, 2].map(i => <View key={i} style={{ width: 8, height: 8, borderRadius: 4, backgroundColor: i === onboardingStep ? '#fff' : 'rgba(255,255,255,0.3)' }} />)}
Â  Â  Â  </View>
Â  Â  Â  <TouchableOpacity onPress={async () => { if (onboardingStep < 2) { setOnboardingStep(onboardingStep + 1); } else { setShowOnboarding(false); if (user) await updateDoc(doc(db, "users", user.uid), { hasSeenOnboarding: true }); } }} style={styles.onboardingBtn}>
Â  Â  Â  Â  <Text style={{ color: COLORS.primary, fontWeight: 'bold' }}>{onboardingStep === 2 ? t('start_btn') : t('next_btn')}</Text>
Â  Â  Â  </TouchableOpacity>
Â  Â  </View>
Â  </View>
</Modal>
{/* --- H. ÅžÄ°FRE SIFIRLAMA MODALI (GÃœNCELLENDÄ°) --- */}
<Modal visible={isPasswordModalOpen} transparent animationType="fade">
Â  <TouchableWithoutFeedback onPress={() => setIsPasswordModalOpen(false)}>
Â  Â  <View style={styles.centerModalOverlay}>
Â  Â  Â  <View style={styles.centerCard}>
Â  Â  Â  Â Â 
Â  Â  Â  Â  {/* Header */}
Â  Â  Â  Â  <View style={styles.modalHeader}>
Â  Â  Â  Â  Â  <Text style={styles.modalTitle}>
Â  Â  Â  Â  Â  Â  {t('change_password') || "Åžifre DeÄŸiÅŸtir"}
Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => setIsPasswordModalOpen(false)}>
Â  Â  Â  Â  Â  Â  <X size={24} color={currentColors.subText} />
Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  </View>

Â  Â  Â  Â  {/* Bilgilendirme Metni */}
Â  Â  Â  Â  <View style={{ alignItems: 'center', marginBottom: 20 }}>
Â  Â  Â  Â  Â  Â  <View style={{ width: 60, height: 60, borderRadius: 30, backgroundColor: '#e0f2fe', alignItems: 'center', justifyContent: 'center', marginBottom: 15 }}>
Â  Â  Â  Â  Â  Â  Â  Â  <Mail size={30} color="#0284c7" />
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  <Text style={{ textAlign: 'center', color: currentColors.text, fontSize: 16, fontWeight: '600', marginBottom: 5 }}>
Â  Â  Â  Â  Â  Â  Â  Â  E-posta GÃ¶nderilsin mi?
Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  <Text style={{ textAlign: 'center', color: currentColors.subText, fontSize: 14, lineHeight: 20 }}>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontWeight: 'bold' }}>{user?.email}</Text> adresine ÅŸifrenizi yenilemeniz iÃ§in bir baÄŸlantÄ± gÃ¶ndereceÄŸiz.
Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  </View>

Â  Â  Â  Â  {/* GÃ¶nder Butonu */}
Â  Â  Â  Â  <View style={styles.formGap}>
Â  Â  Â  Â  Â  <TouchableOpacity onPress={handlePasswordChange} style={styles.primaryButton}>
Â  Â  Â  Â  Â  Â  {isAuthLoading ? (
Â  Â  Â  Â  Â  Â  Â  Â  <ActivityIndicator color="#fff" />
Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={styles.primaryButtonText}>BaÄŸlantÄ±yÄ± GÃ¶nder</Text>
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => setIsPasswordModalOpen(false)} style={{ padding: 10, alignItems: 'center' }}>
Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.subText }}>VazgeÃ§</Text>
Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  </View>

Â  Â  Â  </View>
Â  Â  </View>
Â  </TouchableWithoutFeedback>
</Modal>

{/* --- I. DÄ°L SEÃ‡Ä°MÄ° (LANGUAGE) MODALI --- */}
<Modal visible={isLangModalOpen} transparent animationType="fade">
Â  <TouchableOpacityÂ 
Â  Â  activeOpacity={1}Â 
Â  Â  onPress={() => setIsLangModalOpen(false)}Â 
Â  Â  style={styles.centerModalOverlay}
Â  >
Â  Â  <View style={[styles.centerCard, { padding: 0, overflow: 'hidden', maxHeight: 500 }]}>
Â  Â  Â  <View style={{ padding: 20, borderBottomWidth: 1, borderColor: isDark ? '#334155' : '#f1f5f9', flexDirection:'row', justifyContent:'space-between', alignItems:'center' }}>
Â  Â  Â  Â  <Text style={styles.modalTitle}>{t('select_language') || "Dil SeÃ§imi"}</Text>
Â  Â  Â  Â  <TouchableOpacity onPress={() => setIsLangModalOpen(false)}>
Â  Â  Â  Â  Â  <X size={24} color={currentColors.subText} />
Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  </View>
Â  Â  Â Â 
Â  Â  Â  <ScrollView contentContainerStyle={{ padding: 10 }}>
Â  Â  Â  Â  {LANGUAGES.map((item) => {
Â  Â  Â  Â  Â  const isSelected = lang === item.code;
Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  <TouchableOpacity
Â  Â  Â  Â  Â  Â  Â  key={item.code}
Â  Â  Â  Â  Â  Â  Â  onPress={() => {
Â  Â  Â  Â  Â  Â  Â  Â  setLang(item.code as LangCode);
Â  Â  Â  Â  Â  Â  Â  Â  setIsLangModalOpen(false);
Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  style={{
Â  Â  Â  Â  Â  Â  Â  Â  flexDirection: 'row',
Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center',
Â  Â  Â  Â  Â  Â  Â  Â  padding: 15,
Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 12,
Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isSelected ? (isDark ? '#334155' : '#eff6ff') : 'transparent',
Â  Â  Â  Â  Â  Â  Â  Â  marginBottom: 5
Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 24, marginRight: 15 }}>{item.flag}</Text>
Â  Â  Â  Â  Â  Â  Â  <Text style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  fontSize: 16,Â 
Â  Â  Â  Â  Â  Â  Â  Â  fontWeight: isSelected ? 'bold' : '500',Â 
Â  Â  Â  Â  Â  Â  Â  Â  color: isSelected ? COLORS.primary : currentColors.text,
Â  Â  Â  Â  Â  Â  Â  Â  flex: 1
Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  {item.label}
Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  {isSelected && <Check size={20} color={COLORS.primary} />}
Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  );
Â  Â  Â  Â  })}
Â  Â  Â  </ScrollView>
Â  Â  </View>
Â  </TouchableOpacity>
</Modal>
{/* --- J. ARKADAÅžA ATANAN GÃ–REVLER LÄ°STESÄ° MODALI --- */}
<Modal visible={friendTasksModal.visible} transparent animationType="slide">
Â  <View style={styles.centerModalOverlay}>
Â  Â  <View style={[styles.centerCard, { height: '70%', padding: 0, overflow: 'hidden' }]}>
Â  Â  Â Â 
Â  Â  Â  {/* BaÅŸlÄ±k */}
Â  Â  Â  <View style={{ padding: 20, borderBottomWidth: 1, borderColor: isDark ? '#334155' : '#f1f5f9', flexDirection:'row', justifyContent:'space-between', alignItems:'center' }}>
Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  <Text style={styles.modalTitle}>{friendTasksModal.friendName}</Text>
Â  Â  Â  Â  Â  <Text style={{ fontSize: 12, color: currentColors.subText }}>{t('my_assigned_tasks') || "AtadÄ±ÄŸÄ±m GÃ¶revler"}</Text>
Â  Â  Â  Â  </View>
Â  Â  Â  Â  <TouchableOpacity onPress={() => setFriendTasksModal({ visible: false, tasks: [], friendName: '' })}>
Â  Â  Â  Â  Â  <X size={24} color={currentColors.subText} />
Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  </View>

Â  Â  Â  {/* Liste */}
Â  Â  Â  <FlatList
Â  Â  Â  Â  data={friendTasksModal.tasks}
Â  Â  Â  Â  keyExtractor={(item) => item.id}
Â  Â  Â  Â  contentContainerStyle={{ padding: 15, paddingBottom: 20 }}
Â  Â  Â  Â  ListEmptyComponent={
Â  Â  Â  Â  Â  <View style={{ alignItems: 'center', marginTop: 50, opacity: 0.6 }}>
Â  Â  Â  Â  Â  Â  <ListTodo size={40} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  <Text style={{ marginTop: 10, color: currentColors.subText }}>HenÃ¼z aktif bir gÃ¶rev atamadÄ±n.</Text>
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  }
Â  Â  Â  Â  renderItem={({ item }) => (
Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  onPress={() => {
Â  Â  Â  Â  Â  Â  Â  // 1. TÄ±klanan gÃ¶revi seÃ§ili hale getir
Â  Â  Â  Â  Â  Â  Â  setSelectedTask(item);
Â  Â  Â  Â  Â  Â  Â  // 2. Bu modalÄ± kapat
Â  Â  Â  Â  Â  Â  Â  setFriendTasksModal({ ...friendTasksModal, visible: false });
Â  Â  Â  Â  Â  Â  Â  // 3. Sohbet sekmesini aktif et (Task Detay ModalÄ± iÃ§inde)
Â  Â  Â  Â  Â  Â  Â  setTaskModalTab('chat');
Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  backgroundColor: isDark ? '#1e293b' : '#f8fafc',Â 
Â  Â  Â  Â  Â  Â  padding: 12, borderRadius: 12, marginBottom: 10,
Â  Â  Â  Â  Â  Â  borderLeftWidth: 4, borderLeftColor: item.completed ? COLORS.success : COLORS.warning
Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  <View style={{ flexDirection:'row', justifyContent:'space-between', alignItems:'flex-start' }}>
Â  Â  Â  Â  Â  Â  Â  <Text style={{ flex:1, color: currentColors.text, fontWeight: '600', fontSize: 15, textDecorationLine: item.completed ? 'line-through' : 'none' }}>
Â  Â  Â  Â  Â  Â  Â  Â  {item.text}
Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  {/* Mesaj Ä°konu ve Bildirim BaloncuÄŸu */}
Â  Â  Â  Â  Â  Â  Â  <View style={{ marginLeft: 5 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Burada TaskChatButton'Ä± kullanamayÄ±z Ã§Ã¼nkÃ¼ onPress'i farklÄ±,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  o yÃ¼zden manuel bir kontrol ekliyoruz veya TaskChatButton'Ä± modifiye ediyoruz.Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  En kolayÄ± TaskChatButton'Ä± buraya da koymak ama onPress'i override etmek. */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  <TaskChatButtonÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  task={item}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  user={user}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setSelectedTask(item);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setFriendTasksModal({ ...friendTasksModal, visible: false });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTaskModalTab('chat');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', justifyContent: 'space-between', marginTop: 8, alignItems: 'center' }}>
Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', gap: 6, alignItems: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  <CalendarIcon size={12} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 12, color: currentColors.subText }}>{item.date}</Text>
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  backgroundColor: item.completed ? '#dcfce7' : '#fef3c7',Â 
Â  Â  Â  Â  Â  Â  Â  paddingHorizontal: 8, paddingVertical: 2, borderRadius: 6Â 
Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  <Text style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  fontSize: 10, fontWeight: 'bold',Â 
Â  Â  Â  Â  Â  Â  Â  Â  color: item.completed ? '#166534' : '#b45309'Â 
Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  {item.completed ? t('completed') : t('pending') || "Bekliyor"}
Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  )}
Â  Â  Â  Â Â 
Â  Â  Â Â 
Â  Â  Â  />
Â  Â  </View>
Â  </View>
</Modal>

Â  Â  Â  Â  {/* --- K. TÃœM GÃ–REVLER (AJANDA) MODALI --- */}
Â  Â  Â  Â  <Modal visible={isAllTasksModalOpen} animationType="slide" presentationStyle="pageSheet">
Â  Â  Â  Â  Â  <View style={{ flex: 1, backgroundColor: currentColors.bg }}>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  {/* Header */}
Â  Â  Â  Â  Â  Â  <View style={{ padding: 20, paddingBottom: 10, borderBottomWidth: 1, borderColor: isDark ? '#334155' : '#f1f5f9', flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 20, fontWeight: 'bold', color: currentColors.text }}>{t('agenda') || "TÃ¼m Planlar"}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 12, color: currentColors.subText }}>YaklaÅŸan gÃ¶revleriniz (Tarihe gÃ¶re)</Text>
Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => setIsAllTasksModalOpen(false)} style={{ padding: 5 }}>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: COLORS.primary, fontWeight: 'bold', fontSize: 16 }}>{t('close_btn')}</Text>
Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  {/* Liste */}
Â  Â  Â  Â  Â  Â  <FlatList
Â  Â  Â  Â  Â  Â  Â  data={tasks
Â  Â  Â  Â  Â  Â  Â  Â  .filter(t => !t.completed) // Sadece yapÄ±lmamÄ±ÅŸ gÃ¶revleri gÃ¶ster (Ä°stersen bunu kaldÄ±rÄ±p hepsini gÃ¶sterebilirsin)
Â  Â  Â  Â  Â  Â  Â  Â  .sort((a, b) => a.date.localeCompare(b.date)) // Tarihe gÃ¶re A'dan Z'ye (YakÄ±ndan uzaÄŸa)
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  keyExtractor={(item) => item.id}
Â  Â  Â  Â  Â  Â  Â  contentContainerStyle={{ padding: 20, paddingBottom: 50 }}
Â  Â  Â  Â  Â  Â  Â  ListEmptyComponent={
Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ alignItems: 'center', marginTop: 100, opacity: 0.6 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <CalendarDays size={50} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ marginTop: 15, color: currentColors.subText, fontSize: 16 }}>PlanlanmÄ±ÅŸ gÃ¶rev yok.</Text>
Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  renderItem={({ item }) => {
Â  Â  Â  Â  Â  Â  Â  Â  // Kategori rengini bul
Â  Â  Â  Â  Â  Â  Â  Â  const cat = categories.find(c => c.id === item.categoryId);
Â  Â  Â  Â  Â  Â  Â  Â  const catColor = CATEGORY_COLORS.find(c => c.id === cat?.color)?.hex || COLORS.primary;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Tarihi gÃ¼zelleÅŸtir (Opsiyonel: BugÃ¼n/YarÄ±n yazdÄ±rÄ±labilir ama basitÃ§e tarihi yazÄ±yoruz)
Â  Â  Â  Â  Â  Â  Â  Â  const dateParts = item.date.split('-'); // YYYY-MM-DD varsayÄ±yoruz
Â  Â  Â  Â  Â  Â  Â  Â  const formattedDate = `${dateParts[2]}.${dateParts[1]}.${dateParts[0]}`; // DD.MM.YYYY Ã§evrimi

Â  Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flexDirection: 'row',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: currentColors.surface,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding: 16,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marginBottom: 12,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 16,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderLeftWidth: 4,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderLeftColor: catColor,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: "#000", shadowOpacity: 0.05, shadowRadius: 5, elevation: 2
Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Tarih Kutusu (Sol) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  justifyContent: 'center',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingRight: 15,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRightWidth: 1,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRightColor: isDark ? '#334155' : '#f1f5f9',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marginRight: 15,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 60
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 18, fontWeight: 'bold', color: currentColors.text }}>{dateParts[2]}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 12, color: currentColors.subText }}>{dateParts[1]}/{dateParts[0]}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Ä°Ã§erik (Orta) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flex: 1 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text numberOfLines={2} style={{ fontSize: 16, fontWeight: '600', color: currentColors.text, marginBottom: 4 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {item.text}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 8 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 4 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ width: 6, height: 6, borderRadius: 3, backgroundColor: catColor }} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 12, color: currentColors.subText }}>{cat?.name || "Genel"}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {item.dueDate && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 10, color: COLORS.danger, fontWeight: 'bold' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (BitiÅŸ: {item.dueDate})
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Git Butonu (SaÄŸ) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setIsAllTasksModalOpen(false); // ModalÄ± kapat
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Takvimi o tarihe gÃ¶tÃ¼r
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const targetDate = new Date(item.date);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setSelectedDate(targetDate);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ChevronRight size={20} color={currentColors.subText} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  </Modal>
Â  Â  Â  Â Â 
Â  Â  Â  Â  {/* --- L. ALIÅžKANLIK ANALÄ°Z MODALI --- */}
Â  Â  Â  Â  <Modal visible={isHabitStatsModalOpen} animationType="slide" presentationStyle="pageSheet">
Â  Â  Â  Â  Â  <View style={{ flex: 1, backgroundColor: currentColors.bg }}>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  {/* Header */}
Â  Â  Â  Â  Â  Â  <View style={{ padding: 20, paddingBottom: 10, borderBottomWidth: 1, borderColor: isDark ? '#334155' : '#f1f5f9', flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 20, fontWeight: 'bold', color: currentColors.text }}>{t('analysis') || "Analiz Raporu"}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 12, color: currentColors.subText }}>AlÄ±ÅŸkanlÄ±k performansÄ±n</Text>
Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => setIsHabitStatsModalOpen(false)} style={{ padding: 5 }}>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: COLORS.primary, fontWeight: 'bold', fontSize: 16 }}>{t('close_btn')}</Text>
Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  <ScrollView contentContainerStyle={{ padding: 20, paddingBottom: 50 }}>
Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  {/* 1. HESAPLAMA MANTIÄžI (Render iÃ§inde yapÄ±yoruz ki gÃ¼ncel olsun) */}
Â  Â  Â  Â  Â  Â  Â  {(() => {
Â  Â  Â  Â  Â  Â  Â  Â  // A. Toplam Tamamlanma SayÄ±sÄ±na GÃ¶re SÄ±rala
Â  Â  Â  Â  Â  Â  Â  Â  const sortedHabits = [...habits].sort((a, b) => b.completedDates.length - a.completedDates.length);
Â  Â  Â  Â  Â  Â  Â  Â  const bestHabit = sortedHabits.length > 0 ? sortedHabits[0] : null;
Â  Â  Â  Â  Â  Â  Â  Â  const worstHabit = sortedHabits.length > 0 ? sortedHabits[sortedHabits.length - 1] : null;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // B. Son 7 GÃ¼nlÃ¼k Aktiviteyi Hesapla
Â  Â  Â  Â  Â  Â  Â  Â  const last7Days = [];
Â  Â  Â  Â  Â  Â  Â  Â  const today = new Date();
Â  Â  Â  Â  Â  Â  Â  Â  let maxActivity = 0; // Grafik Ã¶lÃ§eÄŸi iÃ§in

Â  Â  Â  Â  Â  Â  Â  Â  for (let i = 6; i >= 0; i--) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const d = new Date();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  d.setDate(today.getDate() - i);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isoDate = getISODate(d);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // O gÃ¼n tamamlanan toplam alÄ±ÅŸkanlÄ±k sayÄ±sÄ±
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const count = habits.reduce((acc, h) => acc + (h.completedDates.includes(isoDate) ? 1 : 0), 0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (count > maxActivity) maxActivity = count;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  last7Days.push({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label: getDaysOfWeek(lang)[d.getDay() === 0 ? 6 : d.getDay() - 1].label[0], // P, S, Ã‡ gibi tek harf
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  count: count,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fullDate: isoDate
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ gap: 20 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- 2. GRAFÄ°K (SON 7 GÃœN) --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ backgroundColor: currentColors.surface, padding: 20, borderRadius: 24, shadowColor: "#000", shadowOpacity: 0.05, elevation: 3 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 10, marginBottom: 20 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ padding: 8, backgroundColor: '#eff6ff', borderRadius: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TrendingUp size={20} color="#3b82f6" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 16, fontWeight: 'bold', color: currentColors.text }}>Son 7 GÃ¼n Aktivitesi</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', justifyContent: 'space-between', alignItems: 'flex-end', height: 150 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {last7Days.map((day, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Bar yÃ¼ksekliÄŸi (Max 100%)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const heightPct = maxActivity > 0 ? (day.count / maxActivity) * 100 : 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isToday = index === 6;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View key={index} style={{ alignItems: 'center', flex: 1 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Bar SayÄ±sÄ± (Ãœstte) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 10, color: currentColors.subText, marginBottom: 5 }}>{day.count > 0 ? day.count : ''}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Bar Ã‡ubuÄŸu */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 12,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  height: `${heightPct || 5}%`, // En az %5 gÃ¶rÃ¼nsÃ¼nÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isToday ? COLORS.primary : (day.count > 0 ? '#cbd5e1' : '#f1f5f9'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 6,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  minHeight: 12
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* GÃ¼n Harfi */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ marginTop: 8, fontSize: 12, fontWeight: isToday ? 'bold' : '500', color: isToday ? COLORS.primary : currentColors.subText }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {day.label}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- 3. ÅžAMPÄ°YON ALIÅžKANLIK --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {bestHabit && bestHabit.completedDates.length > 0 && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ backgroundColor: '#f0fdf4', padding: 20, borderRadius: 24, borderWidth: 1, borderColor: '#bbf7d0' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 12 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ padding: 10, backgroundColor: '#dcfce7', borderRadius: 12 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Award size={24} color="#16a34a" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 13, color: '#166534', fontWeight: 'bold', textTransform: 'uppercase' }}>En Ä°stikrarlÄ±</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 18, color: '#14532d', fontWeight: '900' }}>{bestHabit.title}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ marginTop: 15, flexDirection: 'row', alignItems: 'center', gap: 5 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 32, fontWeight: '900', color: '#16a34a' }}>{bestHabit.completedDates.length}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 14, color: '#15803d', fontWeight: '500', marginBottom: 5 }}>kez tamamlandÄ±</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- 4. GELÄ°ÅžTÄ°RÄ°LMESÄ° GEREKEN --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {worstHabit && worstHabit.id !== bestHabit?.id && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ backgroundColor: '#fff7ed', padding: 20, borderRadius: 24, borderWidth: 1, borderColor: '#ffedd5' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 12 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ padding: 10, backgroundColor: '#ffedd5', borderRadius: 12 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <AlertTriangle size={24} color="#ea580c" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 13, color: '#c2410c', fontWeight: 'bold', textTransform: 'uppercase' }}>Ä°lgi Bekliyor</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 18, color: '#7c2d12', fontWeight: '900' }}>{worstHabit.title}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ marginTop: 10, color: '#9a3412', fontSize: 14 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Bu alÄ±ÅŸkanlÄ±ÄŸÄ± dÃ¼zenli yapmakta zorlanÄ±yorsun. Belki hedefini kÃ¼Ã§Ã¼ltebilirsin?
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* --- 5. DETAYLI LÄ°STE --- */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 16, fontWeight: 'bold', color: currentColors.text, marginBottom: 10 }}>DetaylÄ± SÄ±ralama</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {sortedHabits.map((habit, index) => (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View key={habit.id} style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding: 15, backgroundColor: currentColors.surface, marginBottom: 8, borderRadius: 16
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 12 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 14, color: currentColors.subText, fontWeight: 'bold', width: 20 }}>#{index + 1}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 15, color: currentColors.text, fontWeight: '600' }}>{habit.title}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ backgroundColor: index === 0 ? '#dcfce7' : (isDark ? '#334155' : '#f1f5f9'), paddingHorizontal: 10, paddingVertical: 4, borderRadius: 8 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontWeight: 'bold', color: index === 0 ? '#166534' : currentColors.text, fontSize: 12 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {habit.completedDates.length} <Text style={{fontSize:10}}>kez</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  })()}
Â  Â  Â  Â  Â  Â  </ScrollView>
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  </Modal>

Â  Â  Â  Â  {/* --- M. GRUP OLUÅžTURMA MODALI --- */}
Â  Â  Â  Â  <Modal visible={isGroupModalOpen} animationType="slide" presentationStyle="pageSheet">
Â  Â  Â  Â  Â  <KeyboardAvoidingView behavior={Platform.OS === 'ios' ? 'padding' : undefined} style={{ flex: 1, backgroundColor: currentColors.bg }}>
Â  Â  Â  Â  Â  Â  <View style={{ flex: 1, padding: 20 }}>
Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  {/* Header */}
Â  Â  Â  Â  Â  Â  Â  <View style={styles.modalHeader}>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={styles.modalTitle}>Yeni Grup AlÄ±ÅŸkanlÄ±ÄŸÄ±</Text>
Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => setIsGroupModalOpen(false)}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: COLORS.primary, fontWeight: 'bold', fontSize: 16 }}>{t('cancel')}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  <ScrollView contentContainerStyle={{ gap: 20 }}>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  {/* Ä°sim */}
Â  Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={styles.sectionLabel}>Grup / AlÄ±ÅŸkanlÄ±k AdÄ±</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TextInputÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value={newGroupTitle}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onChangeText={setNewGroupTitle}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Ã–rn: Her gÃ¼n 10K AdÄ±m, Kitap Okuma..."
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholderTextColor={currentColors.subText}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={styles.inputField}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  {/* ArkadaÅŸ SeÃ§imi */}
Â  Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={styles.sectionLabel}>ArkadaÅŸlarÄ±nÄ± Davet Et</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {contacts.length === 0 ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.subText, fontStyle: 'italic' }}>HenÃ¼z arkadaÅŸÄ±n yok. Ã–nce arkadaÅŸ eklemelisin.</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ gap: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {contacts.map(contact => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isSelected = selectedGroupMembers.includes(contact.uid);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  key={contact.uid}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isSelected) setSelectedGroupMembers(prev => prev.filter(id => id !== contact.uid));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else setSelectedGroupMembers(prev => [...prev, contact.uid]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flexDirection: 'row', alignItems: 'center', justifyContent: 'space-between',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding: 12, backgroundColor: currentColors.surface, borderRadius: 12,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 1, borderColor: isSelected ? COLORS.primary : (isDark ? '#334155' : '#e2e8f0')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 10 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ width: 36, height: 36, borderRadius: 18, backgroundColor: COLORS.secondary, alignItems: 'center', justifyContent: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {contact.photoURL ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Image source={{ uri: contact.photoURL }} style={{ width: 36, height: 36, borderRadius: 18 }} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontWeight: 'bold', color: '#fff' }}>{contact.username[0].toUpperCase()}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: currentColors.text, fontWeight: '600' }}>{contact.displayName || contact.username}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ width: 24, height: 24, borderRadius: 12, borderWidth: 2, borderColor: isSelected ? COLORS.primary : '#cbd5e1', alignItems: 'center', justifyContent: 'center', backgroundColor: isSelected ? COLORS.primary : 'transparent' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isSelected && <Check size={14} color="#fff" />}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={handleCreateGroup} style={[styles.primaryButton, { marginTop: 20 }]}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isAuthLoading ? <ActivityIndicator color="#fff" /> : <Text style={styles.primaryButtonText}>Grubu Kur</Text>}
Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>

Â  Â  Â  Â  Â  Â  Â  </ScrollView>
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  </KeyboardAvoidingView>
Â  Â  Â  Â  </Modal>

Â  Â  Â  Â  {/* --- N. TAMAMLANAN GÃ–REVLER (GEÃ‡MÄ°Åž) MODALI --- */}
Â  Â  Â  Â  <Modal visible={isHistoryModalOpen} animationType="slide" presentationStyle="pageSheet">
Â  Â  Â  Â  Â  <View style={{ flex: 1, backgroundColor: currentColors.bg }}>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  {/* Header */}
Â  Â  Â  Â  Â  Â  <View style={{ padding: 20, paddingBottom: 10, borderBottomWidth: 1, borderColor: isDark ? '#334155' : '#f1f5f9', flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  <View>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 20, fontWeight: 'bold', color: currentColors.text }}>Tamamlananlar</Text>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 12, color: currentColors.subText }}>BaÅŸardÄ±ÄŸÄ±n gÃ¶revlerin listesi</Text>
Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity onPress={() => setIsHistoryModalOpen(false)} style={{ padding: 5 }}>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: COLORS.primary, fontWeight: 'bold', fontSize: 16 }}>{t('close_btn')}</Text>
Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  {/* Liste */}
Â  Â  Â  Â  Â  Â  <FlatList
Â  Â  Â  Â  Â  Â  Â  data={tasks
Â  Â  Â  Â  Â  Â  Â  Â  .filter(t => t.completed) // Sadece tamamlananlar
Â  Â  Â  Â  Â  Â  Â  Â  .sort((a, b) => b.date.localeCompare(a.date)) // En yeni tarih en Ã¼stte
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  keyExtractor={(item) => item.id}
Â  Â  Â  Â  Â  Â  Â  contentContainerStyle={{ padding: 20, paddingBottom: 50 }}
Â  Â  Â  Â  Â  Â  Â  ListEmptyComponent={
Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ alignItems: 'center', marginTop: 100, opacity: 0.6 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ width: 80, height: 80, borderRadius: 40, backgroundColor: isDark ? 'rgba(16, 185, 129, 0.1)' : '#ecfdf5', alignItems: 'center', justifyContent: 'center', marginBottom: 20 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <CheckCircle2 size={40} color={COLORS.success} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ marginTop: 15, color: currentColors.subText, fontSize: 16 }}>HenÃ¼z tamamlanmÄ±ÅŸ gÃ¶rev yok.</Text>
Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  renderItem={({ item }) => {
Â  Â  Â  Â  Â  Â  Â  Â  // Kategori rengi
Â  Â  Â  Â  Â  Â  Â  Â  const cat = categories.find(c => c.id === item.categoryId);
Â  Â  Â  Â  Â  Â  Â  Â  const catColor = CATEGORY_COLORS.find(c => c.id === cat?.color)?.hex || COLORS.success;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const dateParts = item.date.split('-');Â 
Â  Â  Â  Â  Â  Â  Â  Â  const formattedDate = `${dateParts[2]}.${dateParts[1]}.${dateParts[0]}`;

Â  Â  Â  Â  Â  Â  Â  Â  return (
Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flexDirection: 'row',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: currentColors.surface,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  padding: 16,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marginBottom: 12,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 16,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderLeftWidth: 4,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderLeftColor: COLORS.success, // YeÅŸil Ã§izgi
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: "#000", shadowOpacity: 0.05, shadowRadius: 5, elevation: 2
Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Tarih (Sol) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alignItems: 'center',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  justifyContent: 'center',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paddingRight: 15,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRightWidth: 1,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderRightColor: isDark ? '#334155' : '#f1f5f9',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marginRight: 15,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: 60
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 18, fontWeight: 'bold', color: COLORS.success }}>{dateParts[2]}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 12, color: currentColors.subText }}>{dateParts[1]}/{dateParts[0]}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Ä°Ã§erik (Orta) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flex: 1 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 16, fontWeight: '600', color: currentColors.text, marginBottom: 4, textDecorationLine: 'line-through', opacity: 0.7 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {item.text}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Alt Bilgiler */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', flexWrap: 'wrap', gap: 8, alignItems: 'center' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Kategori */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 4, backgroundColor: isDark ? '#334155' : '#f0fdf4', paddingHorizontal: 6, paddingVertical: 2, borderRadius: 6 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ width: 6, height: 6, borderRadius: 3, backgroundColor: catColor }} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 10, color: currentColors.subText }}>{cat?.name || "Genel"}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Kim atadÄ±? (BaÅŸkasÄ±ysa) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {item.assignedBy && item.assignedBy !== user.uid && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', gap: 4, backgroundColor: '#fff7ed', paddingHorizontal: 6, paddingVertical: 2, borderRadius: 6 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <User size={10} color="#ea580c" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 10, color: "#ea580c" }}>{item.assignedByName}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* AÃ§Ä±klama Varsa */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {item.description ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text numberOfLines={2} style={{ fontSize: 12, color: currentColors.subText, marginTop: 6, fontStyle: 'italic' }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "{item.description}"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : null}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Sil butonu (Opsiyonel: GeÃ§miÅŸten tamamen silmek iÃ§in) */}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPress={() => askConfirmation(t('delete'), t('task_delete_confirm'), () => deleteTask(item), true)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style={{ padding: 5 }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Trash2 size={18} color={currentColors.subText} style={{ opacity: 0.5 }} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  </Modal>

{/* CONFIRM (Onay) */}
<Modal visible={confirmModal.visible} transparent animationType="fade">
Â  <View style={styles.centerModalOverlay}>
Â  Â  <View style={[styles.centerCard, { maxWidth: 320 }]}>
Â  Â  Â  <Text style={styles.modalTitle}>{confirmModal.title}</Text>
Â  Â  Â  <Text style={[styles.modalSubtitle, { textAlign: 'center' }]}>{confirmModal.message}</Text>
Â  Â  Â  <View style={{ flexDirection: 'row', gap: 10, marginTop: 10 }}>
Â  Â  Â  Â  <TouchableOpacity onPress={() => setConfirmModal(prev => ({ ...prev, visible: false }))} style={styles.cancelButton}>
Â  Â  Â  Â  Â  <Text style={{ color: currentColors.text, fontWeight: '600' }}>{t('cancel_btn')}</Text>
Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  onPress={() => { confirmModal.onConfirm(); setConfirmModal(prev => ({ ...prev, visible: false })); }}Â 
Â  Â  Â  Â  Â  style={[styles.confirmButton, { backgroundColor: confirmModal.isDestructive ? COLORS.danger : COLORS.primary }]}
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  <Text style={{ color: '#fff', fontWeight: 'bold' }}>{confirmModal.isDestructive ? t('delete') : t('confirm_btn')}</Text>
Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  </View>
Â  Â  </View>
Â  </View>
</Modal>
Â  Â  Â  </SafeAreaView>
Â  Â  </KeyboardAvoidingView>
Â  );
}

// --- OmmioApp FONKSÄ°YONUNUN DIÅžINA, EN ALTA ---

// --- TÄ°P TANIMLAMASI ---
interface MessageItemProps {
Â  Â  msg: any; Â  Â  Â  Â  Â // DetaylÄ± tipiniz varsa ChatMessage kullanÄ±n, yoksa any
Â  Â  user: any; Â  Â  Â  Â  // User tipi
Â  Â  chatTarget: any; Â  // Contact tipi
Â  Â  currentColors: any;
Â  Â  isDark: boolean;
}
// --- GÃ–REV KARTINDAKÄ° AKILLI SOHBET BUTONU (DÃœZELTÄ°LMÄ°Åž) ---
const TaskChatButton = ({ task, user, onPress }: { task: any, user: any, onPress: () => void }) => {
Â  Â  const [hasUnread, setHasUnread] = React.useState(false);

Â  Â  React.useEffect(() => {
Â  Â  Â  Â  if (!user || !task) return;

Â  Â  Â  Â  let targetDbId = user.uid;
Â  Â  Â  Â  if (task.assignedTo) {
Â  Â  Â  Â  Â  Â  targetDbId = task.assignedTo;
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- DÃœZELTME BURADA ---
Â  Â  Â  Â  // Sadece 'read' durumuna bakÄ±yoruz. 'senderId' kontrolÃ¼nÃ¼ aÅŸaÄŸÄ±da yapacaÄŸÄ±z.
Â  Â  Â  Â  // Bu sayede Index oluÅŸturmana gerek kalmaz.
Â  Â  Â  Â  const q = query(
Â  Â  Â  Â  Â  Â  collection(db, "users", targetDbId, "tasks", task.id, "comments"),
Â  Â  Â  Â  Â  Â  where("read", "==", false)Â 
Â  Â  Â  Â  );

Â  Â  Â  Â  const unsubscribe = onSnapshot(q, (snapshot) => {
Â  Â  Â  Â  Â  Â  if (snapshot.empty) {
Â  Â  Â  Â  Â  Â  Â  Â  setHasUnread(false);
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // JavaScript tarafÄ±nda filtreleme:
Â  Â  Â  Â  Â  Â  // OkunmamÄ±ÅŸ mesajlarÄ±n iÃ§inde "Bana Ait Olmayan" (BaÅŸkasÄ± tarafÄ±ndan atÄ±lmÄ±ÅŸ) var mÄ±?
Â  Â  Â  Â  Â  Â  const incomingUnreadMessages = snapshot.docs.filter(doc => {
Â  Â  Â  Â  Â  Â  Â  Â  const data = doc.data();
Â  Â  Â  Â  Â  Â  Â  Â  return data.senderId !== user.uid;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (incomingUnreadMessages.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  setHasUnread(true);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  setHasUnread(false);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }, (error) => {
Â  Â  Â  Â  Â  Â  // Hata olursa konsola yaz ama uygulamayÄ± Ã§Ã¶kertme
Â  Â  Â  Â  Â  Â  console.log("TaskChatButton Error:", error);
Â  Â  Â  Â  });

Â  Â  Â  Â  return () => unsubscribe();
Â  Â  }, [task, user]);

Â  Â  return (
Â  Â  Â  Â  <TouchableOpacityÂ 
Â  Â  Â  Â  Â  Â  onPress={onPress}Â 
Â  Â  Â  Â  Â  Â  style={{ padding: 8, marginRight: 5, position: 'relative' }}
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  <MessageCircle size={22} color={COLORS.primary} strokeWidth={2} />
Â  Â  Â  Â  Â  Â  {hasUnread && (
Â  Â  Â  Â  Â  Â  Â  Â  <View style={{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  position: 'absolute', top: 2, right: 2, width: 12, height: 12, borderRadius: 6,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: COLORS.danger, borderWidth: 2, borderColor: '#fff', zIndex: 10
Â  Â  Â  Â  Â  Â  Â  Â  }} />
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  </TouchableOpacity>
Â  Â  );
};
// --- GÃœNCELLENMÄ°Åž MessageItem ---
const MessageItem = ({ msg, user, chatTarget, currentColors, isDark }: MessageItemProps) => {
Â  Â  const [decryptedText, setDecryptedText] = useState(msg.text);Â 
Â  Â  const isMe = msg.senderId === user.uid;

Â  Â  // MessageItem iÃ§indeki useEffect'i bununla deÄŸiÅŸtir:
useEffect(() => {
Â  Â  const decrypt = async () => {
Â  Â  Â  Â  // 1. DÃ¼z metin kontrolÃ¼
Â  Â  Â  Â  if (!msg.text || !msg.text.startsWith('{')) {
Â  Â  Â  Â  Â  Â  setDecryptedText(msg.text);
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  // 2. Åžifre Ã‡Ã¶zme
Â  Â  Â  Â  if (isMe) {
Â  Â  Â  Â  Â  Â  // ... (Kendi mesajÄ±m kÄ±smÄ± aynÄ± kalsÄ±n) ...
Â  Â  Â  Â  Â  Â  if (msg.senderCopy && msg.senderCopy.startsWith('{')) {
Â  Â  Â  Â  Â  Â  Â  Â  const myKey = user.publicKey;Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (myKey) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const text = await decryptMessage(msg.senderCopy, myKey);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setDecryptedText(text);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) { setDecryptedText("âš ï¸ Ã‡Ã¶zÃ¼lemedi"); }
Â  Â  Â  Â  Â  Â  Â  Â  } else { setDecryptedText("Anahtar yok..."); }
Â  Â  Â  Â  Â  Â  } else { setDecryptedText(msg.senderCopy || "ðŸ”’"); }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // --- GELEN MESAJ (KARÅžI TARAF) ---
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // A. Ã–nce prop'tan gelen anahtarÄ± dene
Â  Â  Â  Â  Â  Â  let senderKey = chatTarget?.publicKey;

Â  Â  Â  Â  Â  Â  // B. EÄŸer prop'ta yoksa, ACÄ°L DURUM: VeritabanÄ±ndan o an Ã§ek
Â  Â  Â  Â  Â  Â  if (!senderKey) {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userDoc = await getDoc(doc(db, "public_users", chatTarget.uid));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (userDoc.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  senderKey = userDoc.data().publicKey;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch(e) { console.log("Key fetch error", e); }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (senderKey) {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const text = await decryptMessage(msg.text, senderKey);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setDecryptedText(text);
Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setDecryptedText("âš ï¸ Åžifre hatasÄ±");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  setDecryptedText("â³ Anahtar bekleniyor...");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  };
Â  Â  decrypt();
}, [msg.text, msg.senderCopy, isMe, user.publicKey, chatTarget]); // chatTarget dependency'de kalsÄ±n

Â  Â  const timeString = msg.timestamp ? new Date(msg.timestamp.seconds * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '';

Â  Â  return (
Â  Â  Â  Â  <View style={{ alignSelf: isMe ? 'flex-end' : 'flex-start', marginBottom: 8, maxWidth: '75%' }}>
Â  Â  Â  Â  Â  Â  <View style={{
Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: isMe ? COLORS.primary : (isDark ? '#334155' : '#fff'),
Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 12, borderBottomRightRadius: isMe ? 2 : 12, borderBottomLeftRadius: isMe ? 12 : 2,
Â  Â  Â  Â  Â  Â  Â  Â  padding: 8, paddingHorizontal: 12,
Â  Â  Â  Â  Â  Â  Â  Â  shadowColor: "#000", shadowOpacity: 0.05, shadowRadius: 2, elevation: 1
Â  Â  Â  Â  Â  Â  }}>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ color: isMe ? '#fff' : currentColors.text, fontSize: 15 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {decryptedText}
Â  Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  Â  Â  <View style={{ flexDirection: 'row', alignItems: 'center', justifyContent: 'flex-end', marginTop: 2, gap: 4 }}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={{ fontSize: 9, color: isMe ? 'rgba(255,255,255,0.7)' : currentColors.subText }}>{timeString}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isMe && (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  msg.read ? <CheckCheck size={14} color="#a5f3fc" /> : <CheckCheck size={14} color="rgba(255,255,255,0.6)" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  </View>
Â  Â  );
};

const premiumStyles = StyleSheet.create({
Â Â 
Â  overlay: {
Â  Â  flex: 1,
Â  Â  backgroundColor: 'rgba(0,0,0,0.85)', // ArkasÄ± hafif karartÄ±lmÄ±ÅŸ
Â  Â  justifyContent: 'center',
Â  Â  alignItems: 'center',
Â  Â  padding: 20
Â  },
Â  adContainer: {
Â  Â  width: '100%',
Â  Â  maxWidth: 400, // Web'de Ã§ok geniÅŸlemesin
Â  Â  height: '60%', // EkranÄ±n %60'Ä±nÄ± kaplasÄ±n
Â  Â  backgroundColor: '#000',
Â  Â  borderRadius: 16,
Â  Â  padding: 15,
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'space-between'
Â  },
Â  closeAdButton: {
Â  Â  width: '100%',
Â  Â  padding: 15,
Â  Â  borderRadius: 12,
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'center',
Â  Â  marginTop: 15
Â  },
Â  card: {
Â  Â  width: '100%',
Â  Â  maxWidth: 380, // Web'de kart gÃ¶rÃ¼nÃ¼mÃ¼ iÃ§in sÄ±nÄ±r
Â  Â  borderRadius: 32, // Modern yuvarlak kÃ¶ÅŸeler
Â  Â  padding: 30,
Â  Â  alignItems: 'center',
Â  Â  shadowColor: "#000",
Â  Â  shadowOffset: { width: 0, height: 10 },
Â  Â  shadowOpacity: 0.25,
Â  Â  shadowRadius: 20,
Â  Â  elevation: 10,
Â  },
Â  headerSection: {
Â  Â  alignItems: 'center',
Â  Â  marginBottom: 25
Â  },
Â  iconCircle: {
Â  Â  width: 80,
Â  Â  height: 80,
Â  Â  borderRadius: 40,
Â  Â  backgroundColor: '#fffbeb', // AÃ§Ä±k amber rengi
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'center',
Â  Â  marginBottom: 15,
Â  Â  borderWidth: 1,
Â  Â  borderColor: '#fcd34d'
Â  },
Â  title: {
Â  Â  fontSize: 24,
Â  Â  fontWeight: '900',
Â  Â  textAlign: 'center',
Â  Â  marginBottom: 8
Â  },
Â  subtitle: {
Â  Â  fontSize: 14,
Â  Â  textAlign: 'center',
Â  Â  paddingHorizontal: 10,
Â  Â  lineHeight: 20
Â  },
Â  featuresList: {
Â  Â  width: '100%',
Â  Â  marginBottom: 20
Â  },
Â  featureItem: {
Â  Â  flexDirection: 'row',
Â  Â  alignItems: 'center',
Â  Â  marginBottom: 12,
Â  Â  gap: 12
Â  },
Â  checkCircle: {
Â  Â  width: 20,
Â  Â  height: 20,
Â  Â  borderRadius: 10,
Â  Â  backgroundColor: '#10b981', // YeÅŸil tik
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'center'
Â  },
Â  featureText: {
Â  Â  fontSize: 15,
Â  Â  fontWeight: '500'
Â  },
Â  ctaButton: {
Â  Â  backgroundColor: '#d97706', // Amber-600
Â  Â  paddingVertical: 16,
Â  Â  borderRadius: 16,
Â  Â  alignItems: 'center',
Â  Â  shadowColor: '#d97706',
Â  Â  shadowOffset: { width: 0, height: 4 },
Â  Â  shadowOpacity: 0.4,
Â  Â  shadowRadius: 8,
Â  Â  elevation: 5
Â  },
Â  ctaText: {
Â  Â  color: '#fff',
Â  Â  fontSize: 18,
Â  Â  fontWeight: 'bold'
Â  },
Â  ctaSubText: {
Â  Â  color: 'rgba(255,255,255,0.8)',
Â  Â  fontSize: 12,
Â  Â  marginTop: 2
Â  },
Â  secondaryButton: {
Â  Â  padding: 10,
Â  Â  alignItems: 'center'
Â  }
});
const getDynamicStyles = (currentColors: any, isDark: boolean) => StyleSheet.create({
Â  closeBtn: {
Â  Â  padding: 8,
Â  Â  backgroundColor: isDark ? '#334155' : '#f1f5f9', // Hafif bir arka plan
Â  Â  borderRadius: 20, // Yuvarlak buton gÃ¶rÃ¼nÃ¼mÃ¼
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'center',
Â  },
Â  // --- MODAL & SHEET STYLES ---
Â  modalOverlay: {
Â  Â  flex: 1,
Â  Â  justifyContent: 'flex-end',
Â  Â  backgroundColor: 'rgba(0,0,0,0.5)',
Â  },
Â  modalBackdrop: {
Â  Â  flex: 1,
Â  },
Â  shadow: {
Â  Â  Â  Â  shadowColor: "#000",
Â  Â  Â  Â  shadowOffset: { width: 0, height: 2 },
Â  Â  Â  Â  shadowOpacity: 0.08, // Daha yumuÅŸak gÃ¶lge
Â  Â  Â  Â  shadowRadius: 4,
Â  Â  Â  Â  elevation: 3,
Â  Â  },
Â  Â  // Header
Â  Â  header: {
Â  Â  Â  Â  flexDirection: 'row',
Â  Â  Â  Â  alignItems: 'center',
Â  Â  Â  Â  justifyContent: 'space-between',
Â  Â  Â  Â  paddingTop: Platform.OS === 'ios' ? 50 : 15,
Â  Â  Â  Â  paddingBottom: 12,
Â  Â  Â  Â  paddingHorizontal: 16,
Â  Â  Â  Â  borderBottomWidth: 1, // Hafif bir Ã§izgi daha modern durur
Â  Â  Â  Â  borderBottomLeftRadius: 20,
Â  Â  Â  Â  borderBottomRightRadius: 20,
Â  Â  Â  Â  zIndex: 20,
Â  Â  },
Â  Â  headerLeft: {
Â  Â  Â  Â  flexDirection: 'row',
Â  Â  Â  Â  alignItems: 'center',
Â  Â  Â  Â  flex: 1,
Â  Â  },
Â  Â  iconButton: {
Â  Â  Â  Â  width: 40,
Â  Â  Â  Â  height: 40,
Â  Â  Â  Â  borderRadius: 12,
Â  Â  Â  Â  alignItems: 'center',
Â  Â  Â  Â  justifyContent: 'center',
Â  Â  Â  Â  marginRight: 10,
Â  Â  },
Â  Â  avatarContainer: {
Â  Â  Â  Â  marginRight: 12,
Â  Â  },
Â  Â  avatarImage: {
Â  Â  Â  Â  width: 40,
Â  Â  Â  Â  height: 40,
Â  Â  Â  Â  borderRadius: 20,
Â  Â  Â  Â  borderWidth: 1.5,
Â  Â  Â  Â  borderColor: '#fff',
Â  Â  },
Â  Â  avatarPlaceholder: {
Â  Â  Â  Â  width: 40,
Â  Â  Â  Â  height: 40,
Â  Â  Â  Â  borderRadius: 20,
Â  Â  Â  Â  alignItems: 'center',
Â  Â  Â  Â  justifyContent: 'center',
Â  Â  Â  Â  borderWidth: 1.5,
Â  Â  Â  Â  borderColor: '#fff',
Â  Â  },
Â  Â  avatarText: {
Â  Â  Â  Â  color: '#fff',
Â  Â  Â  Â  fontSize: 16,
Â  Â  Â  Â  fontWeight: 'bold',
Â  Â  },
Â  Â  headerTitle: {
Â  Â  Â  Â  fontSize: 16,
Â  Â  Â  Â  fontWeight: '700',
Â  Â  Â  Â  marginBottom: 1,
Â  Â  },
Â  Â  headerSubtitle: {
Â  Â  Â  Â  fontSize: 12,
Â  Â  },
Â  Â  // Menu Dropdown
Â  Â  menuDropdown: {
Â  Â  Â  Â  position: 'absolute',
Â  Â  Â  Â  top: 45,
Â  Â  Â  Â  right: 0,
Â  Â  Â  Â  width: 150,
Â  Â  Â  Â  borderRadius: 14,
Â  Â  Â  Â  padding: 6,
Â  Â  Â  Â  borderWidth: 1,
Â  Â  Â  Â  zIndex: 100,
Â  Â  },
Â  Â  menuItem: {
Â  Â  Â  Â  flexDirection: 'row',
Â  Â  Â  Â  alignItems: 'center',
Â  Â  Â  Â  paddingVertical: 10,
Â  Â  Â  Â  paddingHorizontal: 12,
Â  Â  Â  Â  borderRadius: 10,
Â  Â  },
Â  Â  // List
Â  Â  listContainer: {
Â  Â  Â  Â  paddingHorizontal: 16,
Â  Â  Â  Â  paddingVertical: 20,
Â  Â  },
Â  Â  // Input Area
Â  Â  inputWrapper: {
Â  Â  Â  Â  paddingHorizontal: 16,
Â  Â  Â  Â  paddingBottom: Platform.OS === 'ios' ? 34 : 20,
Â  Â  Â  Â  paddingTop: 10,
Â  Â  },
Â  Â  inputContainer: {
Â  Â  Â  Â  flexDirection: 'row',
Â  Â  Â  Â  alignItems: 'flex-end',
Â  Â  Â  Â  borderRadius: 26,
Â  Â  Â  Â  borderWidth: 1,
Â  Â  Â  Â  minHeight: 50,
Â  Â  Â  Â  padding: 4, // Ä°Ã§ boÅŸluk ile butonu inputtan ayÄ±ran modern gÃ¶rÃ¼nÃ¼m
Â  Â  },
Â  Â  textInput: {
Â  Â  Â  Â  flex: 1,
Â  Â  Â  Â  fontSize: 16,
Â  Â  Â  Â  paddingHorizontal: 16,
Â  Â  Â  Â  paddingVertical: 12, // Dikey ortalama
Â  Â  Â  Â  maxHeight: 120,
Â  Â  Â  Â  paddingTop: 12, // Multiline iÃ§in hizalama
Â  Â  },
Â  Â  sendButton: {
Â  Â  Â  Â  width: 42,
Â  Â  Â  Â  height: 42,
Â  Â  Â  Â  borderRadius: 21,
Â  Â  Â  Â  alignItems: 'center',
Â  Â  Â  Â  justifyContent: 'center',
Â  Â  Â  Â  marginBottom: 2,Â 
Â  Â  Â  Â  marginRight: 2,
Â  Â  },
Â  bottomSheetCard: {
Â  Â  backgroundColor: currentColors.bg,
Â  Â  borderTopLeftRadius: 24,
Â  Â  borderTopRightRadius: 24,
Â  Â  padding: 24,
Â  Â  minHeight: 400,
Â  Â  shadowColor: "#000",
Â  Â  shadowOffset: { width: 0, height: -5 },
Â  Â  shadowOpacity: 0.1,
Â  Â  shadowRadius: 10,
Â  Â  elevation: 20,
Â  },
Â  centerModalOverlay: {
Â  Â  flex: 1,
Â  Â  backgroundColor: 'rgba(0,0,0,0.6)',
Â  Â  justifyContent: 'center',
Â  Â  alignItems: 'center',
Â  Â  padding: 20,
Â  },
Â  centerCard: {
Â  Â  backgroundColor: currentColors.surface,
Â  Â  borderRadius: 24,
Â  Â  padding: 24,
Â  Â  width: '100%',
Â  Â  maxWidth: 400,
Â  Â  shadowColor: "#000",
Â  Â  shadowOpacity: 0.25,
Â  Â  shadowRadius: 10,
Â  Â  elevation: 10,
Â  },
Â  modalHeader: {
Â  Â  flexDirection: 'row',
Â  Â  justifyContent: 'space-between',
Â  Â  alignItems: 'center',
Â  Â  marginBottom: 20,
Â  },
Â  modalTitle: {
Â  Â  fontSize: 20,
Â  Â  fontWeight: 'bold',
Â  Â  color: currentColors.text,
Â  },
Â  modalSubtitle: {
Â  Â  color: currentColors.subText,
Â  Â  marginBottom: 20,
Â  Â  lineHeight: 20,
Â  },
Â Â 
Â  // FORM ELEMENTS
Â  formGap: {
Â  Â  gap: 16,
Â  },
Â  inputField: {
Â  Â  backgroundColor: isDark ? '#1e293b' : '#f8fafc',
Â  Â  color: currentColors.text,
Â  Â  padding: 14,
Â  Â  borderRadius: 12,
Â  Â  fontSize: 15,
Â  Â  borderWidth: 1,
Â  Â  borderColor: isDark ? '#334155' : '#e2e8f0',
Â  },
Â  inputAppendBtn: {
Â  Â  backgroundColor: COLORS.primary,
Â  Â  paddingHorizontal: 15,
Â  Â  borderTopRightRadius: 12,
Â  Â  borderBottomRightRadius: 12,
Â  Â  justifyContent: 'center',
Â  Â  alignItems: 'center',
Â  },
Â  iconInputRow: {
Â  Â  flexDirection: 'row',
Â  Â  alignItems: 'center',
Â  Â  backgroundColor: isDark ? '#1e293b' : '#f8fafc',
Â  Â  borderWidth: 1,
Â  Â  borderColor: isDark ? '#334155' : '#e2e8f0',
Â  Â  borderRadius: 12,
Â  Â  paddingHorizontal: 15,
Â  Â  gap: 10,
Â  },
Â  flexInput: {
Â  Â  flex: 1,
Â  Â  paddingVertical: 14,
Â  Â  color: currentColors.text,
Â  Â  fontSize: 15,
Â  },
Â  primaryButton: {
Â  Â  backgroundColor: COLORS.primary,
Â  Â  padding: 16,
Â  Â  borderRadius: 14,
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'center',
Â  Â  shadowColor: COLORS.primary,
Â  Â  shadowOpacity: 0.3,
Â  Â  shadowRadius: 5,
Â  Â  elevation: 4,
Â  Â  flexDirection: 'row',
Â  Â  gap: 8,
Â  },
Â  primaryButtonText: {
Â  Â  color: '#fff',
Â  Â  fontWeight: 'bold',
Â  Â  fontSize: 16,
Â  },

Â  // HABIT & FREQUENCY
Â  freqRow: {
Â  Â  flexDirection: 'row',
Â  Â  gap: 10,
Â  },
Â  freqPill: {
Â  Â  flex: 1,
Â  Â  paddingVertical: 10,
Â  Â  alignItems: 'center',
Â  Â  borderRadius: 10,
Â  Â  backgroundColor: isDark ? '#334155' : '#f1f5f9',
Â  Â  borderWidth: 1,
Â  Â  borderColor: isDark ? '#475569' : '#e2e8f0',
Â  },
Â  freqPillActive: {
Â  Â  backgroundColor: COLORS.primary,
Â  Â  borderColor: COLORS.primary,
Â  },
Â  freqText: {
Â  Â  fontWeight: '600',
Â  Â  color: currentColors.text,
Â  },
Â  freqTextActive: {
Â  Â  color: '#fff',
Â  },
Â  daysWrapper: {
Â  Â  marginTop: 5,
Â  },
Â  daysContainer: {
Â  Â  flexDirection: 'row',
Â  Â  flexWrap: 'wrap',
Â  Â  gap: 8,
Â  Â  marginTop: 8,
Â  },
Â  dayCircle: {
Â  Â  width: 38,
Â  Â  height: 38,
Â  Â  borderRadius: 19,
Â  Â  backgroundColor: isDark ? '#334155' : '#f1f5f9',
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'center',
Â  Â  borderWidth: 1,
Â  Â  borderColor: isDark ? '#475569' : '#e2e8f0',
Â  },
Â  dayCircleActive: {
Â  Â  backgroundColor: COLORS.primary,
Â  Â  borderColor: COLORS.primary,
Â  },
Â  dayText: {
Â  Â  fontSize: 11,
Â  Â  fontWeight: 'bold',
Â  Â  color: currentColors.text,
Â  },
Â  dayTextActive: {
Â  Â  color: '#fff',
Â  },
Â  sectionLabel: {
Â  Â  color: currentColors.subText,
Â  Â  fontSize: 12,
Â  Â  fontWeight: 'bold',
Â  Â  marginBottom: 6,
Â  Â  textTransform: 'uppercase',
Â  Â  letterSpacing: 0.5,
Â  },
Â  categoryTag: {
Â  Â  paddingVertical: 8,
Â  Â  paddingHorizontal: 14,
Â  Â  borderRadius: 10,
Â  Â  backgroundColor: currentColors.surface,
Â  Â  borderWidth: 1,
Â  Â  borderColor: isDark ? '#334155' : '#e2e8f0',
Â  Â  marginRight: 6,
Â  },

Â  // SEGMENTED CONTROL (TABS)
Â  segmentedControl: {
Â  Â  flexDirection: 'row',
Â  Â  backgroundColor: isDark ? '#334155' : '#e2e8f0',
Â  Â  borderRadius: 12,
Â  Â  padding: 4,
Â  Â  marginBottom: 10,
Â  },
Â  segmentBtn: {
Â  Â  flex: 1,
Â  Â  paddingVertical: 10,
Â  Â  alignItems: 'center',
Â  Â  borderRadius: 10,
Â  },
Â  segmentBtnActive: {
Â  Â  backgroundColor: isDark ? '#1e293b' : '#fff',
Â  Â  shadowColor: '#000',
Â  Â  shadowOpacity: 0.1,
Â  Â  shadowRadius: 2,
Â  Â  elevation: 2,
Â  },

Â  // CHAT
Â  chatAvatar: {
Â  Â  width: 32,
Â  Â  height: 32,
Â  Â  borderRadius: 16,
Â  Â  backgroundColor: COLORS.secondary,
Â  Â  marginRight: 8,
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'center',
Â  },
Â  chatBubble: {
Â  Â  padding: 12,
Â  Â  borderRadius: 16,
Â  Â  marginBottom: 2,
Â  },
Â  chatBubbleMe: {
Â  Â  backgroundColor: COLORS.primary,
Â  Â  borderBottomRightRadius: 4,
Â  },
Â  chatBubbleOther: {
Â  Â  backgroundColor: isDark ? '#334155' : '#f1f5f9',
Â  Â  borderTopLeftRadius: 4,
Â  },
Â  chatInputBar: {
Â  Â  padding: 12,
Â  Â  borderTopWidth: 1,
Â  Â  borderColor: isDark ? '#334155' : '#f1f5f9',
Â  Â  flexDirection: 'row',
Â  Â  alignItems: 'center',
Â  Â  gap: 10,
Â  Â  backgroundColor: currentColors.surface,
Â  },
Â  chatInput: {
Â  Â  flex: 1,
Â  Â  backgroundColor: isDark ? '#1e293b' : '#f8fafc',
Â  Â  borderRadius: 20,
Â  Â  paddingHorizontal: 15,
Â  Â  height: 40,
Â  Â  color: currentColors.text,
Â  },
Â  chatSendBtn: {
Â  Â  width: 40,
Â  Â  height: 40,
Â  Â  borderRadius: 20,
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'center',
Â  },

Â  // CATEGORY LIST
Â  categoryListItem: {
Â  Â  flexDirection: 'row',
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'space-between',
Â  Â  paddingVertical: 12,
Â  Â  paddingHorizontal: 12,
Â  Â  marginBottom: 8,
Â  Â  borderRadius: 12,
Â  Â  backgroundColor: isDark ? '#1e293b' : '#f8fafc',
Â  Â  borderWidth: 1,
Â  Â  borderColor: isDark ? '#334155' : '#e2e8f0',
Â  },
Â  colorDot: {
Â  Â  width: 16,
Â  Â  height: 16,
Â  Â  borderRadius: 8,
Â  },
Â  deleteIconBtn: {
Â  Â  padding: 8,
Â  Â  backgroundColor: '#fee2e2',
Â  Â  borderRadius: 8,
Â  },
Â  colorCircle: {
Â  Â  width: 42,
Â  Â  height: 42,
Â  Â  borderRadius: 21,
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'center',
Â  Â  borderWidth: 1,
Â  Â  borderColor: 'rgba(0,0,0,0.1)',
Â  },
Â  colorCircleSelected: {
Â  Â  borderWidth: 3,
Â  Â  borderColor: currentColors.text,
Â  },

Â  // ONBOARDING
Â  onboardingContainer: {
Â  Â  flex: 1,
Â  Â  backgroundColor: COLORS.primary,
Â  Â  justifyContent: 'center',
Â  Â  alignItems: 'center',
Â  },
Â  onboardingIconCircle: {
Â  Â  width: 120,
Â  Â  height: 120,
Â  Â  backgroundColor: 'rgba(255,255,255,0.2)',
Â  Â  borderRadius: 60,
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'center',
Â  },
Â  onboardingTitle: {
Â  Â  fontSize: 28,
Â  Â  fontWeight: 'bold',
Â  Â  color: '#fff',
Â  Â  textAlign: 'center',
Â  },
Â  onboardingDesc: {
Â  Â  color: '#fff',
Â  Â  textAlign: 'center',
Â  Â  fontSize: 16,
Â  Â  lineHeight: 24,
Â  },
Â  onboardingFooter: {
Â  Â  position: 'absolute',
Â  Â  bottom: 50,
Â  Â  width: '100%',
Â  Â  paddingHorizontal: 30,
Â  Â  flexDirection: 'row',
Â  Â  justifyContent: 'space-between',
Â  Â  alignItems: 'center',
Â  },
Â  onboardingBtn: {
Â  Â  backgroundColor: '#fff',
Â  Â  paddingHorizontal: 24,
Â  Â  paddingVertical: 12,
Â  Â  borderRadius: 24,
Â  },

Â  // CONFIRM BUTTONS
Â  cancelButton: {
Â  Â  flex: 1,
Â  Â  padding: 14,
Â  Â  borderRadius: 12,
Â  Â  backgroundColor: isDark ? '#334155' : '#f1f5f9',
Â  Â  alignItems: 'center',
Â  },
Â  confirmButton: {
Â  Â  flex: 1,
Â  Â  padding: 14,
Â  Â  borderRadius: 12,
Â  Â  alignItems: 'center',
Â  },

Â  // ADS & UPSELL
Â  fullScreenOverlay: {
Â  Â  flex: 1,
Â  Â  backgroundColor: '#000',
Â  Â  justifyContent: 'center',
Â  Â  padding: 20,
Â  },
Â  adCard: {
Â  Â  backgroundColor: '#1e1e1e',
Â  Â  borderRadius: 16,
Â  Â  padding: 20,
Â  Â  height: '60%',
Â  Â  alignItems: 'center',
Â  },
Â  adBadge: {
Â  Â  color: '#fff',
Â  Â  fontSize: 12,
Â  Â  fontWeight: 'bold',
Â  Â  backgroundColor: 'rgba(255,255,255,0.2)',
Â  Â  paddingHorizontal: 8,
Â  Â  paddingVertical: 4,
Â  Â  borderRadius: 4,
Â  },
Â  adContentPlaceholder: {
Â  Â  flex: 1,
Â  Â  width: '100%',
Â  Â  backgroundColor: '#000',
Â  Â  borderRadius: 12,
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'center',
Â  Â  marginVertical: 10,
Â  },
Â  adCloseBtn: {
Â  Â  padding: 12,
Â  Â  backgroundColor: '#fff',
Â  Â  borderRadius: 24,
Â  Â  marginTop: 10,
Â  Â  width: '100%',
Â  Â  alignItems: 'center',
Â  },
Â  upsellIconCircle: {
Â  Â  width: 80,
Â  Â  height: 80,
Â  Â  borderRadius: 40,
Â  Â  backgroundColor: '#fef3c7',
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'center',
Â  Â  marginBottom: 15,
Â  },
Â  upsellTitle: {
Â  Â  fontSize: 22,
Â  Â  fontWeight: 'bold',
Â  Â  color: currentColors.text,
Â  Â  textAlign: 'center',
Â  },
Â  upsellSubtitle: {
Â  Â  color: currentColors.subText,
Â  Â  textAlign: 'center',
Â  Â  marginTop: 5,
Â  },
Â  checkCircleSmall: {
Â  Â  width: 20,
Â  Â  height: 20,
Â  Â  borderRadius: 10,
Â  Â  backgroundColor: COLORS.success,
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'center',
Â  },
Â toastContainer: {
Â  Â  position: 'absolute',
Â  Â  top: Platform.OS === 'ios' ? 60 : 40, // Android/iOS farkÄ±
Â  Â  left: 20,
Â  Â  right: 20,
Â  Â  zIndex: 9999,
Â  Â  borderRadius: 16,
Â  Â  flexDirection: 'row',
Â  Â  alignItems: 'center',
Â  Â  padding: 16,
Â  Â  gap: 12,
Â  Â  borderWidth: 1,
Â  Â  // Modern GÃ¶lge
Â  Â  shadowColor: "#000",
Â  Â  shadowOffset: { width: 0, height: 4 },
Â  Â  shadowOpacity: 0.15,
Â  Â  shadowRadius: 12,
Â  Â  elevation: 8,
Â  },
Â  toastIconBox: {
Â  Â  width: 40,
Â  Â  height: 40,
Â  Â  borderRadius: 20,
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'center',
Â  Â  shadowColor: "#000",
Â  Â  shadowOpacity: 0.1,
Â  Â  shadowRadius: 5,
Â  Â  elevation: 3,
Â  },
Â  toastTitle: {
Â  Â  color: '#0f172a', // Daha koyu, okunabilir renk
Â  Â  fontWeight: '700',
Â  Â  fontSize: 14,
Â  Â  marginBottom: 2,
Â  Â  letterSpacing: 0.3,
Â  },
Â  toastMessage: {
Â  Â  color: '#475569',
Â  Â  fontSize: 12,
Â  Â  fontWeight: '500',
Â  Â  lineHeight: 16,
Â  },
Â  toastCloseBtn: {
Â  Â  padding: 4,
Â  Â  opacity: 0.7,
Â  },
Â  Â // FAB (Habit)
Â  fabContainer: {
Â  Â  alignItems: 'flex-end',
Â  Â  backgroundColor: 'transparent',
Â  Â  shadowOpacity: 0,
Â  Â  zIndex: 50,
Â  Â  position: 'absolute',
Â  Â  right: 20, // SaÄŸdan boÅŸluk varsayÄ±lan olarak eklendi
Â  },
Â  fabButton: {
Â  Â  backgroundColor: COLORS.primary,
Â  Â  width: 56,
Â  Â  height: 56,
Â  Â  borderRadius: 28,
Â  Â  shadowColor: COLORS.primary,
Â  Â  shadowOpacity: 0.3,
Â  Â  shadowRadius: 10,
Â  Â  elevation: 5,
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'center',
Â  },

Â  // Task Input Overlay & Container
Â  overlay: {
Â  Â  position: 'absolute',
Â  Â  top: 0,Â 
Â  Â  bottom: 0,Â 
Â  Â  left: 0,Â 
Â  Â  right: 0,Â 
Â  Â  backgroundColor: 'rgba(0,0,0,0.2)',Â 
Â  Â  zIndex: 40Â 
Â  },
Â  blurInputContainer: {
Â  Â  position: 'absolute',
Â  Â  left: 20,
Â  Â  right: 20,
Â  Â  borderWidth: 1,
Â  Â  overflow: 'hidden',
Â  Â  zIndex: 50,
Â  Â  borderRadius: 20, // VarsayÄ±lan olarak ekledim, tasarÄ±mÄ±na gÃ¶re deÄŸiÅŸtirebilirsin
Â  },
Â Â 
Â  // Expanded Content
Â  expandedContent: {
Â  Â  padding: 15,
Â  },
Â  sectionTitle: {
Â  Â  fontSize: 10,
Â  Â  fontWeight: 'bold',
Â  Â  color: currentColors.subText,
Â  Â  marginBottom: 5,
Â  },
Â  miniHeader: {
Â  Â  fontSize: 11,Â 
Â  Â  fontWeight: '700',Â 
Â  Â  marginBottom: 8,Â 
Â  Â  letterSpacing: 0.5Â 
Â  },
Â  searchRow: {
Â  Â  flexDirection: 'row',
Â  Â  gap: 5,
Â  Â  marginBottom: 10,
Â  Â  alignItems: 'center',
Â  Â  borderBottomWidth: 1,
Â  Â  paddingBottom: 10,
Â  },
Â Â 
Â  // Assignee Chips
Â  assignChip: {
Â  Â  flexDirection: 'row',
Â  Â  alignItems: 'center',
Â  Â  paddingVertical: 6,
Â  Â  paddingHorizontal: 12,
Â  Â  borderRadius: 20,
Â  Â  borderWidth: 1,
Â  },
Â  avatarSmall: {
Â  Â  width: 28,
Â  Â  height: 28,
Â  Â  borderRadius: 14,
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'center',
Â  Â  marginRight: 8,
Â  Â  overflow: 'hidden',
Â  },
Â  chipText: {
Â  Â  fontSize: 13,Â 
Â  Â  fontWeight: '700'
Â  },
Â Â 
Â  // Date Inputs
Â  dateRow: {
Â  Â  flexDirection: 'row',
Â  Â  gap: 10,
Â  Â  marginBottom: 10,
Â  },
Â  dateInputWrapper: {
Â  Â  flexDirection: 'row',
Â  Â  alignItems: 'center',
Â  },
Â  dateInput: {
Â  Â  flex: 1,
Â  Â  height: 36,
Â  Â  borderTopLeftRadius: 8,
Â  Â  borderBottomLeftRadius: 8,
Â  Â  paddingHorizontal: 10,
Â  Â  fontSize: 12,
Â  },
Â  calendarBtn: {
Â  Â  backgroundColor: COLORS.primary,
Â  Â  padding: 7,
Â  Â  borderTopRightRadius: 8,
Â  Â  borderBottomRightRadius: 8,
Â  Â  height: 36,
Â  Â  justifyContent: 'center',
Â  },
Â  smallInput: {
Â  Â  height: 36,
Â  Â  borderRadius: 8,
Â  Â  paddingHorizontal: 10,
Â  Â  fontSize: 12,
Â  },

Â  // Categories
Â  divider: {
Â  Â  paddingVertical: 10,
Â  Â  borderTopWidth: 1,
Â  },
Â  categoryPill: {
Â  Â  flexDirection: 'row',
Â  Â  alignItems: 'center',
Â  Â  paddingVertical: 6,
Â  Â  paddingHorizontal: 10,
Â  Â  borderRadius: 16,
Â  Â  borderWidth: 1,
Â  Â  gap: 6,
Â  },
Â  dot: {
Â  Â  width: 8,
Â  Â  height: 8,
Â  Â  borderRadius: 4,
Â  },
Â  categoryText: {
Â  Â  fontSize: 12,
Â  Â  fontWeight: '600',
Â  },

Â  // Bottom Actions (Toggles)
Â  bottomActions: {
Â  Â  flexDirection: 'row',
Â  Â  justifyContent: 'space-between',
Â  Â  paddingTop: 10,
Â  },
Â  iconToggle: {
Â  Â  width: 32,
Â  Â  height: 32,
Â  Â  borderRadius: 16,
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'center',
Â  Â  borderWidth: 1,
Â  Â  borderColor: 'transparent',
Â  },
Â  iconToggleActiveBlue: { backgroundColor: '#eff6ff', borderColor: '#3b82f6' },
Â  iconToggleActiveRed: { backgroundColor: '#fef2f2', borderColor: '#ef4444' },
Â  iconToggleActiveGreen: { backgroundColor: '#f0fdf4', borderColor: '#10b981' },
Â  timeInput: {
Â  Â  width: 50,
Â  Â  height: 30,
Â  Â  borderWidth: 1,
Â  Â  borderRadius: 6,
Â  Â  textAlign: 'center',
Â  Â  fontSize: 11,
Â  Â  fontWeight: 'bold',
Â  },

Â  // Main Input Row
Â  mainInputRow: {
Â  Â  flexDirection: 'row',
Â  Â  alignItems: 'center',
Â  Â  padding: 10,
Â  Â  gap: 10,
Â  },
Â  expandBtn: {
Â  Â  padding: 5,
Â  },
Â  mainTextInput: {
Â  Â  flex: 1,
Â  Â  height: 40,
Â  },
Â  sendBtn: {
Â  Â  width: 40,
Â  Â  height: 40,
Â  Â  borderRadius: 20,
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'center',
Â  },
Â  tabBar: {
Â  Â  flexDirection: 'row',
Â  Â  justifyContent: 'space-around', // Ã–ÄŸeleri eÅŸit aralÄ±kla yayar
Â  Â  alignItems: 'center',
Â  Â  paddingVertical: 10, // Alt ve Ã¼st boÅŸluk
Â  Â  paddingBottom: 20, // iPhone safe area iÃ§in ekstra boÅŸluk (gerekirse)
Â  Â  borderTopWidth: 1,
Â  Â  elevation: 10, // Android gÃ¶lgesi iÃ§in
Â  Â  shadowColor: '#000', // iOS gÃ¶lgesi iÃ§in
Â  Â  shadowOffset: { width: 0, height: -2 },
Â  Â  shadowOpacity: 0.1,
Â  Â  shadowRadius: 3,
Â  },
Â  tabItem: {
Â  Â  alignItems: 'center',
Â  Â  justifyContent: 'center',
Â  Â  flex: 1, // TÄ±klama alanÄ±nÄ± geniÅŸletir
Â  Â  paddingVertical: 5,
Â  },
Â  tabLabel: {
Â  Â  fontSize: 10,
Â  Â  marginTop: 4, // Ä°kon ile metin arasÄ±na biraz boÅŸluk
Â  Â  fontWeight: '500',
Â  },
Â Â 
Â  container: { flex: 1, },
Â  card: { padding: 20, borderRadius: 16, shadowColor: "#000", shadowOpacity: 0.05, elevation: 2 },
Â  input: { backgroundColor: 'rgba(0,0,0,0.05)', padding: 15, borderRadius: 12, fontSize: 16 },
Â  btn: { backgroundColor: COLORS.primary, padding: 15, borderRadius: 12, alignItems: 'center' },
Â  greeting: { fontSize: 14, fontWeight: '600', textTransform: 'uppercase', letterSpacing: 1 },
Â  appTitle: { fontSize: 28, fontWeight: '900' },
Â  checkbox: { width: 24, height: 24, borderRadius: 12, borderWidth: 2, borderColor: '#cbd5e1' },
Â  menuText: { fontSize:16, fontWeight:'500', marginLeft:10, flex:1 },
Â  pill: { paddingHorizontal: 15, paddingVertical: 8, borderRadius: 20, borderWidth: 1, borderColor: '#e2e8f0', marginRight: 10 },
Â  dateNavContainer: { flexDirection: 'row', alignItems: 'center', justifyContent: 'space-between', paddingHorizontal: 24, marginBottom: 20 },
// styles objesi iÃ§inde gÃ¼ncelle veya kontrol et:
Â  dateDisplay: {Â 
Â  Â  flexDirection: 'row',Â 
Â  Â  alignItems: 'center',Â 
Â  Â  backgroundColor: 'rgba(99, 102, 241, 0.1)', // Hafif mor arka plan
Â  Â  paddingHorizontal: 16,Â 
Â  Â  paddingVertical: 8,Â 
Â  Â  borderRadius: 20Â 
Â  },
Â  dateText: { fontWeight: '700', fontSize: 14 },
Â  todayBadge: { marginLeft: 8, backgroundColor: COLORS.primary, paddingHorizontal: 6, paddingVertical: 2, borderRadius: 4 },
Â  todayText: { color: '#fff', fontSize: 10, fontWeight: 'bold' },
Â  dateArrow: { padding: 5 },
Â  content: { flex: 1, paddingHorizontal: 24 },
Â  emptyState: { alignItems: 'center', justifyContent: 'center', marginTop: 60 },
Â  emptyIconBox: { width: 80, height: 80, borderRadius: 40, alignItems: 'center', justifyContent: 'center', marginBottom: 20 },
Â  emptyTitle: { fontSize: 20, fontWeight: 'bold', marginBottom: 10 },
Â  emptyDesc: { textAlign: 'center', color: '#94a3b8', lineHeight: 20 },
Â  taskCard: { padding: 16, borderRadius: 24, marginBottom: 12, shadowColor: "#000", shadowOffset: { width: 0, height: 4 }, shadowOpacity: 0.05, shadowRadius: 10, elevation: 2 },
Â  checkBox: { width: 24, height: 24, borderRadius: 12, borderWidth: 2, alignItems: 'center', justifyContent: 'center', marginRight: 16 },
Â  taskText: { fontSize: 16, fontWeight: '600' },
Â  taskMeta: { flexDirection: 'row', alignItems: 'center', gap: 8, marginTop: 6 },
Â  miniBadge: { flexDirection: 'row', alignItems: 'center', gap: 4, paddingHorizontal: 8, paddingVertical: 3, borderRadius: 10 },
Â  metaItem: { flexDirection: 'row', alignItems: 'center', gap: 4 },
floatingInputWrapper: {position: 'absolute', bottom: 90, left: 20, right: 20, borderRadius: 24, padding: 10, shadowColor: "#000", shadowOffset: { width: 0, height: 10 }, shadowOpacity: 0.15, shadowRadius: 20, elevation: 10, overflow: 'hidden'}, Â 
Â  inputMainRow: { flexDirection: 'row', alignItems: 'center', gap: 10 },
Â  mainInput: { flex: 1, fontSize: 16, height: 40, fontWeight: '500' },
Â  expandedOptions: { paddingBottom: 10, marginBottom: 10 },
Â  timeToggle: { flexDirection: 'row', alignItems: 'center', gap: 5, paddingHorizontal: 8, paddingVertical: 4, borderRadius: 12, borderWidth: 1, borderColor: '#e2e8f0' },
Â  statsHero: { padding: 30, borderRadius: 32, marginBottom: 20 },
Â  activeDot: { width: 4, height: 4, borderRadius: 2, backgroundColor: COLORS.primary, marginTop: 4 },
Â  cardTitle: { fontSize: 16, fontWeight: 'bold', marginBottom: 15 },
Â  settingBtn: { flexDirection: 'row', alignItems: 'center', gap: 8, paddingHorizontal: 15, paddingVertical: 10, borderRadius: 12, borderWidth: 1, borderColor: '#e2e8f0' },
Â  settingBtnActive: { borderColor: COLORS.primary, backgroundColor: '#e0e7ff' },
Â  authInputRow: { flexDirection: 'row', alignItems: 'center', borderWidth: 1, borderColor: '#e2e8f0', borderRadius: 12, paddingHorizontal: 15, marginBottom: 15, height: 50 },
Â  authInput: { flex: 1, marginLeft: 10, height: '100%' },
Â  createBtn: { backgroundColor: COLORS.primary, padding: 15, borderRadius: 12, alignItems: 'center' },
Â  socialBtn: { padding: 15, borderRadius: 12, alignItems: 'center', borderWidth: 1, borderColor: '#e2e8f0' },
Â  alarmOverlay: { flex: 1, backgroundColor: 'rgba(99, 102, 241, 0.95)', justifyContent: 'center', alignItems: 'center' },
Â  alarmCard: { width: '80%', padding: 30, borderRadius: 30, alignItems: 'center' },
Â  alarmTitle: { fontSize: 22, fontWeight: '900', marginBottom: 10 },
Â  alarmCloseBtn: { backgroundColor: COLORS.primary, paddingHorizontal: 30, paddingVertical: 12, borderRadius: 16, marginTop: 20 },
Â  tinyInput: { fontSize: 12, fontWeight: 'bold', width: 40, padding: 0, textAlign: 'center', borderBottomWidth: 1 },
Â  dateBtn: { flexDirection: 'row', alignItems: 'center', gap: 6, backgroundColor: '#eff6ff', padding: 8, borderRadius: 8, marginTop: 5 },
Â  catModal: { width: '80%', padding: 20, borderRadius: 24 },
Â  catModalTitle: { fontSize: 18, fontWeight: 'bold', marginBottom: 15 },
Â Â 
});
